# 黑科易购项目部署计划

## 1. 部署环境检查

### 1.1 已完成的环境准备
- ✅ Docker 28.1.1 已安装
- ✅ Docker Compose 1.29.2 已安装
- ✅ 项目代码已就绪
- ✅ docker-compose.yml 已配置完成

### 1.2 待部署的服务组件
- 基础服务：MySQL、Redis、Nacos、RabbitMQ、Zipkin
- 后端服务：多个Spring Boot微服务
- 前端服务：Vue.js应用
- 网关服务：API网关
- 系统服务：系统管理服务

## 2. 部署步骤

### 2.1 启动基础服务（使用Docker Compose）
```bash
# 启动所有基础服务
docker-compose up -d

# 验证服务状态
docker-compose ps
```

### 2.2 构建后端服务
```bash
# 编译所有后端服务
mvn clean install '-Dmaven.test.skip=true'

# 检查编译结果
ls -la heikeji-mall-service/*/target/
```

### 2.3 启动后端服务
```bash
# 进入后端服务目录
cd heikeji-mall-service

# 创建并执行启动脚本
cat > start_services.sh << 'EOF'
#!/bin/bash

# 启动用户服务
nohup java -jar service-user/target/service-user-1.0.0-exec.jar > service-user.log 2>&1 &
echo "用户服务启动成功，PID: $!"
sleep 2

# 启动商品服务
nohup java -jar service-product/target/service-product-1.0.0-exec.jar > service-product.log 2>&1 &
echo "商品服务启动成功，PID: $!"
sleep 2

# 启动订单服务
nohup java -jar service-order/target/service-order-1.0.0-exec.jar > service-order.log 2>&1 &
echo "订单服务启动成功，PID: $!"
sleep 2

# 启动支付服务
nohup java -jar service-payment/target/service-payment-1.0.0-exec.jar > service-payment.log 2>&1 &
echo "支付服务启动成功，PID: $!"
sleep 2

# 启动其他服务...
EOF

chmod +x start_services.sh
./start_services.sh
```

### 2.4 构建前端服务
```bash
# 进入前端目录
cd heikeji-frontend

# 安装依赖
npm install

# 构建前端
npm run build
```

### 2.5 配置并启动网关服务
```bash
# 进入网关目录
cd heikeji-gateway

# 启动网关服务
nohup java -jar target/heikeji-gateway-1.0.0-exec.jar > gateway.log 2>&1 &
echo "网关服务启动成功，PID: $!"
```

### 2.6 配置并启动系统服务
```bash
# 进入系统服务目录
cd heikeji-system

# 启动系统服务
nohup java -jar target/heikeji-system-1.0.0-exec.jar > system.log 2>&1 &
echo "系统服务启动成功，PID: $!"
```

## 3. 服务验证

### 3.1 基础服务验证
- MySQL: `mysql -u root -p -h localhost -P 3306`
- Redis: `redis-cli ping`
- Nacos: 访问 http://localhost:8848/nacos
- RabbitMQ: 访问 http://localhost:15672
- Zipkin: 访问 http://localhost:9411/zipkin

### 3.2 后端服务验证
```bash
# 查看服务日志
tail -f heikeji-mall-service/service-user.log

# 验证服务健康状态
curl http://localhost:8080/actuator/health
```

### 3.3 前端服务验证
- 访问 http://localhost

## 4. 部署检查清单

- [ ] 所有基础服务已启动
- [ ] 所有后端服务已成功构建
- [ ] 所有后端服务已启动
- [ ] 前端已成功构建
- [ ] 网关服务已启动
- [ ] 系统服务已启动
- [ ] 前端可正常访问
- [ ] API接口可正常调用

## 5. 常见问题处理

### 5.1 服务启动失败
- 检查日志文件
- 检查端口占用情况
- 检查数据库连接配置

### 5.2 前端无法访问后端
- 检查Nginx配置
- 检查网关服务状态
- 检查后端服务状态

### 5.3 服务注册失败
- 检查Nacos配置
- 检查服务注册中心地址
- 检查网络连接

## 6. 后续维护

### 6.1 日志管理
- 后端日志：heikeji-mall-service目录下
- Nginx日志：/var/log/nginx/目录下
- MySQL日志：/var/log/mysql/目录下

### 6.2 数据库备份
```bash
# 备份数据库
mysqldump -u root -p heikeji_mall > /opt/backup/heikeji_mall_$(date +%Y%m%d).sql
```

### 6.3 服务重启
```bash
# 停止所有后端服务
ps -ef | grep java | grep -v grep | awk '{print $2}' | xargs kill -9

# 重新启动服务
./start_services.sh
```

## 7. 部署文档参考

- 详细部署文档：DEPLOYMENT_DETAILED.md
- 简化部署文档：DEPLOYMENT_SIMPLIFIED.md
- Docker Compose配置：docker-compose.yml

这个部署计划涵盖了从基础服务启动到前后端部署的完整流程，按照这个计划可以顺利完成黑科易购项目的部署。