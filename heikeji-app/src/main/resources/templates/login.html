<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ç™»å½• - é»‘ç§‘æ˜“è´­</title>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/auth-utils.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-control {
            height: 45px;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding-left: 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #4dabf7;
            box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.25);
        }
        .btn-primary {
            width: 100%;
            height: 45px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            background-color: #4dabf7;
            border: none;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #339af0;
            transform: translateY(-1px);
        }
        .login-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }
        /* åŠ è½½é®ç½©å±?*/
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        #loadingOverlay .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        .login-error {
            color: #f03e3e;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #eee;
        }
        .divider span {
            padding: 0 10px;
            color: #999;
            font-size: 14px;
        }
        .wechat-login {
            text-align: center;
            padding: 10px 0;
        }
        .wechat-login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 45px;
            border: 1px solid #07c160;
            border-radius: 8px;
            background-color: #f6ffed;
            color: #07c160;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .wechat-login-btn:hover {
            background-color: #07c160;
            color: white;
        }
        .wechat-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h2 class="login-title">ç™»å½• é»‘ç§‘æ˜“è´­</h2>
        
        <form id="loginForm">
            <div class="form-group">
                <input type="text" class="form-control" id="username" placeholder="è¯·è¾“å…¥å­¦å?æ‰‹æœºå? required>
                <div id="username-error" class="login-error"></div>
            </div>
            
            <div class="form-group">
                <input type="password" class="form-control" id="password" placeholder="è¯·è¾“å…¥å¯†ç ? required>
                <div id="password-error" class="login-error"></div>
            </div>
            
            <button type="submit" class="btn btn-primary">ç™»å½•</button>
        </form>
        
        <div class="divider"><span>å…¶ä»–ç™»å½•æ–¹å¼</span></div>
        
        <div class="wechat-login">
            <button class="wechat-login-btn" onclick="wechatLogin()">
                <svg class="wechat-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                    <path fill="currentColor" d="M752.2 512c0-108.2-82.7-191.8-185.3-191.8-102.6 0-185.3 83.6-185.3 191.8 0 107.6 82.7 191.8 185.3 191.8 102.6 0 185.3-84.2 185.3-191.8zm-685.3-38.5C30.2 252.3 178.1 128 373.3 128c80.3 0 154.5 21.1 215.9 56.3-33.9 31.4-66.9 68.8-94.3 110.7-19.7 29.3-39.1 66.5-51.9 109.1-2.1 7.6-3.7 15.2-5.7 23.2-4.1-15.9-6.1-32.3-6.1-48.5-0.1-78.6-14.5-149.1-39.1-203.3C312.6 194.2 247.8 176 173.9 176c-137.6 0-256.3 101.8-265.4 297.5-0.9 19.1 0.9 38.2 3.8 57-15.9-3.9-31.3-10.8-45.8-19.9-3.6-2.1-7.2-4.3-10.7-6.5 0-0.1 0-0.2 0-0.3 0-330.3 284.3-585.6 636.7-585.6 323.7 0 570.1 235.2 584.8 548.7 0 0.1 0 0.2 0 0.3-0.4 0.2-0.8 0.5-1.2 0.7-61.5 35.5-132 56.1-208.5 56.1-146.4 0-277.9-49.5-380.3-132.7-24.8 1.3-49.7 2.1-74.8 2.1-236.8 0-416.4-134.7-431.7-301.5z m150.8 297.5c139.2 0 249-109.8 249-243.9 0-134.1-109.8-243.9-249-243.9-139.2 0-249 109.8-249 243.9 0 134.1 109.8 243.9 249 243.9z"/>
                </svg>
                å¾®ä¿¡ä¸€é”®ç™»å½?/button>
        </div>
        
        <div class="login-footer">
            <a href="/api/auth/register" style="color: #4dabf7; text-decoration: none;">æ²¡æœ‰è´¦å·ï¼Ÿç«‹å³æ³¨å†?/a>
        </div>
    </div>
    
    <!-- é”çŠºæµ‡é–¬î†¾åƒµç?-->
    <div id="loadingOverlay" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">é”çŠºæµ‡æ¶“?..</span>
        </div>
    </div>
    
    <!-- é¡µè„š -->
    <footer class="bg-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>å…³äºæˆ‘ä»¬</h5>
                    <p>é»‘ç§‘æ˜“è´­è‡´åŠ›äºä¸ºç”¨æˆ·æä¾›é«˜å“è´¨çš„ç”µå­äº§å“å’Œä¼˜è´¨çš„è´­ç‰©ä½“éªŒã€?/p>
                </div>
                <div class="col-md-4">
                    <h5>å¿«é€Ÿé“¾æ?/h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-dark">é¦–é¡µ</a></li>
                        <li><a href="/api/category/list" class="text-dark">å•†å“åˆ†ç±»</a></li>
                        <li><a href="/api/order/list" class="text-dark">æˆ‘çš„è®¢å•</a></li>
                        <li><a href="/api/cart" class="text-dark">è´­ç‰©è½?/a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>è”ç³»æˆ‘ä»¬</h5>
                    <p>æœåŠ¡ç”µè¯ï¼?00-123-4567</p>
                    <p>é‚®ç®±ï¼šservice@heikeji.com</p>
                </div>
            </div>
            <div class="text-center mt-4">
                <p>&copy; 2024 é»‘ç§‘æ˜“è´­. ä¿ç•™æ‰€æœ‰æƒåˆ?/p>
            </div>
        </div>
    </footer>
    
    <script>
        // æ˜¾ç¤ºåŠ è½½é®ç½©å±?
        function showLoading() {
            $('#loadingOverlay').css('display', 'flex');
        }

        // éšè—åŠ è½½é®ç½©å±?
        function hideLoading() {
            $('#loadingOverlay').css('display', 'none');
        }
        
        // ç™»å½•è¡¨å•æäº¤
        $('#loginForm').submit(function(e) {
            e.preventDefault();
            
            // é‡ç½®é”™è¯¯æç¤º
            $('.login-error').hide();
            
            const username = $('#username').val().trim();
            const password = $('#password').val().trim();
            
            // ç®€å•éªŒè¯?
            if (!username) {
                $('#username-error').text('è¯·è¾“å…¥å­¦å?æ‰‹æœºå?).show();
                return;
            }
            
            if (!password) {
                $('#password-error').text('è¯·è¾“å…¥å¯†ç ?).show();
                return;
            }
            
            // è°ƒç”¨ç™»å½•æ¥å£
            showLoading();
            $.authAjax({
                url: '/api/auth/login',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    username: username,
                    password: password
                }),
                success: function(data) {
                    hideLoading();
                    if (data.code === 200 && data.data && data.data.token) {
                        // ä½¿ç”¨authUtilså­˜å‚¨ç™»å½•ä¿¡æ¯
                        authUtils.login(data.data.token, data.data.userId, data.data.username);
                        
                        // æ˜¾ç¤ºç™»å½•æˆåŠŸæç¤º
                        alert('ç™»å½•æˆåŠŸï¼?);
                        
                        // è·³è½¬åˆ°é¦–é¡µæˆ–ä¹‹å‰çš„é¡µé?
                        const redirectUrl = getUrlParam('redirect') || '/index.html';
                        window.location.href = redirectUrl;
                    } else {
                        alert('ç™»å½•å¤±è´¥ï¼? + (data.message || 'è´¦å·æˆ–å¯†ç é”™è¯?));
                    }
                },
                error: function() {
                    hideLoading();
                    alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                }
            });
        });
        
        // å¾®ä¿¡ç™»å½•
        function wechatLogin() {
            showLoading();
            // å®é™…é¡¹ç›®ä¸­åº”è·³è½¬åˆ°å¾®ä¿¡æ”¯ä»˜é¡µé?
            setTimeout(function() {
                hideLoading();
                alert('å¾®ä¿¡ç™»å½•åŠŸèƒ½å¼€å‘ä¸­...');
            }, 500);
        }
        
        // è·å–URLå‚æ•°
        function getUrlParam(name) {
            const reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');
            const r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURIComponent(r[2]);
            return null;
        }
    </script>
</body>
</html>
