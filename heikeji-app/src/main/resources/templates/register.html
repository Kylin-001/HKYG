<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨å†Œ - é»‘ç§‘æ˜“è´­</title>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .register-container {
            max-width: 450px;
            margin: 80px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        .register-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-control {
            height: 45px;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding-left: 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #4dabf7;
            box-shadow: 0 0 0 2px rgba(77, 171, 247, 0.25);
        }
        .btn-primary {
            width: 100%;
            height: 45px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            background-color: #4dabf7;
            border: none;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #339af0;
            transform: translateY(-1px);
        }
        .register-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }
        .register-footer a {
            color: #4dabf7;
            text-decoration: none;
        }
        .register-footer a:hover {
            text-decoration: underline;
        }
        /* åŠ è½½é®ç½©å±?*/
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        #loadingOverlay .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        .register-error {
            color: #f03e3e;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .form-check {
            margin-bottom: 20px;
        }
        .form-check-input {
            width: 18px;
            height: 18px;
            margin-top: 2px;
        }
        .form-check-label {
            color: #666;
            font-size: 14px;
        }
        .form-check-label a {
            color: #4dabf7;
            text-decoration: none;
        }
        .form-check-label a:hover {
            text-decoration: underline;
        }
        .phone-code {
            display: flex;
            gap: 10px;
        }
        .phone-code input[type="text"] {
            flex: 1;
        }
        .send-code-btn {
            width: 120px;
            height: 45px;
            border-radius: 8px;
            font-size: 14px;
            background-color: #e7f5ff;
            color: #4dabf7;
            border: 1px solid #4dabf7;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .send-code-btn:hover:not(:disabled) {
            background-color: #4dabf7;
            color: white;
        }
        .send-code-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="register-container">
        <h2 class="register-title">æ³¨å†Œ é»‘ç§‘æ˜“è´­</h2>
        
        <form id="registerForm">
            <div class="form-group">
                <input type="text" class="form-control" id="username" placeholder="è¯·è¾“å…¥å­¦å?æ‰‹æœºå? required>
                <div id="username-error" class="register-error"></div>
            </div>
            
            <div class="form-group phone-code">
                <input type="text" class="form-control" id="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" required>
            </div>
            <div id="phone-error" class="register-error"></div>
            
            <div class="form-group phone-code">
                <input type="text" class="form-control" id="verificationCode" placeholder="è¯·è¾“å…¥éªŒè¯ç " required>
                <button type="button" class="send-code-btn" id="sendCodeBtn" onclick="sendVerificationCode()">è·å–éªŒè¯ç ?/button>
            </div>
            <div id="verificationCode-error" class="register-error"></div>
            
            <div class="form-group">
                <input type="password" class="form-control" id="password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆ6-20ä½å­—æ¯æ•°å­—ç»„åˆï¼‰" required>
                <div id="password-error" class="register-error"></div>
            </div>
            
            <div class="form-group">
                <input type="password" class="form-control" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ? required>
                <div id="confirmPassword-error" class="register-error"></div>
            </div>
            
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                <label class="form-check-label" for="agreeTerms">
                    æˆ‘å·²é˜…è¯»å¹¶åŒæ„?a href="#">ç”¨æˆ·åè®®</a> å’?a href="#">éšç§æ”¿ç­–</a>
                </label>
            </div>
            <div id="agreeTerms-error" class="register-error"></div>
            
            <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
        </form>
        
        <div class="register-footer">
            å·²æœ‰è´¦å·ï¼?a href="/api/auth/login">ç«‹å³ç™»å½•</a>
        </div>
    </div>
    
    <!-- åŠ è½½é®ç½©å±?-->
    <div id="loadingOverlay" style="display: none; display: flex;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">åŠ è½½ä¸?..</span>
        </div>
    </div>
    
    <!-- é¡µè„š -->
    <footer class="bg-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>éå……ç°¬é´æˆœæ»‘</h5>
                    <p>æ¦›æˆ î–é„æ’¹å–˜é‘·æ‘å§æµœåºè´Ÿé¢ã„¦åŸ›é»æ„ªç·µæ¥‚æ¨ºæ§ç’ã„§æ®‘é¢é›ç“™æµœÑƒæ§éœå±¼ç´­ç’ã„§æ®‘ç’î… å¢¿æµ£æ’»ç™éŠ†?/p>
                </div>
                <div class="col-md-4">
                    <h5>å¿«é€Ÿé“¾æ?/h5>
                    <ul class="list-unstyled">
                        <li><a href="/" class="text-dark">é¦–é¡µ</a></li>
                        <li><a href="/api/category/list" class="text-dark">å•†å“åˆ†ç±»</a></li>
                        <li><a href="/api/order/list" class="text-dark">æˆ‘çš„è®¢å•</a></li>
                        <li><a href="/api/cart" class="text-dark">è´­ç‰©è½?/a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>è”ç³»æˆ‘ä»¬</h5>
                    <p>æœåŠ¡ç”µè¯ï¼?00-123-4567</p>
                    <p>é‚®ç®±ï¼šservice@heikeji.com</p>
                </div>
            </div>
            <div class="text-center mt-4">
                <p>&copy; 2024 é»‘ç§‘æ˜“è´­. ä¿ç•™æ‰€æœ‰æƒåˆ?/p>
            </div>
        </div>
    </footer>
    
    <script>
        // æ˜¾ç¤ºåŠ è½½é®ç½©å±?       function showLoading() {
            $('#loadingOverlay').css('display', 'flex');
        }

        // éšè—åŠ è½½é®ç½©å±?       function hideLoading() {
            $('#loadingOverlay').css('display', 'none');
        }
        
        // å‘é€éªŒè¯ç 
        function sendVerificationCode() {
            const phone = $('#phone').val().trim();
            const phoneError = $('#phone-error');
            
            // éªŒè¯æ‰‹æœºå?           if (!phone) {
                phoneError.text('è¯·è¾“å…¥æ‰‹æœºå·').show();
                return;
            }
            
            if (!/^1[3-9]\d{9}$/.test(phone)) {
                phoneError.text('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·æ ¼å¼?).show();
                return;
            }
            
            // éšè—é”™è¯¯æç¤º
            phoneError.hide();
            
            // è°ƒç”¨å‘é€éªŒè¯ç æ¥å£
            showLoading();
            $.ajax({
                url: '/api/auth/send-code',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ phone: phone }),
                success: function(data) {
                    hideLoading();
                    if (data.code === 200) {
                        alert('éªŒè¯ç å‘é€æˆåŠŸï¼Œè¯·æŸ¥æ”?);
                        // å€’è®¡æ—?
                        let countdown = 60;
                        const btn = $('#sendCodeBtn');
                        btn.prop('disabled', true);
                        btn.text(countdown + 'ç§’åé‡æ–°è·å–');
                        
                        const timer = setInterval(function() {
                            countdown--;
                            btn.text(countdown + 'ç§’åé‡æ–°è·å–');
                            if (countdown <= 0) {
                                clearInterval(timer);
                                btn.prop('disabled', false);
                                btn.text('è·å–éªŒè¯ç ?);
                            }
                        }, 1000);
                    } else {
                        alert('éªŒè¯ç å‘é€å¤±è´¥ï¼š' + (data.message || 'è¯·é‡è¯?) + '');
                    }
                },
                error: function() {
                    hideLoading();
                    alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                }
            });
        }
        
        // æ³¨å†Œè¡¨å•æäº¤
        $('#registerForm').submit(function(e) {
            e.preventDefault();
            
            // é‡ç½®é”™è¯¯æç¤º
            $('.register-error').hide();
            
            const username = $('#username').val().trim();
            const phone = $('#phone').val().trim();
            const verificationCode = $('#verificationCode').val().trim();
            const password = $('#password').val().trim();
            const confirmPassword = $('#confirmPassword').val().trim();
            const agreeTerms = $('#agreeTerms').is(':checked');
            
            // æ¥ å²ƒç˜‰ç›ã„¥å´Ÿ
            let isValid = true;
            
            if (!username) {
                $('#username-error').text('è¯·è¾“å…¥å­¦å?æ‰‹æœºå?).show();
                isValid = false;
            }
            
            if (!phone) {
                $('#phone-error').text('è¯·è¾“å…¥æ‰‹æœºå·').show();
                isValid = false;
            } else if (!/^1[3-9]\d{9}$/.test(phone)) {
                $('#phone-error').text('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·æ ¼å¼?).show();
                isValid = false;
            }
            
            if (!verificationCode) {
                $('#verificationCode-error').text('è¯·è¾“å…¥éªŒè¯ç ').show();
                isValid = false;
            }
            
            if (!password) {
                $('#password-error').text('è¯·è¾“å…¥å¯†ç ?).show();
                isValid = false;
            } else if (!/^[a-zA-Z0-9]{6,20}$/.test(password)) {
                $('#password-error').text('å¯†ç å¿…é¡»ä¸?-20ä½å­—æ¯æ•°å­—ç»„åˆï¼').show();
                isValid = false;
            }
            
            if (password !== confirmPassword) {
                $('#confirmPassword-error').text('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡?).show();
                isValid = false;
            }
            
            if (!agreeTerms) {
                $('#agreeTerms-error').text('è¯·é˜…è¯»å¹¶åŒæ„ç”¨æˆ·åè®®å’Œéšç§æ”¿ç­?).show();
                isValid = false;
            }
            
            if (!isValid) {
                return;
            }
            
            // è°ƒç”¨æ³¨å†Œæ¥å£
            showLoading();
            $.ajax({
                url: '/api/auth/register',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    username: username,
                    phone: phone,
                    verificationCode: verificationCode,
                    password: password
                }),
                success: function(data) {
                    hideLoading();
                    if (data.code === 200) {
                        alert('æ³¨å†ŒæˆåŠŸï¼Œå³å°†è·³è½¬åˆ°ç™»å½•é¡µé¢');
                        // è·³è½¬åˆ°ç™»å½•é¡µé?                       window.location.href = '/api/auth/login';
                    } else {
                        alert('æ³¨å†Œå¤±è´¥ï¼? + (data.message || 'è¯·é‡è¯?) + '');
                    }
                },
                error: function() {
                    hideLoading();
                    alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
                }
            });
        });
    </script>
</body>
</html>
