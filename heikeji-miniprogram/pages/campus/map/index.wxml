<!-- 校园地图页面 -->
<view class="page-container">
  <!-- 页面头部 -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <icon type="back" size="22"></icon>
    </view>
    <text class="title">校园地图</text>
    <view class="header-right">
      <image src="/assets/icons/location.png" class="location-icon" mode="aspectFit" bindtap="onLocate"></image>
    </view>
  </view>

  <!-- 地图容器 -->
  <view class="map-container">
    <map
      id="campus-map"
      longitude="{{longitude}}"
      latitude="{{latitude}}"
      scale="{{scale}}"
      markers="{{markers}}"
      polyline="{{polyline}}"
      controls="{{controls}}"
      show-location="{{showLocation}}"
      show-scale="true"
      bindtap="onMapTap"
      bindmarkertap="onMarkerTap"
      bindcontroltap="onControlTap"
      bindregionchange="onRegionChange"
      style="width: 100%; height: 100%;"
    ></map>
  </view>

  <!-- 建筑分类选择 -->
  <view class="building-categories">
    <scroll-view scroll-x="true" enable-flex="true" class="categories-scroll">
      <view
        class="category-item {{activeCategory === 'all' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="all"
      >
        全部
      </view>
      <view
        class="category-item {{activeCategory === 'teaching' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="teaching"
      >
        教学楼
      </view>
      <view
        class="category-item {{activeCategory === 'dormitory' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="dormitory"
      >
        宿舍
      </view>
      <view
        class="category-item {{activeCategory === 'dining' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="dining"
      >
        餐厅
      </view>
      <view
        class="category-item {{activeCategory === 'library' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="library"
      >
        图书馆
      </view>
      <view
        class="category-item {{activeCategory === 'sports' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="sports"
      >
        体育场馆
      </view>
      <view
        class="category-item {{activeCategory === 'administration' ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-category="administration"
      >
        行政楼
      </view>
    </scroll-view>
  </view>

  <!-- 建筑列表 -->
  <view class="building-list" wx:if="{{showBuildingList}}">
    <view class="building-item" wx:for="{{filteredBuildings}}" wx:key="id" bindtap="onBuildingTap" data-id="{{item.id}}">
      <text class="building-name">{{item.name}}</text>
      <text class="building-type">{{item.typeName}}</text>
    </view>
  </view>

  <!-- 建筑详情弹窗 -->
  <view class="building-detail" wx:if="{{showBuildingDetail}}">
    <view class="detail-content">
      <view class="detail-header">
        <text class="detail-title">{{selectedBuilding.name}}</text>
        <view class="close-btn" bindtap="onCloseDetail">
          <image src="/assets/icons/close.png" class="close-icon" mode="aspectFit"></image>
        </view>
      </view>
      <view class="detail-info">
        <text class="info-item">{{selectedBuilding.typeName}}</text>
        <text class="info-item">{{selectedBuilding.address}}</text>
        <text class="info-item">{{selectedBuilding.description}}</text>
      </view>
      <view class="detail-actions">
        <button class="action-btn" type="primary" bindtap="onNavigate">
          导航
        </button>
      </view>
    </view>
  </view>
</view>