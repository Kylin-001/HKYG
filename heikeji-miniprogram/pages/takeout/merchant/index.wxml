<!-- 商家详情页 -->
<view class="merchant-detail-container">
  <!-- 商家基本信息 -->
  <scroll-view scroll-y="true" class="detail-scroll">
    <!-- 商家头部信息 -->
    <view class="merchant-header">
      <image src="{{merchant.imageUrl || '/assets/icons/merchant-default.png'}}" mode="aspectFill" class="merchant-banner" />
      <view class="merchant-info">
        <text class="merchant-name">{{merchant.name}}</text>
        <view class="merchant-meta">
          <text class="merchant-rating">{{merchant.rating}} ★</text>
          <text class="merchant-distance">{{merchant.distance}}m</text>
          <text class="merchant-delivery">配送费{{merchant.deliveryFee}}元起</text>
          <text class="merchant-min-order">起送价{{merchant.minOrder}}元</text>
        </view>
        <view class="merchant-desc">{{merchant.description}}</view>
        <view class="merchant-status" wx:if="{{merchant.status == 1}}">
          <text class="status-open">营业中</text>
          <text class="opening-hours">{{merchant.openingHours}}</text>
        </view>
        <view class="merchant-status" wx:else>
          <text class="status-closed">已打烊</text>
        </view>
      </view>
    </view>

    <!-- 菜品分类导航 -->
    <view class="category-tabs">
      <scroll-view scroll-x="true" class="category-scroll">
        <view class="category-tab {{currentCategory == item.id ? 'active' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="id" 
              bindtap="onCategoryChange" 
              data-id="{{item.id}}">
          <text>{{item.name}}</text>
        </view>
      </scroll-view>
    </view>

    <!-- 菜品列表 -->
    <view class="dishes-container">
      <!-- 左侧分类导航 -->
      <scroll-view scroll-y="true" class="left-category" style="height: {{windowHeight - 400}}px;">
        <view class="left-category-item {{currentCategory == item.id ? 'active' : ''}}" 
              wx:for="{{categories}}" 
              wx:key="id" 
              bindtap="onCategoryChange" 
              data-id="{{item.id}}">
          <text>{{item.name}}</text>
        </view>
      </scroll-view>

      <!-- 右侧菜品列表 -->
      <scroll-view scroll-y="true" class="right-dishes" style="height: {{windowHeight - 400}}px;">
        <view class="dish-section" wx:for="{{categories}}" wx:key="id" wx:if="{{currentCategory == item.id}}">
          <view class="section-title">{{item.name}}</view>
          <view class="dish-item" 
                wx:for="{{item.dishes}}" 
                wx:for-item="dish" 
                wx:key="id" 
                bindtap="onDishClick" 
                data-dish="{{dish}}">
            <image src="{{dish.imageUrl || '/assets/icons/dish-default.png'}}" mode="aspectFill" class="dish-image" />
            <view class="dish-info">
              <text class="dish-name">{{dish.name}}</text>
              <text class="dish-desc">{{dish.description}}</text>
              <view class="dish-footer">
                <text class="dish-price">¥{{dish.price}}</text>
                <text class="dish-sales">月售{{dish.sales}}份</text>
              </view>
            </view>
            <view class="dish-action" bindtap="addToCart" data-dish="{{dish}}">
              <text class="add-btn">+</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 评价展示 -->
    <view class="comments-section">
      <view class="section-header">
        <text class="section-title">用户评价</text>
        <text class="view-all" bindtap="viewAllComments">查看全部</text>
      </view>
      <view class="comment-item" wx:for="{{comments}}" wx:key="id">
        <image src="{{item.avatar || '/assets/icons/user-default.png'}}" mode="aspectFill" class="comment-avatar" />
        <view class="comment-content">
          <view class="comment-header">
            <text class="comment-user">{{item.userName}}</text>
            <text class="comment-rating">{{item.rating}} ★</text>
            <text class="comment-time">{{item.createTime}}</text>
          </view>
          <text class="comment-text">{{item.content}}</text>
          <image src="{{item.imageUrl}}" mode="aspectFill" class="comment-image" wx:if="{{item.imageUrl}}" />
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部购物车栏 -->
  <view class="cart-bottom-bar">
    <view class="cart-info" bindtap="navigateToCart">
      <image src="/assets/icons/cart.png" mode="aspectFit" class="cart-icon" />
      <text class="cart-count" wx:if="{{cartCount > 0}}">{{cartCount}}</text>
      <text class="cart-total">¥{{cartTotal}}</text>
    </view>
    <button class="submit-order-btn" bindtap="navigateToCheckout" disabled="{{cartCount == 0}}">
      去结算
    </button>
  </view>

  <!-- 菜品详情弹窗 -->
  <view class="dish-modal" wx:if="{{showDishModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">菜品详情</text>
        <text class="close-btn" bindtap="closeDishModal">×</text>
      </view>
      <image src="{{selectedDish.imageUrl || '/assets/icons/dish-default.png'}}" mode="aspectFill" class="modal-dish-image" />
      <view class="modal-dish-info">
        <text class="modal-dish-name">{{selectedDish.name}}</text>
        <text class="modal-dish-price">¥{{selectedDish.price}}</text>
        <text class="modal-dish-desc">{{selectedDish.description}}</text>
        <text class="modal-dish-sales">月售{{selectedDish.sales}}份</text>
      </view>
      <view class="modal-dish-count">
        <text class="count-label">数量</text>
        <view class="count-control">
          <text class="count-btn minus" bindtap="decreaseCount" disabled="{{dishCount <= 1}}">-</text>
          <text class="count-value">{{dishCount}}</text>
          <text class="count-btn plus" bindtap="increaseCount">+</text>
        </view>
      </view>
      <button class="modal-add-btn" bindtap="confirmAddToCart">
        加入购物车
      </button>
    </view>
  </view>
</view>