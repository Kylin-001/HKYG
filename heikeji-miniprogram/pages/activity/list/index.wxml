<!-- pages/activity/list/index.wxml -->
<view class="activity-container">
  <!-- 顶部搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrap {{showSearch ? 'active' : ''}}">
      <image class="search-icon" src="/assets/icons/search.png" mode="aspectFit"></image>
      <input 
        class="search-input" 
        placeholder="搜索活动..." 
        value="{{searchKeyword}}" 
        bindinput="onSearchInput" 
        bindconfirm="onSearch"
        focus="{{showSearch}}"
      ></input>
      <image class="close-icon" src="/assets/icons/close.png" mode="aspectFit" bindtap="toggleSearch"></image>
    </view>
    <view class="search-btn" bindtap="toggleSearch" wx:if="{{!showSearch}}">
      <image class="search-btn-icon" src="/assets/icons/search.png" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 分类导航 -->
  <scroll-view class="category-scroll" scroll-x>
    <view class="category-item {{selectedCategory === 0 ? 'active' : ''}}" data-id="0" bindtap="onCategoryChange">
      全部
    </view>
    <view 
      class="category-item {{selectedCategory === item.id ? 'active' : ''}}" 
      wx:for="{{categories}}" 
      wx:key="id" 
      data-id="{{item.id}}" 
      bindtap="onCategoryChange"
    >
      {{item.name}}
    </view>
  </scroll-view>

  <!-- 标签切换 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{selectedTab === item.id ? 'active' : ''}}" 
      wx:for="{{tabBar}}" 
      wx:key="id" 
      data-id="{{item.id}}" 
      bindtap="onTabChange"
    >
      {{item.name}}
    </view>
  </view>

  <!-- 排序选项 -->
  <view class="sort-bar">
    <text class="sort-label">排序：</text>
    <view 
      class="sort-item {{selectedSort === item.id ? 'active' : ''}}" 
      wx:for="{{sortOptions}}" 
      wx:key="id" 
      data-id="{{item.id}}" 
      bindtap="onSortChange"
    >
      {{item.name}}
    </view>
  </view>

  <!-- 内容区域 -->
  <scroll-view 
    class="content-scroll" 
    scroll-y 
    bindscrolltolower="onReachBottom"
    refresher-enabled="true"
    refresher-triggered="{{refreshing}}"
    refresher-background="#f5f5f5"
    refresher-default-style="black"
  >
    <!-- 热门活动 -->
    <view class="hot-activities" wx:if="{{selectedTab === 'all'}}">
      <view class="section-title">
        <text class="title-text">热门活动</text>
        <text class="more-text">查看更多</text>
      </view>
      <scroll-view class="hot-activities-scroll" scroll-x>
        <view 
          class="hot-activity-item" 
          wx:for="{{hotActivities}}" 
          wx:key="id" 
          data-id="{{item.id}}" 
          bindtap="onHotActivityTap"
        >
          <image class="activity-cover" src="{{item.cover}}" mode="aspectFill"></image>
          <view class="activity-info">
            <text class="activity-title">{{item.title}}</text>
            <text class="activity-time">{{item.startTime}}</text>
            <view class="participants">
              <image class="participant-icon" src="/assets/icons/user.png" mode="aspectFit"></image>
              <text>{{item.participants}}人已报名</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 活动列表 -->
    <view class="activity-list">
      <view 
        class="activity-item" 
        wx:for="{{activities}}" 
        wx:key="id" 
        data-id="{{item.id}}" 
        bindtap="onActivityTap"
      >
        <image class="activity-cover" src="{{item.cover || '/assets/images/default-activity.jpg'}}" mode="aspectFill"></image>
        <view class="activity-content">
          <view class="activity-header">
            <text class="activity-title">{{item.title}}</text>
            <view class="status-tag {{item.status}}">
              <text>{{item.status === 'upcoming' ? '即将开始' : item.status === 'ongoing' ? '进行中' : '已结束'}}</text>
            </view>
          </view>
          <view class="activity-meta">
            <view class="meta-item">
              <image class="meta-icon" src="/assets/icons/calendar.png" mode="aspectFit"></image>
              <text class="meta-text">{{item.startTime}}</text>
            </view>
            <view class="meta-item">
              <image class="meta-icon" src="/assets/icons/location.png" mode="aspectFit"></image>
              <text class="meta-text">{{item.location}}</text>
            </view>
          </view>
          <view class="activity-footer">
            <view class="category-tag">
              {{item.category}}
            </view>
            <view class="participant-count">
              <text>{{item.participants}}/{{item.maxParticipants}}人参与</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view class="loading-more" wx:if="{{loading}}">
      <text>加载中...</text>
    </view>
    <view class="no-more" wx:if="{{!hasMore && activities.length > 0}}">
      <text>没有更多了</text>
    </view>
    <view class="empty" wx:if="{{!loading && activities.length === 0}}">
      <image class="empty-icon" src="/assets/icons/empty.png" mode="aspectFit"></image>
      <text class="empty-text">暂无活动</text>
    </view>
  </scroll-view>
</view>
