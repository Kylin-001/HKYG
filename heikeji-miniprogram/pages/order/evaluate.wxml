<!-- 评价页面 -->
<view class="page-container">
  <!-- 页面头部 -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <icon type="back" size="22"></icon>
    </view>
    <text class="title">评价订单</text>
    <view class="header-right"></view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 评价内容 -->
  <view wx:else class="evaluate-content">
    <!-- 订单信息 -->
    <view class="order-info" wx:if="{{orderInfo}}">
      <view class="order-title">订单商品</view>
      <block wx:for="{{orderInfo.items}}" wx:key="id">
        <view class="order-item">
          <image src="{{item.image}}" class="item-image" mode="aspectFill"></image>
          <view class="item-info">
            <text class="item-name">{{item.name}}</text>
            <text class="item-quantity">x{{item.quantity}}</text>
          </view>
        </view>
      </block>
    </view>

    <!-- 整体评分 -->
    <view class="rating-section">
      <text class="section-title">整体评分</text>
      <view class="rating-container">
        <view class="rating-stars">
          <block wx:for="[1,2,3,4,5]" wx:key="*this">
            <image 
              src="{{overallRating >= item ? '/assets/icons/star-active.png' : '/assets/icons/star.png'}}" 
              class="star-icon" 
              mode="aspectFit"
              bindtap="selectRating"
              data-rating="{{item}}"
              data-type="overall"
            ></image>
          </block>
        </view>
        <text class="rating-text">{{overallRating === 5 ? '非常满意' : overallRating === 4 ? '满意' : overallRating === 3 ? '一般' : overallRating === 2 ? '不满意' : '非常不满意'}}</text>
      </view>
    </view>

    <!-- 商品评分 -->
    <block wx:for="{{evaluateItems}}" wx:key="id" wx:for-index="index">
      <view class="rating-section">
        <text class="section-title">
          <image src="{{item.image}}" class="product-image" mode="aspectFill"></image>
          {{item.name}} 评分
        </text>
        <view class="rating-container">
          <view class="rating-stars">
            <block wx:for="[1,2,3,4,5]" wx:key="*this">
              <image 
                src="{{item.rating >= item2 ? '/assets/icons/star-active.png' : '/assets/icons/star.png'}}" 
                class="star-icon" 
                mode="aspectFit"
                bindtap="selectRating"
                data-rating="{{item2}}"
                data-type="item"
                data-index="{{index}}"
              ></image>
            </block>
          </view>
          <text class="rating-text">{{item.rating === 5 ? '非常满意' : item.rating === 4 ? '满意' : item.rating === 3 ? '一般' : item.rating === 2 ? '不满意' : '非常不满意'}}</text>
        </view>
        <!-- 商品评价内容 -->
        <view class="content-section">
          <textarea 
            class="content-input" 
            placeholder="请输入对该商品的评价（选填）" 
            placeholder-class="placeholder" 
            value="{{item.content}}" 
            bindinput="inputItemContent"
            data-index="{{index}}"
          ></textarea>
        </view>
      </view>
    </block>

    <!-- 服务评分 -->
    <view class="rating-section">
      <text class="section-title">服务评分</text>
      <view class="rating-container">
        <view class="rating-stars">
          <block wx:for="[1,2,3,4,5]" wx:key="*this">
            <image 
              src="{{serviceRating >= item ? '/assets/icons/star-active.png' : '/assets/icons/star.png'}}" 
              class="star-icon" 
              mode="aspectFit"
              bindtap="selectRating"
              data-rating="{{item}}"
              data-type="service"
            ></image>
          </block>
        </view>
        <text class="rating-text">{{serviceRating === 5 ? '非常满意' : serviceRating === 4 ? '满意' : serviceRating === 3 ? '一般' : serviceRating === 2 ? '不满意' : '非常不满意'}}</text>
      </view>
    </view>

    <!-- 配送评分 -->
    <view class="rating-section">
      <text class="section-title">配送评分</text>
      <view class="rating-container">
        <view class="rating-stars">
          <block wx:for="[1,2,3,4,5]" wx:key="*this">
            <image 
              src="{{deliveryRating >= item ? '/assets/icons/star-active.png' : '/assets/icons/star.png'}}" 
              class="star-icon" 
              mode="aspectFit"
              bindtap="selectRating"
              data-rating="{{item}}"
              data-type="delivery"
            ></image>
          </block>
        </view>
        <text class="rating-text">{{deliveryRating === 5 ? '非常满意' : deliveryRating === 4 ? '满意' : deliveryRating === 3 ? '一般' : deliveryRating === 2 ? '不满意' : '非常不满意'}}</text>
      </view>
    </view>

    <!-- 评价内容 -->
    <view class="content-section">
      <text class="section-title">评价内容</text>
      <textarea 
        class="content-input" 
        placeholder="请分享您的购物体验，帮助其他用户更好地选择（至少10个字）" 
        placeholder-class="placeholder" 
        value="{{content}}" 
        bindinput="inputContent"
        maxlength="500"
      ></textarea>
      <text class="content-count">{{content.length}}/500</text>
    </view>

    <!-- 评价图片 -->
    <view class="image-section">
      <text class="section-title">评价图片（最多9张）</text>
      <view class="image-container">
        <!-- 已上传图片 -->
        <block wx:for="{{images}}" wx:key="*this" wx:for-index="index">
          <view class="image-item">
            <image 
              src="{{item}}" 
              class="uploaded-image" 
              mode="aspectFill"
              bindtap="previewImage"
              data-index="{{index}}"
            ></image>
            <view class="delete-btn" bindtap="deleteImage" data-index="{{index}}">
              <icon type="clear" size="20" color="#fff"></icon>
            </view>
          </view>
        </block>
        <!-- 添加图片按钮 -->
        <view 
          class="add-image-btn" 
          bindtap="chooseImage" 
          wx:if="{{images.length < 9}}"
        >
          <image src="/assets/icons/add-image.png" class="add-icon" mode="aspectFit"></image>
          <text class="add-text">添加图片</text>
        </view>
      </view>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <button 
        class="submit-btn" 
        bindtap="submitEvaluate" 
        loading="{{submitting}}">{{submitting ? '提交中...' : '提交评价'}}</button>
    </view>
  </view>
</view>
