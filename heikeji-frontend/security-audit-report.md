# 安全审计报告

## 1. 发现的安全问题

### 1.1 跨站脚本(XSS)漏洞

- **问题描述**：在校园地图组件中使用了`innerHTML`直接设置DOM内容，没有进行HTML转义
- **位置**：`src/views/campus/locker.vue`中的`initCampusMap`方法
- **风险等级**：高
- **影响范围**：可能导致恶意脚本注入，获取用户信息或执行恶意操作

### 1.2 不安全的令牌存储

- **问题描述**：认证令牌存储在localStorage中，容易受到XSS攻击
- **位置**：`src/main.js`中的请求拦截器
- **风险等级**：中
- **影响范围**：攻击者可通过XSS漏洞获取令牌，模拟用户身份

### 1.3 缺少CSRF保护

- **问题描述**：没有实现CSRF令牌验证机制
- **位置**：全局请求处理
- **风险等级**：中
- **影响范围**：可能导致跨站请求伪造攻击，执行未授权操作

### 1.4 不安全的直接对象引用

- **问题描述**：部分API调用直接使用URL参数进行资源访问，没有严格的权限验证
- **位置**：多个API调用如`/api/user/${userId}`
- **风险等级**：中
- **影响范围**：可能导致越权访问其他用户数据

### 1.5 密码安全处理

- **问题描述**：虽然有密码强度验证，但缺少防止暴力破解的措施
- **位置**：`src/views/profile/index.vue`中的密码修改功能
- **风险等级**：低
- **影响范围**：可能被暴力破解工具攻击

## 2. 修复建议

### 2.1 修复XSS漏洞

- 使用`textContent`或Vue的绑定语法代替`innerHTML`
- 对用户输入进行严格过滤和转义
- 实现内容安全策略(CSP)

### 2.2 改进令牌存储

- 使用HttpOnly Cookie存储令牌
- 实现令牌过期和刷新机制
- 考虑添加令牌绑定用户设备信息

### 2.3 添加CSRF保护

- 实现CSRF令牌验证
- 在关键操作中添加二次验证
- 设置适当的SameSite Cookie属性

### 2.4 加强访问控制

- 实现严格的权限检查中间件
- 对所有资源访问进行身份验证和授权
- 实现基于角色的访问控制(RBAC)

### 2.5 增强密码安全

- 实现登录失败次数限制
- 添加验证码机制
- 考虑实现双因素认证

## 3. 修复优先级

1. **高优先级**：修复XSS漏洞
2. **高优先级**：改进令牌存储安全
3. **中优先级**：添加CSRF保护
4. **中优先级**：加强访问控制
5. **低优先级**：增强密码安全

## 4. 结论

本次安全审计发现了多个需要关注的安全问题，主要集中在XSS防护、令牌管理和访问控制方面。通过实施建议的修复措施，可以显著提高系统的安全性，减少潜在的安全风险。建议尽快实施这些修复，并建立定期的安全审计机制。