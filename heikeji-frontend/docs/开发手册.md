# 黑科易购校园服务平台 开发手册

## 目录结构

- [项目概述](#项目概述)
- [技术栈](#技术栈)
- [开发环境搭建](#开发环境搭建)
- [项目结构](#项目结构)
- [组件开发规范](#组件开发规范)
- [API调用规范](#api调用规范)
- [状态管理](#状态管理)
- [路由管理](#路由管理)
- [性能优化](#性能优化)
- [测试策略](#测试策略)
- [部署流程](#部署流程)

## 项目概述

黑科易购校园服务平台是一个专为校园师生提供外卖、跑腿等服务的综合性平台。前端采用Vue.js框架开发，实现了用户下单、商户管理、订单处理等核心功能。

## 技术栈

- **前端框架**: Vue.js 2.x
- **构建工具**: Vue CLI
- **UI组件库**: Element UI
- **状态管理**: Vuex
- **路由管理**: Vue Router
- **HTTP请求**: Axios
- **图表库**: ECharts (通过ve-chart组件使用)
- **测试框架**: Jest
- **代码规范**: ESLint (standard配置)

## 开发环境搭建

### 环境要求

- Node.js >= 10.16
- npm >= 5.6

### 安装步骤

1. **克隆代码库**
   ```bash
   git clone [仓库地址]
   cd heikeji-mall/heikeji-frontend
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动开发服务器**
   ```bash
   npm run serve
   ```
   访问 http://localhost:8080 查看项目

4. **运行测试**
   ```bash
   npm run test:unit
   ```

5. **构建项目**
   ```bash
   npm run build
   ```

## 项目结构

```
src/
├── api/           # API接口定义
├── assets/        # 静态资源
├── components/    # 公共组件
├── icons/         # 图标组件
├── layout/        # 布局组件
├── router/        # 路由配置
├── store/         # Vuex状态管理
├── styles/        # 全局样式
├── utils/         # 工具函数
├── views/         # 页面视图
├── App.vue        # 根组件
└── main.js        # 入口文件
```

### 模块职责

- **api/**: 定义所有与后端交互的API接口
- **components/**: 可复用的UI组件
- **views/**: 页面级组件，对应路由配置
- **store/**: 全局状态管理，按模块划分
- **router/**: 定义应用的路由结构
- **utils/**: 通用工具函数和请求拦截器

## 组件开发规范

### 命名规范

- 组件名称使用PascalCase（大驼峰）命名
- 单文件组件的文件名与组件名保持一致
- 组件内部的props使用camelCase（小驼峰）命名
- 事件命名使用kebab-case（短横线）格式

### 组件结构

```vue
<template>
  <!-- 组件模板 -->
</template>

<script>
export default {
  name: 'ComponentName',
  props: {
    // 组件属性
  },
  data() {
    return {
      // 组件数据
    }
  },
  computed: {
    // 计算属性
  },
  watch: {
    // 监听器
  },
  created() {
    // 生命周期钩子
  },
  methods: {
    // 组件方法
  }
}
</script>

<style scoped>
/* 组件样式 */
</style>
```

### 最佳实践

1. **组件拆分**：复杂页面应拆分为多个小组件
2. **Props验证**：为props提供类型验证和默认值
3. **事件通信**：父组件通过props传递数据，子组件通过$emit触发事件
4. **样式隔离**：使用scoped属性隔离组件样式
5. **性能优化**：合理使用v-if/v-show，避免不必要的渲染

## API调用规范

### 接口定义

所有API接口定义在`src/api/`目录下，按功能模块分类。

```javascript
// 示例：src/api/user.js
import request from '@/utils/request'

export function login(data) {
  return request({
    url: '/api/user/login',
    method: 'post',
    data
  })
}

export function getUserInfo() {
  return request({
    url: '/api/user/info',
    method: 'get'
  })
}
```

### 请求拦截器

在`src/utils/request.js`中配置请求拦截器，处理公共逻辑如token添加、加载状态等。

### 错误处理

统一处理API请求错误，在响应拦截器中处理通用错误逻辑。

```javascript
// 错误处理示例
try {
  const response = await apiFunction(params)
  // 处理成功响应
} catch (error) {
  this.$message.error(error.message || '请求失败')
}
```

## 状态管理

### Vuex模块划分

按功能模块划分Vuex store，每个模块包含state、mutations、actions和getters。

```javascript
// store/modules/user.js 示例
const state = {
  userInfo: null,
  token: ''
}

const mutations = {
  SET_USER_INFO(state, userInfo) {
    state.userInfo = userInfo
  },
  SET_TOKEN(state, token) {
    state.token = token
  }
}

const actions = {
  async login({ commit }, loginData) {
    const response = await login(loginData)
    commit('SET_TOKEN', response.token)
    commit('SET_USER_INFO', response.userInfo)
    return response
  }
}

const getters = {
  isLoggedIn: state => !!state.token,
  userInfo: state => state.userInfo
}

export default {
  namespaced: true,
  state,
  mutations,
  actions,
  getters
}
```

### 使用规范

- 严格遵循单向数据流
- 只通过mutations修改state
- 异步操作放在actions中
- 使用getters获取派生状态

## 路由管理

### 路由配置

在`src/router/index.js`中定义应用的路由结构。

```javascript
const routes = [
  {
    path: '/login',
    name: 'Login',
    component: () => import('@/views/login'),
    meta: { hidden: true }
  },
  {
    path: '/',
    component: Layout,
    redirect: '/dashboard',
    children: [
      {
        path: 'dashboard',
        name: 'Dashboard',
        component: () => import('@/views/dashboard'),
        meta: { title: '仪表盘', icon: 'el-icon-s-home' }
      }
    ]
  }
]
```

### 路由守卫

使用路由守卫处理权限验证、页面访问控制等。

```javascript
router.beforeEach((to, from, next) => {
  // 检查是否需要登录
  if (to.meta.requireAuth) {
    // 验证登录状态
    if (store.getters.isLoggedIn) {
      next()
    } else {
      next({ path: '/login' })
    }
  } else {
    next()
  }
})
```

## 性能优化

### 代码分割

使用动态导入实现代码分割，减少初始加载时间。

```javascript
// 路由懒加载
const UserProfile = () => import('@/views/user/profile')
```

### 资源优化

- 图片懒加载
- 组件按需加载
- 使用CDN加速静态资源

### 数据缓存

- 使用localStorage/sessionStorage缓存不常变化的数据
- 实现API响应缓存

## 测试策略

### 单元测试

使用Jest进行组件和函数的单元测试。

```javascript
// 组件测试示例
describe('HelloWorld.vue', () => {
  it('renders props.msg when passed', () => {
    const msg = 'new message'
    const wrapper = shallowMount(HelloWorld, {
      propsData: { msg }
    })
    expect(wrapper.text()).toMatch(msg)
  })
})
```

### 集成测试

测试多个组件或模块之间的交互。

### 测试覆盖率

运行`npm run test:coverage`查看测试覆盖率报告。

## 部署流程

### 构建生产版本

```bash
npm run build
```

### 部署选项

1. **Nginx部署**
   - 配置Nginx代理静态文件
   - 设置反向代理到API服务器

2. **Docker部署**
   - 使用Dockerfile构建镜像
   - 配置docker-compose.yml

3. **CI/CD**
   - 使用GitHub Actions自动化部署
   - 配置`.github/workflows/ci-cd.yml`

### 环境变量配置

在`config/`目录下配置不同环境的变量。

```javascript
// config/prod.env.js
module.exports = {
  NODE_ENV: 'production',
  API_BASE_URL: 'https://api.heikeji.com'
}
```