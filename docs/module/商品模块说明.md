# 商品模块功能说明

## 功能概述

商品模块是黑科易购项目的核心模块之一，负责商品信息的展示、查询、库存管理等功能。本模块主要提供以下功能：

- 商品列表展示（支持分页、分类筛选、关键词搜索）
- 商品详情查看
- 热门商品推荐
- 商品库存校验与管理
- 商品批量查询
- 热词推荐功能（包括热门搜索词、搜索建议等）

## 主要文件结构

### 后端代码

#### 服务层
- **ProductService.java** - 商品服务接口定义
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/service/ProductService.java`
  - 主要方法：获取商品详情、批量获取商品、库存扣减与恢复、库存校验

- **ProductServiceImpl.java** - 商品服务实现类
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/service/impl/ProductServiceImpl.java`
  - 实现了所有商品服务接口，包含库存管理的事务处理

- **ProductHotWordService.java** - 商品热词服务接口定义
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/service/ProductHotWordService.java`
  - 主要方法：获取热门搜索词、获取首页展示热词、增加搜索词计数、获取搜索建议

- **ProductHotWordServiceImpl.java** - 商品热词服务实现类
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/service/impl/ProductHotWordServiceImpl.java`
  - 实现了所有热词服务接口，包含热词管理的核心逻辑

#### 实体类
- **Product.java** - 商品实体类
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/entity/Product.java`
  - 包含商品的基本信息字段

- **ProductHotWord.java** - 商品热词实体类
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/entity/ProductHotWord.java`
  - 包含热词的基本信息字段，如词内容、搜索次数、排序、首页显示状态等

#### 控制器
- **ProductController.java** - 商品控制器
  - 路径：`heikeji-mall-service/service-product/src/main/java/com/heikeji/mall/product/controller/ProductController.java`
  - 提供RESTful API接口，处理前端商品相关请求，包括商品搜索和热词推荐功能

### 前端页面

- **product-list.html** - 商品列表页面
  - 路径：`heikeji-app/src/main/resources/templates/product-list.html`（手机应用APP模板页面）
  - 实现商品展示、分页、搜索、分类筛选等功能

- **product-detail.html** - 商品详情页面
  - 路径：`heikeji-app/src/main/resources/templates/product-detail.html`（手机应用APP模板页面）
  - 展示商品详细信息、图片轮播、加入购物车、立即购买等功能

## API接口说明

### 1. 获取商品详情
- **URL**: `/app/product/detail/{productId}`
- **方法**: `GET`
- **参数**: `productId`（商品ID）
- **返回**: 商品详细信息
- **说明**: 手机应用APP端商品详情接口

### 2. 获取商品列表（分页）
- **URL**: `/app/product/list`
- **方法**: `GET`
- **参数**:
  - `page`（页码，默认1）
  - `limit`（每页数量，默认10）
  - `categoryId`（分类ID，可选）
  - `keyword`（搜索关键词，可选）
- **返回**: 分页商品列表
- **说明**: 手机应用APP端商品列表接口

### 3. 获取热门商品
- **URL**: `/app/product/hot`
- **方法**: `GET`
- **参数**: `limit`（数量限制，默认10）
- **返回**: 热门商品列表（按销量排序）
- **说明**: 手机应用APP端热门商品接口

### 4. 批量获取商品信息
- **URL**: `/app/product/batch`
- **方法**: `POST`
- **参数**: 商品ID列表（JSON格式）
- **返回**: 商品信息列表
- **说明**: 手机应用APP端批量获取商品接口

### 5. 获取热门搜索词
- **URL**: `/app/product/hotWords`
- **方法**: `GET`
- **参数**: `limit`（数量限制，默认10）
- **返回**: 热门搜索词列表（按搜索次数排序）
- **说明**: 手机应用APP端热门搜索词接口

### 6. 获取首页展示热词
- **URL**: `/app/product/homeHotWords`
- **方法**: `GET`
- **参数**: `limit`（数量限制，默认10）
- **返回**: 首页展示热词列表
- **说明**: 手机应用APP端首页展示热词接口

### 7. 获取搜索建议
- **URL**: `/app/product/searchSuggestions`
- **方法**: `GET`
- **参数**:
  - `keyword`（搜索关键词）
  - `limit`（数量限制，默认10）
- **返回**: 搜索建议列表
- **说明**: 手机应用APP端搜索建议接口

## 核心功能实现

### 1. 商品展示与搜索

商品列表页面提供了丰富的筛选和搜索功能：
- 支持关键词搜索（商品名称、副标题）
- 支持分类筛选
- 支持多种排序方式（默认、销量、价格升降序、最新上架）
- 分页展示，每页展示12个商品

### 2. 商品详情展示

商品详情页面包含：
- 商品主图与缩略图轮播
- 商品基本信息（名称、副标题、价格、销量、库存）
- 购买数量选择
- 加入购物车和立即购买功能
- 商品详细描述

### 3. 库存管理

商品服务实现了完整的库存管理功能：
- 库存扣减（下单时）
- 库存恢复（取消订单时）
- 库存充足性校验
- 所有库存操作都包含在事务中，确保数据一致性

### 4. 热词推荐功能

商品搜索功能实现了完整的热词推荐系统：
- 自动记录用户搜索的关键词，并统计搜索次数
- 热门搜索词按搜索次数排序，展示最受关注的商品关键词
- 支持首页热词展示功能，可配置特定热词在首页显示
- 提供搜索建议功能，根据用户输入的关键词前缀返回相关热词
- 自动处理新搜索词的添加和旧搜索词的状态管理

### 5. 数据安全性

- 商品查询时自动过滤已删除和下架的商品
- 库存操作有严格的校验逻辑，防止超卖
- 使用事务管理确保库存数据的一致性
- 热词状态管理确保只有有效热词被展示

## 使用说明

### 前端访问路径
- 商品列表：`/app/product/list`
- 商品详情：`/app/product/detail?productId={商品ID}` 或 `/app/product/detail/{商品ID}`

### 接口调用示例

#### 获取商品列表
```javascript
$.ajax({
    url: '/app/product/list',
    type: 'GET',
    data: {
        page: 1,
        limit: 12,
        keyword: '手机',
        categoryId: 1
    },
    success: function(res) {
        if (res.code === 200) {
            // 处理返回的商品数据
        }
    }
});
```

#### 加入购物车
```javascript
$.ajax({
    url: '/app/cart/add',
    type: 'POST',
    data: {
        productId: 1,
        quantity: 2
    },
    success: function(res) {
        if (res.code === 200) {
            alert('添加成功');
        }
    }
});
```

## 后续优化方向

1. **商品分类功能完善**：添加商品分类管理功能，支持多级分类
2. **商品评价系统**：实现商品评价和评分功能
3. **商品推荐算法**：基于用户行为和商品属性实现个性化推荐
4. **商品属性规格**：支持商品多规格、多属性选择
5. **库存预警**：添加库存预警功能，当库存低于阈值时提醒商家
6. **热词推荐算法优化**：基于用户行为和商品属性实现个性化热词推荐
7. **搜索建议功能增强**：结合商品名称和热词提供更全面的搜索建议
8. **热词管理后台**：提供热词的人工管理功能，支持手动添加、删除和调整热词

## 注意事项

1. 前端页面依赖jQuery和Bootstrap，请确保相关资源已正确引入
2. 商品图片URL需要根据实际部署环境进行配置
3. 库存扣减操作需要在事务中执行，确保原子性
4. 分页查询参数可根据实际需求调整，避免一次性加载过多数据