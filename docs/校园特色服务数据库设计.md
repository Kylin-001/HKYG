# 黑科易购校园服务平台数据库设计文档

## 1. 数据库设计概述

本文档详细描述黑科易购校园服务平台的数据库设计，基于微服务架构，为支持黑龙江科技大学特色的校园服务功能提供数据基础。设计遵循高内聚、低耦合原则，并充分考虑了性能、扩展性和安全性。

### 1.1 设计目标

- 支持校园特色服务，包括食堂外卖、快递代取、二手市场、失物招领等功能
- 提供良好的性能和扩展性，适应高并发访问
- 确保数据一致性和完整性
- 支持数据安全和隐私保护
- 便于后续功能扩展和维护

### 1.2 数据库选型

- **主数据库**: MySQL 8.3.x
  - 成熟稳定，社区支持广泛
  - 支持事务、外键约束等关系型数据库特性
  - 性能优化空间大，扩展性好
  - 对复杂查询支持良好

- **缓存数据库**: Redis 7.2.x
  - 用于缓存热点数据、会话状态和消息队列
  - 提升系统响应速度

- **搜索引擎数据库**: Elasticsearch 8.x
  - 用于全文搜索，支持公告、二手市场、失物招领等模块的搜索功能

### 1.3 数据库分片与分表策略

- **垂直分库**: 按照业务模块划分数据库
  - 用户库：存储用户相关数据
  - 商品库：存储商品相关数据
  - 订单库：存储订单相关数据
  - 校园服务库：存储校园特色服务数据
  - 社区库：存储社区服务相关数据

- **水平分表**: 针对大数据量表进行分表
  - 订单表：按时间范围分表
  - 日志表：按时间范围分表
  - 用户行为表：按用户ID取模分表

## 2. 核心数据表结构设计

### 2.1 用户模块数据表

#### 2.1.1 校园用户表 (campus_user)

```sql
CREATE TABLE `campus_user` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` varchar(50) NOT NULL COMMENT '用户名',
  `password` varchar(255) NOT NULL COMMENT '密码(加密存储)',
  `student_id` varchar(20) DEFAULT NULL COMMENT '学号',
  `real_name` varchar(50) DEFAULT NULL COMMENT '真实姓名',
  `phone` varchar(20) NOT NULL COMMENT '手机号',
  `email` varchar(100) DEFAULT NULL COMMENT '邮箱',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `gender` tinyint DEFAULT 0 COMMENT '性别(0:未知,1:男,2:女)',
  `college` varchar(100) DEFAULT NULL COMMENT '学院',
  `major` varchar(100) DEFAULT NULL COMMENT '专业',
  `class_name` varchar(100) DEFAULT NULL COMMENT '班级',
  `dormitory` varchar(50) DEFAULT NULL COMMENT '宿舍(如:东区10号楼315)',
  `user_type` tinyint NOT NULL DEFAULT 1 COMMENT '用户类型(1:学生,2:教职工,3:商家,4:配送员,5:管理员)',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:禁用,1:启用)',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_student_id` (`student_id`),
  UNIQUE KEY `uk_phone` (`phone`),
  KEY `idx_user_type` (`user_type`),
  KEY `idx_college` (`college`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='校园用户表';
```

#### 2.1.2 校园地址表 (campus_address)

```sql
CREATE TABLE `campus_address` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '地址ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `consignee` varchar(50) NOT NULL COMMENT '收货人姓名',
  `phone` varchar(20) NOT NULL COMMENT '收货手机号',
  `province` varchar(50) NOT NULL COMMENT '省份',
  `city` varchar(50) NOT NULL COMMENT '城市',
  `district` varchar(50) NOT NULL COMMENT '区/县',
  `detail_address` varchar(255) NOT NULL COMMENT '详细地址',
  `campus_area` varchar(50) DEFAULT NULL COMMENT '校园区域(如:东区,西区,南区,北区)',
  `building` varchar(50) DEFAULT NULL COMMENT '楼栋(如:10号楼)',
  `floor` varchar(20) DEFAULT NULL COMMENT '楼层(如:3楼)',
  `room` varchar(20) DEFAULT NULL COMMENT '房间号(如:315)',
  `latitude` double DEFAULT NULL COMMENT '纬度',
  `longitude` double DEFAULT NULL COMMENT '经度',
  `is_default` tinyint NOT NULL DEFAULT 0 COMMENT '是否默认地址(0:否,1:是)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_campus_area` (`campus_area`),
  KEY `idx_building` (`building`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='校园地址表';
```

#### 2.1.3 商家信息表 (merchant_info)

```sql
CREATE TABLE `merchant_info` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '商家ID',
  `user_id` bigint NOT NULL COMMENT '关联用户ID',
  `merchant_name` varchar(100) NOT NULL COMMENT '商家名称',
  `business_license` varchar(255) DEFAULT NULL COMMENT '营业执照图片URL',
  `contact_person` varchar(50) DEFAULT NULL COMMENT '联系人',
  `contact_phone` varchar(20) DEFAULT NULL COMMENT '联系电话',
  `business_scope` varchar(255) DEFAULT NULL COMMENT '经营范围',
  `address` varchar(255) DEFAULT NULL COMMENT '商家地址',
  `rating` decimal(2,1) DEFAULT '0.0' COMMENT '评分(0-5分)',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '审核状态(0:待审核,1:审核通过,2:审核拒绝)',
  `reject_reason` varchar(255) DEFAULT NULL COMMENT '拒绝原因',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_rating` (`rating`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='商家信息表';
```

#### 2.1.4 配送员信息表 (deliveryman_info)

```sql
CREATE TABLE `deliveryman_info` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '配送员ID',
  `user_id` bigint NOT NULL COMMENT '关联用户ID',
  `id_card_number` varchar(50) DEFAULT NULL COMMENT '身份证号',
  `id_card_front_photo` varchar(255) DEFAULT NULL COMMENT '身份证正面照URL',
  `id_card_back_photo` varchar(255) DEFAULT NULL COMMENT '身份证反面照URL',
  `health_certificate` varchar(255) DEFAULT NULL COMMENT '健康证URL',
  `avg_delivery_time` decimal(5,1) DEFAULT '0.0' COMMENT '平均配送时间(分钟)',
  `completion_rate` decimal(5,2) DEFAULT '100.00' COMMENT '完成率(%)',
  `rating` decimal(2,1) DEFAULT '5.0' COMMENT '评分(0-5分)',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '审核状态(0:待审核,1:审核通过,2:审核拒绝)',
  `reject_reason` varchar(255) DEFAULT NULL COMMENT '拒绝原因',
  `current_status` tinyint NOT NULL DEFAULT 0 COMMENT '当前状态(0:离线,1:在线,2:配送中)',
  `latitude` double DEFAULT NULL COMMENT '当前纬度',
  `longitude` double DEFAULT NULL COMMENT '当前经度',
  `last_location_update` datetime DEFAULT NULL COMMENT '最后位置更新时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_current_status` (`current_status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='配送员信息表';
```

### 2.2 商品模块数据表

#### 2.2.1 商品分类表 (product_category)

```sql
CREATE TABLE `product_category` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '分类ID',
  `name` varchar(50) NOT NULL COMMENT '分类名称',
  `parent_id` bigint DEFAULT 0 COMMENT '父分类ID(0表示根分类)',
  `level` tinyint NOT NULL DEFAULT 1 COMMENT '分类级别(1:一级分类,2:二级分类,3:三级分类)',
  `sort_order` int NOT NULL DEFAULT 0 COMMENT '排序号',
  `icon` varchar(255) DEFAULT NULL COMMENT '分类图标',
  `type` tinyint NOT NULL DEFAULT 0 COMMENT '分类类型(0:普通商品,1:食堂外卖,2:二手商品)',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:禁用,1:启用)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_parent_id` (`parent_id`),
  KEY `idx_type` (`type`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='商品分类表';
```

#### 2.2.2 商品信息表 (product_info)

```sql
CREATE TABLE `product_info` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '商品ID',
  `merchant_id` bigint NOT NULL COMMENT '商家ID',
  `category_id` bigint NOT NULL COMMENT '分类ID',
  `name` varchar(255) NOT NULL COMMENT '商品名称',
  `description` text COMMENT '商品描述',
  `original_price` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '原价',
  `current_price` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '现价',
  `stock` int NOT NULL DEFAULT 0 COMMENT '库存',
  `sales` int NOT NULL DEFAULT 0 COMMENT '销量',
  `rating` decimal(2,1) DEFAULT '5.0' COMMENT '评分(0-5分)',
  `cover_image` varchar(255) DEFAULT NULL COMMENT '封面图片URL',
  `detail_images` text COMMENT '详情图片URL(逗号分隔)',
  `weight` decimal(10,2) DEFAULT NULL COMMENT '重量(kg)',
  `volume` decimal(10,2) DEFAULT NULL COMMENT '体积(m³)',
  `is_free_shipping` tinyint NOT NULL DEFAULT 0 COMMENT '是否包邮(0:否,1:是)',
  `shipping_fee` decimal(10,2) DEFAULT '0.00' COMMENT '运费',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:下架,1:上架)',
  `is_hot` tinyint NOT NULL DEFAULT 0 COMMENT '是否热门(0:否,1:是)',
  `is_new` tinyint NOT NULL DEFAULT 0 COMMENT '是否新品(0:否,1:是)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_merchant_id` (`merchant_id`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_status` (`status`),
  KEY `idx_is_hot` (`is_hot`),
  KEY `idx_is_new` (`is_new`),
  KEY `idx_sales` (`sales`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='商品信息表';
```

#### 2.2.3 商品SKU表 (product_sku)

```sql
CREATE TABLE `product_sku` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'SKU ID',
  `product_id` bigint NOT NULL COMMENT '商品ID',
  `spec_values` varchar(255) NOT NULL COMMENT '规格值(如:颜色:红色,尺码:L)',
  `price` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '价格',
  `stock` int NOT NULL DEFAULT 0 COMMENT '库存',
  `sku_code` varchar(100) DEFAULT NULL COMMENT 'SKU编码',
  `barcode` varchar(100) DEFAULT NULL COMMENT '条形码',
  `image` varchar(255) DEFAULT NULL COMMENT 'SKU图片URL',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:禁用,1:启用)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_status` (`status`),
  KEY `idx_sku_code` (`sku_code`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='商品SKU表';
```

### 2.3 订单模块数据表

#### 2.3.1 订单主表 (order_master)

```sql
CREATE TABLE `order_master` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `order_sn` varchar(50) NOT NULL COMMENT '订单编号',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `merchant_id` bigint NOT NULL COMMENT '商家ID',
  `address_id` bigint NOT NULL COMMENT '收货地址ID',
  `deliveryman_id` bigint DEFAULT NULL COMMENT '配送员ID',
  `order_type` tinyint NOT NULL DEFAULT 1 COMMENT '订单类型(1:普通商品,2:食堂外卖,3:快递代取,4:二手交易)',
  `total_amount` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '订单总金额',
  `actual_amount` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '实际支付金额',
  `shipping_fee` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '运费',
  `payment_type` tinyint DEFAULT NULL COMMENT '支付方式(1:微信支付,2:支付宝,3:校园卡)',
  `payment_status` tinyint NOT NULL DEFAULT 0 COMMENT '支付状态(0:未支付,1:已支付,2:支付失败,3:退款中,4:已退款)',
  `order_status` tinyint NOT NULL DEFAULT 0 COMMENT '订单状态(0:待支付,1:待接单,2:待发货,3:待收货,4:已完成,5:已取消,6:已拒绝)',
  `delivery_status` tinyint DEFAULT 0 COMMENT '配送状态(0:未开始,1:配送中,2:已送达)',
  `remark` varchar(255) DEFAULT NULL COMMENT '订单备注',
  `payment_time` datetime DEFAULT NULL COMMENT '支付时间',
  `delivery_time` datetime DEFAULT NULL COMMENT '发货时间',
  `receive_time` datetime DEFAULT NULL COMMENT '收货时间',
  `cancel_time` datetime DEFAULT NULL COMMENT '取消时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_sn` (`order_sn`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_merchant_id` (`merchant_id`),
  KEY `idx_order_status` (`order_status`),
  KEY `idx_payment_status` (`payment_status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='订单主表';
```

#### 2.3.2 订单详情表 (order_item)

```sql
CREATE TABLE `order_item` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '订单明细ID',
  `order_id` bigint NOT NULL COMMENT '订单ID',
  `product_id` bigint NOT NULL COMMENT '商品ID',
  `sku_id` bigint DEFAULT NULL COMMENT 'SKU ID',
  `product_name` varchar(255) NOT NULL COMMENT '商品名称',
  `product_image` varchar(255) DEFAULT NULL COMMENT '商品图片URL',
  `spec_values` varchar(255) DEFAULT NULL COMMENT '规格值',
  `price` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '商品单价',
  `quantity` int NOT NULL DEFAULT 0 COMMENT '商品数量',
  `total_amount` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '商品总价',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_sku_id` (`sku_id`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='订单详情表';
```

#### 2.3.3 订单日志表 (order_log)

```sql
CREATE TABLE `order_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `order_id` bigint NOT NULL COMMENT '订单ID',
  `order_sn` varchar(50) NOT NULL COMMENT '订单编号',
  `operator_type` tinyint NOT NULL COMMENT '操作人类型(1:用户,2:商家,3:配送员,4:系统)',
  `operator_id` bigint NOT NULL COMMENT '操作人ID',
  `action` varchar(50) NOT NULL COMMENT '操作类型(如:创建订单,支付,发货,收货等)',
  `old_status` tinyint DEFAULT NULL COMMENT '原状态',
  `new_status` tinyint DEFAULT NULL COMMENT '新状态',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `ip` varchar(50) DEFAULT NULL COMMENT '操作IP',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_order_sn` (`order_sn`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='订单日志表';
```

### 2.4 外卖服务模块数据表

#### 2.4.1 食堂信息表 (campus_canteen)

```sql
CREATE TABLE `campus_canteen` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '食堂ID',
  `name` varchar(100) NOT NULL COMMENT '食堂名称',
  `location` varchar(255) NOT NULL COMMENT '位置',
  `description` text COMMENT '描述',
  `opening_hours` varchar(255) DEFAULT NULL COMMENT '营业时间',
  `contact_phone` varchar(20) DEFAULT NULL COMMENT '联系电话',
  `image_url` varchar(255) DEFAULT NULL COMMENT '食堂图片URL',
  `rating` decimal(2,1) DEFAULT '5.0' COMMENT '评分(0-5分)',
  `avg_waiting_time` int DEFAULT 0 COMMENT '平均等待时间(分钟)',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:关闭,1:营业中)',
  `latitude` double DEFAULT NULL COMMENT '纬度',
  `longitude` double DEFAULT NULL COMMENT '经度',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_status` (`status`),
  KEY `idx_rating` (`rating`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='食堂信息表';
```

#### 2.4.2 食堂档口表 (canteen_stall)

```sql
CREATE TABLE `canteen_stall` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '档口ID',
  `canteen_id` bigint NOT NULL COMMENT '所属食堂ID',
  `merchant_id` bigint DEFAULT NULL COMMENT '关联商家ID(如果由外部商家经营)',
  `name` varchar(100) NOT NULL COMMENT '档口名称',
  `stall_number` varchar(50) DEFAULT NULL COMMENT '档口编号',
  `description` text COMMENT '描述',
  `business_hours` varchar(255) DEFAULT NULL COMMENT '营业时段',
  `category` varchar(50) DEFAULT NULL COMMENT '经营品类(如:快餐,面食,麻辣烫等)',
  `rating` decimal(2,1) DEFAULT '5.0' COMMENT '评分(0-5分)',
  `avg_prepare_time` int DEFAULT 0 COMMENT '平均备餐时间(分钟)',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:休息,1:营业中)',
  `delivery_fee` decimal(10,2) DEFAULT '0.00' COMMENT '配送费',
  `min_order_amount` decimal(10,2) DEFAULT '0.00' COMMENT '起送价',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_canteen_id` (`canteen_id`),
  KEY `idx_merchant_id` (`merchant_id`),
  KEY `idx_status` (`status`),
  KEY `idx_category` (`category`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='食堂档口表';
```

#### 2.4.3 外卖订单表 (takeout_order)

```sql
CREATE TABLE `takeout_order` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '外卖订单ID',
  `order_id` bigint NOT NULL COMMENT '关联订单主表ID',
  `canteen_id` bigint NOT NULL COMMENT '食堂ID',
  `stall_id` bigint NOT NULL COMMENT '档口ID',
  `pickup_code` varchar(20) DEFAULT NULL COMMENT '取餐码',
  `is_insulated` tinyint NOT NULL DEFAULT 0 COMMENT '是否需要保温(0:否,1:是)',
  `expected_pickup_time` datetime DEFAULT NULL COMMENT '预计取餐时间',
  `actual_pickup_time` datetime DEFAULT NULL COMMENT '实际取餐时间',
  `expected_delivery_time` datetime DEFAULT NULL COMMENT '预计送达时间',
  `cooking_status` tinyint NOT NULL DEFAULT 0 COMMENT '烹饪状态(0:未开始,1:烹饪中,2:已完成)',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注信息',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_id` (`order_id`),
  KEY `idx_canteen_id` (`canteen_id`),
  KEY `idx_stall_id` (`stall_id`),
  KEY `idx_pickup_code` (`pickup_code`),
  KEY `idx_cooking_status` (`cooking_status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='外卖订单表';
```

### 2.5 配送服务模块数据表

#### 2.5.1 快递代取订单表 (express_order)

```sql
CREATE TABLE `express_order` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '快递代取订单ID',
  `order_id` bigint NOT NULL COMMENT '关联订单主表ID',
  `express_company` varchar(50) NOT NULL COMMENT '快递公司',
  `tracking_number` varchar(100) NOT NULL COMMENT '快递单号',
  `pickup_location` varchar(255) NOT NULL COMMENT '取件地点',
  `pickup_code` varchar(50) DEFAULT NULL COMMENT '取件码',
  `delivery_location` varchar(255) NOT NULL COMMENT '送达地点',
  `express_type` tinyint DEFAULT 1 COMMENT '快递类型(1:普通快递,2:外卖,3:文件,4:其他)',
  `weight` decimal(5,2) DEFAULT NULL COMMENT '重量(kg)',
  `size` varchar(50) DEFAULT NULL COMMENT '尺寸',
  `fee` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '代取费用',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(1:待接单,2:已接单,3:已取件,4:已送达,5:已完成,6:已取消)',
  `pickup_time` datetime DEFAULT NULL COMMENT '取件时间',
  `delivery_time` datetime DEFAULT NULL COMMENT '送达时间',
  `notes` varchar(255) DEFAULT NULL COMMENT '备注信息',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_id` (`order_id`),
  KEY `idx_tracking_number` (`tracking_number`),
  KEY `idx_status` (`status`),
  KEY `idx_pickup_location` (`pickup_location`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='快递代取订单表';
```

#### 2.5.2 配送路线表 (delivery_route)

```sql
CREATE TABLE `delivery_route` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '路线ID',
  `name` varchar(100) NOT NULL COMMENT '路线名称',
  `start_point` varchar(255) NOT NULL COMMENT '起点',
  `end_point` varchar(255) NOT NULL COMMENT '终点',
  `start_latitude` double NOT NULL COMMENT '起点纬度',
  `start_longitude` double NOT NULL COMMENT '起点经度',
  `end_latitude` double NOT NULL COMMENT '终点纬度',
  `end_longitude` double NOT NULL COMMENT '终点经度',
  `distance` decimal(10,2) NOT NULL COMMENT '距离(米)',
  `estimated_time` int NOT NULL COMMENT '预计时间(分钟)',
  `route_data` text COMMENT '路线数据(JSON格式)',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:禁用,1:启用)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_start_point` (`start_point`),
  KEY `idx_end_point` (`end_point`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='配送路线表';
```

#### 2.5.3 配送轨迹表 (delivery_track)

```sql
CREATE TABLE `delivery_track` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '轨迹ID',
  `order_id` bigint NOT NULL COMMENT '订单ID',
  `deliveryman_id` bigint NOT NULL COMMENT '配送员ID',
  `latitude` double NOT NULL COMMENT '纬度',
  `longitude` double NOT NULL COMMENT '经度',
  `speed` decimal(8,2) DEFAULT NULL COMMENT '速度(km/h)',
  `direction` decimal(6,2) DEFAULT NULL COMMENT '方向(度)',
  `location_desc` varchar(255) DEFAULT NULL COMMENT '位置描述',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '记录时间',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_deliveryman_id` (`deliveryman_id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='配送轨迹表';
```

### 2.6 校园服务模块数据表

#### 2.6.1 校园建筑表 (campus_building)

```sql
CREATE TABLE `campus_building` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '建筑ID',
  `name` varchar(100) NOT NULL COMMENT '建筑名称',
  `type` tinyint NOT NULL COMMENT '建筑类型(1:教学楼,2:宿舍楼,3:食堂,4:图书馆,5:办公楼,6:体育馆,7:其他)',
  `area` varchar(50) DEFAULT NULL COMMENT '所属区域(如:东区,西区,南区,北区)',
  `description` text COMMENT '描述',
  `image_url` varchar(255) DEFAULT NULL COMMENT '图片URL',
  `latitude` double NOT NULL COMMENT '纬度',
  `longitude` double NOT NULL COMMENT '经度',
  `floor_count` int DEFAULT 0 COMMENT '楼层数',
  `opening_hours` varchar(255) DEFAULT NULL COMMENT '开放时间',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:禁用,1:启用)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_type` (`type`),
  KEY `idx_area` (`area`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='校园建筑表';
```

#### 2.6.2 校园公告表 (campus_notice)

```sql
CREATE TABLE `campus_notice` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '公告ID',
  `title` varchar(255) NOT NULL COMMENT '公告标题',
  `content` longtext NOT NULL COMMENT '公告内容',
  `publisher` varchar(50) NOT NULL COMMENT '发布人',
  `publisher_id` bigint DEFAULT NULL COMMENT '发布人ID',
  `category` varchar(50) DEFAULT NULL COMMENT '公告分类(如:通知,活动,招聘等)',
  `importance` tinyint NOT NULL DEFAULT 0 COMMENT '重要程度(0:普通,1:重要,2:紧急)',
  `attachment_url` varchar(255) DEFAULT NULL COMMENT '附件URL',
  `view_count` int NOT NULL DEFAULT 0 COMMENT '浏览次数',
  `publish_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发布时间',
  `expire_time` datetime DEFAULT NULL COMMENT '过期时间',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:草稿,1:已发布,2:已下线)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_category` (`category`),
  KEY `idx_importance` (`importance`),
  KEY `idx_publish_time` (`publish_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='校园公告表';
```

#### 2.6.3 校园活动表 (campus_activity)

```sql
CREATE TABLE `campus_activity` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '活动ID',
  `title` varchar(255) NOT NULL COMMENT '活动标题',
  `description` text COMMENT '活动描述',
  `organizer` varchar(100) DEFAULT NULL COMMENT '组织者',
  `organizer_id` bigint DEFAULT NULL COMMENT '组织者ID',
  `location` varchar(255) DEFAULT NULL COMMENT '活动地点',
  `start_time` datetime NOT NULL COMMENT '开始时间',
  `end_time` datetime NOT NULL COMMENT '结束时间',
  `signup_start_time` datetime DEFAULT NULL COMMENT '报名开始时间',
  `signup_end_time` datetime DEFAULT NULL COMMENT '报名结束时间',
  `max_participants` int DEFAULT NULL COMMENT '最大参与人数',
  `current_participants` int NOT NULL DEFAULT 0 COMMENT '当前参与人数',
  `cover_image` varchar(255) DEFAULT NULL COMMENT '封面图片URL',
  `detail_images` text COMMENT '详情图片URL(逗号分隔)',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '状态(0:草稿,1:已发布,2:进行中,3:已结束,4:已取消)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_start_time` (`start_time`),
  KEY `idx_status` (`status`),
  KEY `idx_organizer_id` (`organizer_id`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='校园活动表';
```

### 2.7 社区服务模块数据表

#### 2.7.1 二手商品表 (secondhand_item)

```sql
CREATE TABLE `secondhand_item` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '二手商品ID',
  `user_id` bigint NOT NULL COMMENT '发布用户ID',
  `category_id` bigint NOT NULL COMMENT '分类ID',
  `title` varchar(255) NOT NULL COMMENT '商品标题',
  `description` text COMMENT '商品描述',
  `price` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '价格',
  `original_price` decimal(10,2) DEFAULT NULL COMMENT '原价',
  `condition` tinyint NOT NULL COMMENT '成色(1:全新,2:几乎全新,3:轻微使用,4:正常使用,5:明显使用痕迹)',
  `location` varchar(255) DEFAULT NULL COMMENT '交易地点',
  `cover_image` varchar(255) DEFAULT NULL COMMENT '封面图片URL',
  `detail_images` text COMMENT '详情图片URL(逗号分隔)',
  `view_count` int NOT NULL DEFAULT 0 COMMENT '浏览次数',
  `favorite_count` int NOT NULL DEFAULT 0 COMMENT '收藏次数',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(1:在售,2:已售出,3:已下架,4:已删除)',
  `publish_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发布时间',
  `sold_time` datetime DEFAULT NULL COMMENT '售出时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_status` (`status`),
  KEY `idx_view_count` (`view_count`),
  KEY `idx_price` (`price`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='二手商品表';
```

#### 2.7.2 二手交易订单表 (secondhand_order)

```sql
CREATE TABLE `secondhand_order` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '二手交易订单ID',
  `order_id` bigint NOT NULL COMMENT '关联订单主表ID',
  `item_id` bigint NOT NULL COMMENT '二手商品ID',
  `seller_id` bigint NOT NULL COMMENT '卖家ID',
  `buyer_id` bigint NOT NULL COMMENT '买家ID',
  `transaction_type` tinyint NOT NULL DEFAULT 1 COMMENT '交易类型(1:线上支付线下交易,2:线下交易)',
  `meeting_place` varchar(255) DEFAULT NULL COMMENT '约定交易地点',
  `meeting_time` datetime DEFAULT NULL COMMENT '约定交易时间',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(1:待付款,2:待交易,3:交易中,4:已完成,5:已取消,6:已退款)',
  `transaction_time` datetime DEFAULT NULL COMMENT '交易完成时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_id` (`order_id`),
  KEY `idx_item_id` (`item_id`),
  KEY `idx_seller_id` (`seller_id`),
  KEY `idx_buyer_id` (`buyer_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='二手交易订单表';
```

#### 2.7.3 失物招领表 (lost_found)

```sql
CREATE TABLE `lost_found` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '失物招领ID',
  `user_id` bigint NOT NULL COMMENT '发布用户ID',
  `type` tinyint NOT NULL COMMENT '类型(1:失物,2:招领)',
  `category` varchar(50) DEFAULT NULL COMMENT '物品类别(如:证件,电子设备,衣物,钱包等)',
  `title` varchar(255) NOT NULL COMMENT '标题',
  `description` text COMMENT '描述',
  `location` varchar(255) NOT NULL COMMENT '丢失/发现地点',
  `occur_time` datetime DEFAULT NULL COMMENT '丢失/发现时间',
  `contact_person` varchar(50) DEFAULT NULL COMMENT '联系人',
  `contact_phone` varchar(20) DEFAULT NULL COMMENT '联系电话',
  `image_url` varchar(255) DEFAULT NULL COMMENT '图片URL',
  `view_count` int NOT NULL DEFAULT 0 COMMENT '浏览次数',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(1:进行中,2:已解决,3:已下架,4:已删除)',
  `publish_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '发布时间',
  `solve_time` datetime DEFAULT NULL COMMENT '解决时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_type` (`type`),
  KEY `idx_category` (`category`),
  KEY `idx_location` (`location`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='失物招领表';
```

### 2.8 系统通用表

#### 2.8.1 支付记录表 (payment_record)

```sql
CREATE TABLE `payment_record` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '支付记录ID',
  `order_id` bigint NOT NULL COMMENT '订单ID',
  `order_sn` varchar(50) NOT NULL COMMENT '订单编号',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `amount` decimal(10,2) NOT NULL DEFAULT '0.00' COMMENT '支付金额',
  `payment_type` tinyint NOT NULL COMMENT '支付方式(1:微信支付,2:支付宝,3:校园卡)',
  `trade_no` varchar(100) DEFAULT NULL COMMENT '交易流水号',
  `payment_status` tinyint NOT NULL DEFAULT 0 COMMENT '支付状态(0:待支付,1:支付成功,2:支付失败,3:退款中,4:已退款)',
  `transaction_time` datetime DEFAULT NULL COMMENT '交易时间',
  `callback_data` text COMMENT '回调数据',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_order_sn` (`order_sn`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_payment_status` (`payment_status`),
  KEY `idx_trade_no` (`trade_no`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='支付记录表';
```

#### 2.8.2 评价表 (evaluation)

```sql
CREATE TABLE `evaluation` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '评价ID',
  `user_id` bigint NOT NULL COMMENT '评价用户ID',
  `target_id` bigint NOT NULL COMMENT '评价对象ID(商品ID/商家ID/订单ID等)',
  `target_type` tinyint NOT NULL COMMENT '评价对象类型(1:商品,2:商家,3:订单,4:配送员)',
  `rating` tinyint NOT NULL COMMENT '评分(1-5分)',
  `content` text COMMENT '评价内容',
  `image_urls` text COMMENT '图片URL(逗号分隔)',
  `video_url` varchar(255) DEFAULT NULL COMMENT '视频URL',
  `reply_content` text COMMENT '回复内容',
  `reply_time` datetime DEFAULT NULL COMMENT '回复时间',
  `anonymous` tinyint NOT NULL DEFAULT 0 COMMENT '是否匿名(0:否,1:是)',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态(0:禁用,1:启用)',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_target_id` (`target_id`),
  KEY `idx_target_type` (`target_type`),
  KEY `idx_rating` (`rating`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='评价表';
```

#### 2.8.3 消息通知表 (notification)

```sql
CREATE TABLE `notification` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '通知ID',
  `user_id` bigint NOT NULL COMMENT '接收用户ID',
  `sender_id` bigint DEFAULT NULL COMMENT '发送者ID',
  `type` tinyint NOT NULL COMMENT '通知类型(1:系统通知,2:订单通知,3:活动通知,4:私信,5:评论回复)',
  `title` varchar(255) NOT NULL COMMENT '通知标题',
  `content` text NOT NULL COMMENT '通知内容',
  `target_url` varchar(255) DEFAULT NULL COMMENT '跳转URL',
  `is_read` tinyint NOT NULL DEFAULT 0 COMMENT '是否已读(0:未读,1:已读)',
  `read_time` datetime DEFAULT NULL COMMENT '阅读时间',
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_type` (`type`),
  KEY `idx_is_read` (`is_read`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=10000 COMMENT='消息通知表';
```

## 3. 数据库关系图

### 3.1 核心实体关系概述

```
+----------------+       +----------------+       +----------------+
|  campus_user   |<------| campus_address |       | merchant_info  |
+----------------+       +----------------+       +----------------+
        |                                                   |
        |                                                   |
        v                                                   v
+----------------+       +----------------+       +----------------+
|  order_master  |<------|   order_item   |       |  product_info  |
+----------------+       +----------------+       +----------------+
        |                                                   |
        |                                                   |
        v                                                   v
+----------------+       +----------------+       +----------------+
| payment_record |       |   express_order|<------|campus_canteen  |
+----------------+       +----------------+       +----------------+
        |                          |                       |
        |                          |                       |
        v                          v                       v
+----------------+       +----------------+       +----------------+
| notification   |       |delivery_route  |       |canteen_stall   |
+----------------+       +----------------+       +----------------+
                                 |                           |
                                 |                           |
                                 v                           v
                         +----------------+       +----------------+
                         |delivery_track  |       | takeout_order  |
                         +----------------+       +----------------+

+----------------+       +----------------+       +----------------+
|campus_activity |       |secondhand_item |       |   lost_found   |
+----------------+       +----------------+       +----------------+
                              |
                              |
                              v
                      +----------------+
                      |secondhand_order|
                      +----------------+
```

## 4. 索引设计策略

### 4.1 索引设计原则

- **主键索引**: 所有表都必须有主键，推荐使用自增整型ID
- **唯一索引**: 对唯一标识字段创建唯一索引，确保数据唯一性
- **查询索引**: 对常用查询条件的字段创建索引
- **外键索引**: 对外键字段创建索引，提高关联查询性能
- **复合索引**: 合理使用复合索引，遵循最左前缀原则
- **索引维护**: 定期分析索引使用情况，删除不必要的索引

### 4.2 高频查询字段索引

#### 4.2.1 用户相关
- `campus_user`: `username`, `phone`, `student_id`, `user_type`
- `campus_address`: `user_id`, `campus_area`, `building`

#### 4.2.2 商品相关
- `product_info`: `category_id`, `merchant_id`, `status`, `is_hot`, `is_new`, `sales`
- `product_sku`: `product_id`, `sku_code`

#### 4.2.3 订单相关
- `order_master`: `order_sn`, `user_id`, `merchant_id`, `order_status`, `payment_status`, `created_at`
- `order_item`: `order_id`, `product_id`, `sku_id`

#### 4.2.4 外卖相关
- `campus_canteen`: `status`, `rating`
- `canteen_stall`: `canteen_id`, `status`, `category`
- `takeout_order`: `canteen_id`, `stall_id`, `pickup_code`, `cooking_status`

#### 4.2.5 配送相关
- `express_order`: `tracking_number`, `status`, `pickup_location`
- `delivery_route`: `start_point`, `end_point`
- `delivery_track`: `order_id`, `deliveryman_id`, `created_at`

#### 4.2.6 校园服务相关
- `campus_building`: `type`, `area`, `status`
- `campus_notice`: `category`, `importance`, `publish_time`, `status`
- `campus_activity`: `start_time`, `status`, `organizer_id`

#### 4.2.7 社区服务相关
- `secondhand_item`: `user_id`, `category_id`, `status`, `view_count`, `price`
- `secondhand_order`: `item_id`, `seller_id`, `buyer_id`, `status`
- `lost_found`: `user_id`, `type`, `category`, `location`, `status`

## 5. 数据迁移策略

### 5.1 迁移准备工作

- **数据备份**: 迁移前对所有生产数据进行完整备份
- **迁移环境搭建**: 搭建与生产环境隔离的迁移环境
- **迁移脚本编写**: 编写数据迁移脚本，包括数据结构创建和数据导入
- **迁移验证方案**: 制定迁移后的数据验证方案
- **回滚计划**: 制定详细的迁移失败回滚计划

### 5.2 数据迁移步骤

1. **创建新表结构**: 在目标数据库中创建新的表结构
2. **编写数据转换脚本**: 根据新表结构编写数据转换脚本
3. **初始数据导入**: 导入基础数据和参考数据
4. **业务数据迁移**: 按模块顺序迁移业务数据
5. **数据验证**: 对比迁移前后的数据，确保数据一致性
6. **索引创建**: 迁移完成后创建索引，提高查询性能
7. **应用程序切换**: 切换应用程序连接到新数据库
8. **监控与调优**: 监控系统运行状况，进行必要的性能调优

### 5.3 数据迁移示例脚本

```sql
-- 示例：将用户数据从旧表迁移到新表
INSERT INTO campus_user (id, username, password, student_id, real_name, phone, email, avatar, gender, 
                       college, major, class_name, dormitory, user_type, status, created_at, updated_at)
SELECT id, username, password, student_code, full_name, mobile, email, avatar_url, 
       CASE WHEN sex = '男' THEN 1 WHEN sex = '女' THEN 2 ELSE 0 END, 
       department, specialty, class_name, dorm_room, 
       CASE WHEN role_id = 1 THEN 5 WHEN role_id = 2 THEN 1 WHEN role_id = 3 THEN 3 ELSE 1 END,
       CASE WHEN is_active = 1 THEN 1 ELSE 0 END,
       create_time, update_time
FROM old_user_table;

-- 迁移地址数据
INSERT INTO campus_address (id, user_id, consignee, phone, province, city, district, 
                          detail_address, campus_area, building, floor, room, 
                          latitude, longitude, is_default, created_at, updated_at)
SELECT id, user_id, receiver_name, receiver_phone, province, city, district, 
       address, 
       CASE 
           WHEN address LIKE '%东区%' THEN '东区'
           WHEN address LIKE '%西区%' THEN '西区'
           WHEN address LIKE '%南区%' THEN '南区'
           WHEN address LIKE '%北区%' THEN '北区'
           ELSE NULL 
       END,
       -- 从地址中提取楼栋信息，实际应用中可能需要更复杂的处理
       NULL, NULL, NULL,
       lat, lng,
       CASE WHEN is_default = 1 THEN 1 ELSE 0 END,
       create_time, update_time
FROM old_address_table;
```

## 6. 数据安全与隐私保护

### 6.1 敏感数据保护

- **用户密码**: 采用BCrypt加密存储
- **个人身份信息**: 身份证号、学号等敏感信息脱敏显示
- **支付信息**: 支付卡号等信息加密存储，禁止明文记录完整卡号
- **日志脱敏**: 系统日志中对敏感信息进行脱敏处理

### 6.2 访问控制

- **最小权限原则**: 数据库用户仅授予必要的权限
- **IP白名单**: 限制数据库访问IP
- **定期权限审计**: 定期审查数据库用户权限
- **数据库防火墙**: 部署数据库防火墙，防止SQL注入攻击

### 6.3 数据备份与恢复

- **定期备份**: 制定数据备份策略，定期进行全量和增量备份
- **异地备份**: 备份数据存储到异地，防止自然灾害
- **备份验证**: 定期验证备份数据的可用性
- **恢复演练**: 定期进行数据恢复演练，确保恢复流程有效

### 6.4 数据生命周期管理

- **数据归档**: 制定数据归档策略，将历史数据归档到归档数据库
- **数据清理**: 制定数据清理策略，定期清理过期数据
- **保留期限**: 根据法规要求设定数据保留期限

## 7. 性能优化建议

### 7.1 查询优化

- **避免全表扫描**: 确保查询条件有索引支持
- **合理使用JOIN**: 避免复杂JOIN操作，优化JOIN顺序
- **分页查询优化**: 使用LIMIT进行分页，避免大结果集
- **批量操作**: 使用批量插入和更新，减少数据库交互次数
- **使用索引覆盖**: 设计索引时考虑覆盖查询条件和排序字段

### 7.2 数据库参数优化

- **连接池设置**: 根据实际并发量调整连接池大小
- **缓存设置**: 优化InnoDB缓冲池大小
- **日志设置**: 调整日志缓冲区大小和刷盘策略
- **排序缓冲**: 根据实际查询调整排序缓冲区大小
- **临时表设置**: 优化临时表空间大小

### 7.3 读写分离

- **主从复制**: 配置MySQL主从复制
- **读写分离中间件**: 使用读写分离中间件（如ShardingSphere）
- **读操作分流**: 将读操作分发到从库，写操作发送到主库
- **延迟监控**: 监控主从延迟，必要时调整策略

### 7.4 分库分表

- **垂直分库**: 根据业务模块将表分散到不同数据库
- **水平分表**: 对大数据量表进行水平拆分
- **分表键选择**: 选择合适的分表键，确保数据均匀分布
- **分库分表中间件**: 使用分库分表中间件管理数据分片

---

本数据库设计文档为黑科易购校园服务平台提供了全面的数据结构支持，包括用户、商品、订单、外卖、配送、校园服务和社区服务等核心模块。通过合理的表结构设计、索引优化和数据迁移策略，确保系统能够高效、安全地支持黑龙江科技大学特色的校园服务功能。