# 黑科易购校园服务平台 - 快速开始指南

> **你的时间很宝贵，跑腿的事交给我们。**

## 1. 项目概述

黑科易购校园服务平台是专为黑龙江科技大学学生打造的校园综合性服务平台，整合购物、外卖、跑腿、信息服务等功能，让学生足不出户即可解决生活、学习所需。

## 2. 环境要求

### 2.1 必要环境
- **JDK 1.8+**：项目基于Java开发
- **Maven 3.6+**：项目构建工具
- **MySQL 8.0+**：关系型数据库
- **Redis 5.0+**：缓存数据库
- **Git**：版本控制工具

### 2.2 可选环境
- **Docker**：容器化部署（推荐）
- **Docker Compose**：多容器管理
- **Nginx**：反向代理服务器

## 3. 快速部署

### 3.1 方式一：Docker Compose 部署（推荐）

#### 3.1.1 克隆代码
```bash
git clone https://github.com/your-repo/heikeji-mall.git
cd heikeji-mall
```

#### 3.1.2 配置环境变量
复制环境变量示例文件并修改：

```bash
cp .env.example .env
```

根据实际情况修改 `.env` 文件中的配置，主要包括：
- 数据库连接信息
- Redis连接信息
- Nacos配置
- 端口配置

#### 3.1.3 启动服务

```bash
docker-compose up -d
```

该命令会启动所有服务，包括：
- MySQL数据库
- Redis缓存
- Nacos服务注册中心
- API网关
- 各业务服务
- 管理后台

#### 3.1.4 访问服务

| 服务名称 | 访问地址 | 说明 |
|----------|----------|------|
| API网关 | http://localhost:8080 | 所有API请求的入口 |
| 管理后台 | http://localhost:8081 | 管理员管理平台 |
| Swagger文档 | http://localhost:8888/swagger-ui.html | API接口文档 |
| Nacos控制台 | http://localhost:8848/nacos | 服务注册与配置中心 |

### 3.2 方式二：本地开发环境部署

#### 3.2.1 克隆代码

```bash
git clone https://github.com/your-repo/heikeji-mall.git
cd heikeji-mall
```

#### 3.2.2 初始化数据库

1. 创建数据库：

```bash
mysql -u root -p
CREATE DATABASE heikeji_mall DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 导入数据：

```bash
mysql -u root -p heikeji_mall < sql/full_db.sql
```

#### 3.2.3 配置文件修改

修改各服务模块下的 `src/main/resources/application.yml` 文件，配置数据库、Redis等信息。

主要修改内容：
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/heikeji_mall?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: your_password
  redis:
    host: localhost
    port: 6379
    password: 
    database: 0
```

#### 3.2.4 编译项目

```bash
mvn clean install
```

#### 3.2.5 启动服务

1. 启动Nacos服务注册中心（如果未使用Docker）

2. 启动各业务服务：

```bash
# 启动用户服务
cd heikeji-mall-service/service-user
mvn spring-boot:run

# 启动商品服务
cd ../service-product
mvn spring-boot:run

# 启动订单服务
cd ../service-order
mvn spring-boot:run

# 启动外卖服务
cd ../service-takeout
mvn spring-boot:run

# 启动支付服务
cd ../service-payment
mvn spring-boot:run

# 启动API网关
cd ../../heikeji-gateway
mvn spring-boot:run
```

或者使用脚本批量启动：

```bash
cd heikeji-mall-service
./start_services_final.sh
```

#### 3.2.6 访问服务

- API网关：http://localhost:8080
- 外卖服务接口：http://localhost:8081/api/app/takeout/order/create
- Swagger文档：http://localhost:8888/swagger-ui.html

## 4. 核心功能使用

### 4.1 外卖服务

#### 4.1.1 创建外卖订单

**请求示例：**
```bash
curl -X POST "http://localhost:8080/api/takeout/order" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{
    "merchantId": 1,
    "deliveryType": 1,
    "deliveryLockerCode": "LOCKER001",
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "receiverAddress": "黑龙江科技大学西区",
    "orderItems": [
      {
        "productId": 1,
        "quantity": 2,
        "price": 25.00
      }
    ],
    "remark": "不要辣"
  }'
```

#### 4.1.2 查询订单详情

**请求示例：**
```bash
curl -X GET "http://localhost:8080/api/takeout/order/1" \
  -H "Authorization: Bearer {token}"
```

### 4.2 用户服务

#### 4.2.1 微信登录

**请求示例：**
```bash
curl -X POST "http://localhost:8080/api/auth/wx/login" \
  -H "Content-Type: application/json" \
  -d '{
    "code": "wx_code",
    "userInfo": {
      "nickName": "微信昵称",
      "avatarUrl": "头像URL",
      "gender": 1
    }
  }'
```

### 4.3 商品服务

#### 4.3.1 获取商品列表

**请求示例：**
```bash
curl -X GET "http://localhost:8080/api/product/list?categoryId=1&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer {token}"
```

## 5. 开发流程

### 5.1 代码结构

项目采用微服务架构，主要模块包括：

| 模块名称 | 主要职责 |
|----------|----------|
| heikeji-common | 通用工具类、常量、异常定义 |
| heikeji-system | 系统管理（用户、角色、权限） |
| heikeji-gateway | API网关、路由转发、限流 |
| heikeji-mall-service | 核心业务服务 |
| heikeji-mall-api | API接口定义 |
| heikeji-admin | 管理后台前端 |
| heikeji-miniprogram | 微信小程序前端 |

### 5.2 开发规范

- **代码规范**：遵循阿里巴巴Java开发规范
- **命名规范**：类名使用大驼峰，方法名使用小驼峰
- **注释规范**：关键代码必须添加注释
- **提交规范**：使用语义化提交信息

### 5.3 本地开发

1. **启动基础服务**：MySQL、Redis、Nacos
2. **启动开发服务**：使用IDE启动各业务服务
3. **调试**：使用Swagger或Postman调试API
4. **测试**：编写单元测试和集成测试
5. **提交代码**：遵循Git Flow工作流

## 6. 常见问题与解决方案

### 6.1 服务启动失败

#### 问题：服务无法连接到数据库
**解决方案**：
- 检查数据库是否正常启动
- 检查数据库连接配置是否正确
- 检查数据库用户权限

#### 问题：服务无法注册到Nacos
**解决方案**：
- 检查Nacos是否正常启动
- 检查Nacos连接配置是否正确
- 检查网络连通性

### 6.2 API访问问题

#### 问题：API返回401未授权
**解决方案**：
- 检查请求头中是否包含有效的JWT Token
- 检查Token是否过期
- 检查Token签名是否正确

#### 问题：API返回404资源不存在
**解决方案**：
- 检查请求路径是否正确
- 检查服务是否正常启动
- 检查API网关路由配置

### 6.3 数据库问题

#### 问题：数据库初始化失败
**解决方案**：
- 检查SQL脚本是否完整
- 检查数据库版本是否兼容
- 检查数据库字符集配置

## 7. 监控与日志

### 7.1 日志查看

#### Docker部署方式
```bash
docker-compose logs -f {service-name}
```

#### 本地部署方式
日志文件位于各服务模块的 `logs` 目录下。

### 7.2 监控指标

- **服务监控**：通过Actuator端点监控服务状态
- **数据库监控**：使用MySQL自带的监控工具
- **Redis监控**：使用Redis自带的监控工具

## 8. 联系方式

- **项目地址**：https://github.com/your-repo/heikeji-mall
- **问题反馈**：https://github.com/your-repo/heikeji-mall/issues
- **技术支持**：contact@heikeji.com

## 9. 许可证

MIT License

---

**让校园生活更简单，让时间更宝贵！** 🎓✨
