# 黑科易购项目升级计划

## 1. 升级概述

本计划详细描述了黑科易购项目从当前技术栈向现代化技术栈升级的步骤和注意事项，包括Java版本升级、Spring Boot版本升级以及相关依赖的更新。

## 2. 升级目标

1. **Java版本**：从Java 1.8升级到Java 17 LTS
2. **Spring Boot版本**：从2.7.14升级到3.2.x最新稳定版
3. **核心依赖**：升级到兼容Spring Boot 3.x的版本
4. **API兼容性**：确保现有业务代码在新环境下正常运行
5. **测试覆盖**：提高测试覆盖率，确保功能稳定性

## 3. 升级风险评估

### 3.1 Java 17兼容性问题
- **移除的API**：某些在Java 8中可用的API在Java 17中已被移除或弃用
- **语法变化**：Lambda表达式、接口默认方法等使用可能需要调整
- **安全增强**：模块系统（Jigsaw）可能影响类加载

### 3.2 Spring Boot 3.x兼容性问题
- **Jakarta EE替代Java EE**：包路径从javax.*变更为jakarta.*
- **自动配置变更**：部分自动配置类可能已重命名或移除
- **依赖版本要求**：某些依赖可能不再兼容或需要特定版本
- **Spring Security变更**：安全框架API有较大变化

## 4. 升级步骤

### 4.1 准备工作
1. 创建代码分支，用于升级开发
2. 备份现有项目配置和代码
3. 确保构建工具支持Java 17（Maven 3.8+）
4. 建立测试环境，用于验证升级结果

### 4.2 Java版本升级（步骤1）
1. 修改pom.xml中的Java版本配置为17
2. 升级Maven编译器插件版本
3. 解决编译错误，主要关注：
   - 已废弃API的替换
   - 不兼容的语法变化
   - 模块系统相关问题
4. 运行单元测试，验证基本功能

### 4.3 Spring Boot版本升级（步骤2）
1. 更新父项目Spring Boot版本为3.2.x
2. 升级Spring Cloud和Spring Cloud Alibaba版本
3. 解决主要兼容性问题：
   - javax.*包名替换为jakarta.*
   - 自动配置类调整
   - 依赖冲突解决
4. 修复启动错误

### 4.4 核心依赖升级（步骤3）
1. 升级MyBatis Plus到支持Spring Boot 3.x的版本
2. 更新Hutool、Swagger、Fastjson等工具库
3. 升级数据库驱动和连接池
4. 更新缓存、安全、日志等组件

### 4.5 代码调整（步骤4）
1. 修复过时API使用
2. 调整Lambda表达式和Stream API使用
3. 优化Optional使用
4. 处理新的类型检查和空指针安全要求

### 4.6 测试与验证（步骤5）
1. 完善单元测试，提高覆盖率
2. 编写集成测试，验证模块间交互
3. 执行端到端测试，确保业务流程完整
4. 进行性能测试，确保系统性能不降低

## 5. 依赖版本推荐

### 5.1 核心框架
- Spring Boot: 3.2.5
- Spring Cloud: 2023.0.1
- Spring Cloud Alibaba: 2023.0.1.0

### 5.2 持久层
- MyBatis Plus: 3.5.5
- Druid: 1.2.23

### 5.3 工具库
- Hutool: 5.8.26
- Swagger/OpenAPI: 2.2.0 (SpringDoc)
- Fastjson: 2.0.55
- Lombok: 1.18.32

### 5.4 缓存与消息
- Redis Client: 3.5.3
- JWT: 0.12.3

### 5.5 日志
- SLF4J: 2.0.13
- Logback: 1.4.14

## 6. 常见问题解决方案

### 6.1 Jakarta EE迁移
- 使用批量替换将所有javax.*包名替换为jakarta.*
- 特别关注：jakarta.servlet、jakarta.persistence、jakarta.validation等包

### 6.2 Spring Security变更
- 调整认证过滤器链配置
- 更新SecurityConfig类使用新API
- 重新配置JWT处理逻辑

### 6.3 数据库相关问题
- 检查JDBC驱动版本兼容性
- 更新数据库连接池配置
- 验证SQL兼容性

### 6.4 启动失败问题
- 检查自动配置冲突
- 验证Bean定义和注入
- 检查循环依赖

## 7. 升级验证清单

- [ ] 项目能够正常编译
- [ ] 所有单元测试通过
- [ ] 服务能够正常启动
- [ ] API接口响应正常
- [ ] 数据库操作正常
- [ ] 缓存功能正常
- [ ] 安全认证授权正常
- [ ] 主要业务流程测试通过
- [ ] 性能指标达到预期

## 8. 回滚计划

1. 保留原始代码分支
2. 记录每一步的配置变更
3. 准备数据库备份
4. 如需回滚，切换回原始分支并恢复数据库

## 9. 文档更新

升级完成后，需要更新以下文档：
- 开发环境配置文档
- 部署文档
- 架构文档
- 技术栈清单

## 10. 团队培训

安排团队培训，介绍：
- Java 17新特性
- Spring Boot 3.x变更
- 新的开发规范和最佳实践