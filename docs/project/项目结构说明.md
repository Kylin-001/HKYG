# 黑科易购项目结构说明文档

## 目录
0. [技术术语表](#0-技术术语表)
   - [核心架构术语](#核心架构术语)
   - [技术组件术语](#技术组件术语)
   - [业务术语](#业务术语)
1. [项目概述](#项目概述)
   1.0 [项目愿景与使命](#项目愿景与使命)
   1.1 [项目定位](#项目定位)
2. [项目结构](#项目结构)
   2.0 [项目总体架构](#项目总体架构)
   2.1 [微服务架构模块结构](#微服务架构模块结构)
3. [模块职责说明](#模块职责说明)
   3.1 [基础模块](#基础模块)
   3.2 [业务服务模块](#业务服务模块)
   3.3 [接口和前端模块](#接口和前端模块)
4. [技术栈说明](#技术栈说明)
   4.1 [后端技术栈](#后端技术栈)
   4.2 [前端技术栈](#前端技术栈)
5. [模块间依赖关系](#模块间依赖关系)
6. [开发说明](#开发说明)
   6.1 [环境要求与配置](#环境要求与配置)
   6.2 [开发环境搭建流程](#开发环境搭建流程)
   6.3 [代码规范与最佳实践](#代码规范与最佳实践)
   6.4 [分支管理策略](#分支管理策略)
   6.5 [项目构建与部署](#项目构建与部署)
   6.6 [测试指南](#测试指南)
   6.7 [代码审查流程](#代码审查流程)
   6.8 [常见问题与解决方案](#常见问题与解决方案)
   6.9 [开发环境管理工具](#开发环境管理工具)
7. [注意事项](#注意事项)
8. [数据库设计](#数据库设计)
   8.1 [数据库架构](#数据库架构)
   8.2 [核心数据表](#核心数据表)
9. [部署架构](#部署架构)
   9.1 [开发环境](#开发环境)
   9.2 [测试环境](#测试环境)
   9.3 [生产环境](#生产环境)
   9.4 [部署流程](#部署流程)
10. [安全设计](#安全设计)
    10.1 [认证授权体系](#认证授权体系)
    10.2 [数据安全](#数据安全)
    10.3 [接口安全](#接口安全)
    10.4 [校园数据特别保护](#校园数据特别保护)
11. [系统监控与运维](#系统监控与运维)
    11.1 [监控体系](#监控体系)
    11.2 [日志管理](#日志管理)
    11.3 [告警机制](#告警机制)
    11.4 [运维自动化](#运维自动化)
12. [api文档结构](#api文档结构)
    12.1 [文档组织](#文档组织)
    12.2 [文档标准](#文档标准)
    12.3 [特色服务api](#特色服务api)
13. [校园特色功能详解](#校园特色功能详解)
    13.1 [校园地图与定位服务](#校园地图与定位服务)
    13.2 [学业辅助功能](#学业辅助功能)
    13.3 [校园社交与社区](#校园社交与社区)
    13.4 [校园安全与服务](#校园安全与服务)
    13.5 [校园生活便利服务](#校园生活便利服务)
14. [系统性能优化](#系统性能优化)
    14.1 [前端性能优化](#前端性能优化)
    14.2 [后端性能优化](#后端性能优化)
    14.3 [架构优化](#架构优化)
    14.4 [校园特色服务性能考虑](#校园特色服务性能考虑)
15. [项目迭代与规划](#项目迭代与规划)
      15.1 [近期迭代计划](#近期迭代计划)
      15.2 [长期发展方向](#长期发展方向)
 16. [结语](#结语)

## 0. 技术术语表

为确保文档中技术术语使用的一致性，特列出以下关键术语及其解释：

### 核心架构术语
- **微服务架构**：一种软件设计风格，将应用程序构建为一系列松耦合的服务，每个服务运行在自己的进程中，服务间采用轻量级通信机制进行交互
- **API网关**：系统的统一入口，负责请求路由、负载均衡、认证授权、限流熔断等功能
- **服务发现**：自动检测可用服务实例的机制，实现服务的动态注册与发现
- **熔断降级**：当服务出现异常时，快速失败并提供备用方案，防止故障扩散
- **负载均衡**：将网络请求或计算任务分摊到多个服务器上，提高系统整体性能和可用性

### 技术组件术语
- **Spring Cloud**：基于Spring Boot的微服务框架，提供了服务发现、配置管理、负载均衡等微服务基础设施
- **Feign**：声明式的REST客户端，简化微服务间的HTTP通信
- **Nacos**：阿里巴巴开源的服务发现、配置管理和服务管理平台
- **Sentinel**：阿里开源的流量控制、熔断降级、系统负载保护组件
- **Elasticsearch**：分布式搜索引擎，用于实现全文检索功能
- **Redis**：高性能内存数据库，用于缓存、会话管理等
- **Docker**：容器化平台，简化应用程序的打包和部署
- **Kubernetes**：容器编排平台，用于自动化部署、扩展和管理容器化应用

### 业务术语
- **校园外卖**：在校园内提供的餐饮外送服务
- **快递配送**：校园内的快递收取和配送服务
- **外卖柜**：用于存放外卖的智能储物柜
- **校园地图**：专用于校园场景的导航地图
- **校园社区**：学生交流互动的平台，包括论坛、问答等功能
- **学业辅助**：帮助学生学习的功能，如课程表、成绩查询等

## 1. 项目概述

黑龙江科技大学特色校园服务平台（黑科易购）是一个面向黑龙江科技大学师生的综合性智慧校园服务平台，采用微服务架构设计，支持PC管理后台、微信小程序和手机APP三种终端。平台集成了商品商城、校园外卖、快递配送、校园地图导航、学业辅助、校园社区、学生社团管理等特色功能，旨在为师生提供便捷、高效、安全的校园生活服务。

### 1.0 项目愿景与使命
- **愿景**：成为黑龙江科技大学师生首选的智慧校园生活服务平台，构建数字化、智能化的校园生态系统
- **使命**：通过技术创新和优质服务，提升校园生活品质，促进校园信息化建设，增强师生凝聚力和校园文化活力
- **核心价值观**：便捷、高效、安全、创新、服务

### 1.1 项目定位
- **专属定制**：打造黑龙江科技大学专属的智慧校园服务生态，充分考虑校园特色和师生需求
- **一站式服务**：整合校园内外资源，提供商品购物、餐饮外卖、快递配送、校园导航、学业辅助、社区互动等全方位服务
- **智慧校园**：作为智慧校园建设的重要组成部分，提升校园信息化水平，优化师生服务体验
- **社区建设**：促进校园文化交流与学生社区建设，增强校园凝聚力
- **创新驱动**：持续引入新技术和新功能，保持平台活力和竞争力
- **服务至上**：以师生需求为中心，提供便捷、高效、安全的校园生活服务

## 2. 项目结构

### 2.0 项目总体架构

黑龙江科技大学特色校园服务平台采用现代化的微服务架构设计，具有高可用性、高扩展性和高性能的特点。整体架构分为以下几个层次：

- **前端层**：包括管理后台前端、微信小程序和手机APP
- **接入层**：API网关，负责请求路由、负载均衡、认证授权等
- **服务层**：10个核心微服务模块，实现各类业务功能
- **公共层**：提供通用组件、工具类、安全框架等
- **数据层**：关系型数据库、NoSQL数据库、搜索引擎等
- **基础设施层**：容器化平台、监控系统、日志系统等

### 2.1 微服务架构模块结构

```plaintext
heikeji-mall/                # 项目根目录
├── heikeji-common/              # 通用模块
│   ├── common-core/            # 核心工具类、常量、异常定义
│   ├── common-db/              # 数据库相关公共组件
│   ├── common-security/        # 安全相关，JWT工具类
│   ├── common-feign/           # 微服务远程调用
│   └── common-swagger/         # API文档生成
├── heikeji-gateway/            # API网关模块
├── heikeji-system/             # 系统模块（用户、角色、权限管理）
├── heikeji-auth/               # 认证授权模块
├── heikeji-mall-api/           # API接口模块，定义对外接口和DTO
├── heikeji-mall-service/       # 微服务模块（10个核心服务）
│   ├── service-user/           # 用户服务
│   ├── service-product/        # 商品服务
│   ├── service-order/          # 订单服务
│   ├── service-delivery/       # 跑腿/配送服务
│   ├── service-takeout/        # 外卖服务
│   ├── service-payment/        # 支付服务（微信支付）
│   ├── service-campus/         # 校园信息服务
│   ├── service-community/      # 社区服务
│   ├── service-search/         # 搜索服务
│   └── service-notification/   # 消息通知服务
├── heikeji-mall-job/           # 定时任务模块
├── heikeji-admin/              # 后台管理端API
├── heikeji-app/                # 手机应用API
├── heikeji-miniapp/            # 微信小程序API
├── heikeji-frontend/           # 前端模块（管理后台）
├── sql/                        # 数据库初始化脚本
├── config/                     # 配置文件目录
├── scripts/                    # 部署和运维脚本
└── docs/                       # 项目文档
```

> **注意**：项目采用标准的微服务架构，包含10个核心业务服务模块，全面支持校园特色服务功能。各模块职责明确，服务间通过API网关进行通信和管理。

## 3. 模块职责说明

### 3.1 基础模块

#### heikeji-common
通用模块，提供全项目共享的工具类和功能组件，是整个系统的基础支撑：

- **common-core**: 
  - 核心工具类库（日期、字符串、集合、加密等操作）
  - 通用常量定义（业务常量、错误码等）
  - 全局异常处理机制
  - 通用响应对象（统一API响应格式）
  - 数据校验工具
  - 日志工具类

- **common-db**: 
  - 数据库连接配置管理
  - 分页插件封装
  - 数据访问基础类
  - 事务管理工具
  - 数据库操作通用方法

- **common-security**: 
  - JWT令牌生成与验证工具
  - 密码加密与验证
  - 安全相关常量定义
  - 权限校验辅助工具
  - XSS防护工具

- **common-feign**: 
  - Feign客户端配置与封装
  - 微服务间通信接口定义
  - 服务熔断与降级配置
  - 负载均衡策略配置

- **common-swagger**: 
  - API文档自动生成配置
  - 接口注释规范
  - 接口测试工具集成
  - 文档安全控制

#### heikeji-gateway
API网关模块，作为系统的统一入口，负责所有外部请求的路由和处理：

- **请求路由与负载均衡**
  - 根据请求路径和规则将请求转发到相应的微服务
  - 支持多种负载均衡策略（轮询、权重、最少连接等）
  - 动态服务发现与路由更新

- **统一认证与授权**
  - 集中式身份验证
  - JWT令牌验证和刷新
  - 基于角色和权限的访问控制

- **流量控制与保护**
  - 请求限流（基于IP、用户、接口）
  - 服务熔断与降级
  - 异常请求拦截
  - 防DDoS攻击策略

- **日志与监控**
  - 统一请求日志记录
  - 接口调用统计和分析
  - 性能监控指标收集
  - 错误跟踪和告警

- **跨域处理**
  - CORS配置管理
  - 跨域安全策略实现

#### heikeji-system
系统管理模块，提供平台基础的系统级功能管理：

- **用户管理**
  - 管理员用户的增删改查
  - 用户状态管理和密码重置
  - 用户信息维护

- **角色与权限管理**
  - 角色的创建、修改和删除
  - 角色权限的分配和管理
  - 细粒度权限控制（菜单、按钮、API级别）

- **菜单管理**
  - 管理后台菜单的配置
  - 菜单权限的分配
  - 动态路由生成

- **系统配置**
  - 系统参数配置管理
  - 数据字典维护
  - 系统开关管理

- **日志管理**
  - 操作日志记录和查询
  - 登录日志审计
  - 系统日志管理

#### heikeji-auth
认证授权模块，负责用户身份验证、令牌管理和权限控制：

- **多方式认证**
  - 账号密码认证
  - 微信小程序授权登录
  - 校园统一身份认证集成
  - 第三方OAuth2.0认证

- **令牌管理**
  - JWT令牌生成与验证
  - 令牌刷新和过期控制
  - 令牌黑名单管理
  - 会话管理

- **单点登录**
  - 多系统单点登录支持
  - 会话共享机制
  - 登出处理

- **权限校验**
  - 细粒度权限验证
  - 接口访问控制
  - 数据权限过滤
  - 操作权限校验

- **安全防护**
  - 登录失败次数限制
  - 密码复杂度校验
  - 敏感操作二次验证
  - 防暴力破解机制

### 3.2 业务服务模块

#### service-user
用户服务模块，管理普通用户信息和行为：

- **用户账户管理**
  - 用户注册和登录（支持校园统一身份认证）
  - 个人信息维护和更新
  - 密码修改和找回
  - 账户安全设置

- **个人资产管理**
  - 余额管理
  - 积分管理
  - 消费记录查询
  - 会员等级管理

- **地址管理**
  - 收货地址增删改查
  - 默认地址设置
  - 地址智能识别
  - 校园地址库维护

- **个性化服务**
  - 用户收藏和足迹管理
  - 浏览历史记录
  - 个性化推荐
  - 用户偏好设置

- **用户行为分析**
  - 用户行为记录（浏览、购买、收藏等）
  - 用户统计信息（行为次数、订单金额等）
  - 用户行为趋势分析
  - 热门商品分析
  - 用户活跃度评估
  - 用户偏好分析
  - 用户流失风险预测
  - 用户群体行为分析
  - 购买意向预测

#### service-product
商品服务模块，管理商品相关信息：

- **商品基础管理**
  - 商品分类和品牌管理
  - 商品基本信息维护
  - 商品上下架管理
  - 商品状态控制

- **商品详细信息**
  - SKU和库存管理
  - 商品属性维护
  - 商品图片和视频管理
  - 商品详情内容管理

- **库存管理**
  - 实时库存监控
  - 库存预警机制
  - 库存扣减和恢复
  - 多仓库库存协同

- **商品搜索和营销**
  - 商品搜索和筛选
  - 商品评价管理
  - 热门商品管理
  - 新品上架管理

#### service-order
订单服务模块，处理订单全生命周期：

- **订单创建与管理**
  - 订单创建和提交
  - 订单状态管理
  - 订单取消和退款处理
  - 订单历史记录查询

- **订单详情**
  - 订单项管理
  - 订单价格计算（含优惠、运费等）
  - 订单备注和标签
  - 订单快照生成

- **订单查询**
  - 订单查询和统计
  - 订单筛选
  - 订单导出功能
  - 订单异常处理

- **售后服务**
  - 退货申请处理
  - 退款处理流程
  - 售后纠纷处理
  - 订单评价管理

#### service-delivery
配送服务模块，处理跑腿订单：

- **配送员管理**
  - 配送员注册和认证
  - 配送员信息维护
  - 配送员评级和奖励
  - 配送员状态管理

- **配送订单管理**
  - 配送订单创建和跟踪
  - 配送状态更新
  - 配送路径规划
  - 实时位置跟踪

- **费用管理**
  - 配送费用计算
  - 运费模板设置
  - 配送员收入结算
  - 优惠券和折扣管理

- **校园特色配送**
  - 教学楼配送点
  - 宿舍楼配送管理
  - 校园外卖柜对接
  - 定时配送服务

#### service-takeout
外卖服务模块，处理外卖业务：

- **商家管理**
  - 商家入驻和审核
  - 商家信息维护
  - 商家评分和评价
  - 商家营业状态管理

- **菜单管理**
  - 菜品分类和管理
  - 菜品信息和图片
  - 菜品价格和库存
  - 特色菜品推荐

- **外卖订单处理**
  - 外卖订单创建
  - 订单状态流转
  - 订单分配和派送
  - 订单异常处理

- **配送状态跟踪**
  - 实时配送状态更新
  - 配送员位置查询
  - 预计送达时间计算
  - 配送异常处理

#### service-payment
支付服务模块，对接支付渠道：

- **支付通道管理**
  - 微信支付对接
  - 支付通道状态监控
  - 支付接口版本管理
  - 支付限额控制

- **支付流程处理**
  - 统一下单接口
  - 支付结果查询
  - 支付状态同步
  - 支付超时处理

- **退款管理**
  - 退款申请处理
  - 退款状态查询
  - 退款日志记录
  - 退款失败处理

- **账单管理**
  - 支付记录管理
  - 账单查询
  - 交易对账功能
  - 财务报表生成

#### service-campus
校园服务模块，管理校园相关信息和特色功能：

- **校园基础信息**
  - 校园基础信息维护
  - 校园站点管理
  - 外卖柜管理
  - 楼栋信息管理

- **校园地图服务**
  - 校园地图数据维护
  - 路径规划
  - 兴趣点查询
  - 地图搜索功能

- **学业辅助功能**
  - 学业资源管理
  - 课程表查询
  - 成绩查询接口
  - 图书馆资源查询

- **校园活动与安全**
  - 校园活动管理
  - 校园安全服务
  - 校园公告发布
  - 校园资源管理

#### service-community
社区服务模块，提供校园社交和互动功能：

- **学生社团管理**
  - 社团注册和审核
  - 社团信息维护
  - 社团活动管理
  - 社团成员管理

- **校园论坛**
  - 帖子发布和管理
  - 评论和回复
  - 点赞和分享
  - 内容审核机制

- **特色功能**
  - 失物招领
  - 校园活动报名
  - 校园问答
  - 兴趣圈子

- **校园信息**
  - 校园公告发布
  - 信息推送
  - 热门话题管理
  - 校园文化建设

#### service-search
搜索服务模块，提供全文检索功能：

- **搜索索引管理**
  - 商品索引管理
  - 外卖商家索引
  - 校园服务索引
  - 社区内容索引

- **搜索功能**
  - 商品搜索
  - 外卖商家搜索
  - 校园服务搜索
  - 社区内容搜索

- **搜索优化**
  - 搜索结果排序
  - 搜索结果过滤
  - 搜索性能优化
  - 搜索无结果处理

- **搜索分析**
  - 搜索推荐
  - 搜索热词统计
  - 搜索行为分析
  - 智能搜索建议

#### service-notification
消息通知服务模块，负责各类消息的推送：

- **消息管理**
  - 站内信管理
  - 推送消息管理
  - 消息模板配置
  - 通知记录查询

- **消息发送服务**
  - 短信发送（验证码、通知等）
  - 邮件发送
  - 微信消息推送
  - APP推送通知

- **消息队列管理**
  - 消息队列配置
  - 消息重试机制
  - 消息状态监控
  - 消息优先级管理

- **订阅管理**
  - 用户订阅设置
  - 消息分类订阅
  - 免打扰时段设置
  - 推送频率控制

### 3.3 接口和前端模块

#### heikeji-mall-api
接口模块，作为前后端交互的桥梁，统一管理所有服务的API接口：

- **API接口定义**
  - RESTful API设计和实现
  - 接口文档自动生成
  - 接口版本控制策略
  - API分组管理

- **接口规范**
  - 请求参数验证
  - 响应格式统一
  - 错误码管理
  - 接口注释规范

- **接口安全**
  - 接口权限控制
  - 防SQL注入
  - XSS攻击防护
  - CSRF防护

- **接口监控**
  - 接口调用日志
  - 性能监控
  - 异常告警
  - 调用统计分析

#### heikeji-admin
后台管理系统API模块，为系统管理员提供强大的管理和运营功能：

- **系统管理**
  - 用户和角色管理
  - 权限配置
  - 菜单管理
  - 系统参数设置

- **商品管理**
  - 商品信息管理和上下架
  - 分类和品牌管理
  - 商品库存管理
  - 商品评价审核

- **订单管理**
  - 订单查询和处理
  - 订单状态管理
  - 退款和售后处理
  - 订单统计分析

- **营销管理**
  - 优惠券管理
  - 促销活动配置
  - 广告位管理
  - 积分规则设置

- **数据统计与分析**
  - 销售数据报表
  - 用户行为分析
  - 流量统计
  - 运营数据看板

- **校园特色管理**
  - 校园服务配置
  - 校园信息维护
  - 校园活动管理
  - 校园资源管理

#### heikeji-app
手机应用APP端API模块，为学生和教职工提供全面的校园生活服务体验：

- **用户中心**
  - 用户登录和注册（支持校园统一身份认证）
  - 个人信息维护
  - 地址管理（校园地址智能识别）
  - 账户安全设置

- **购物服务**
  - 商品浏览和搜索
  - 商品详情查看
  - 购物车管理
  - 订单管理
  - 在线支付

- **校园外卖服务**
  - 周边商家展示
  - 菜单浏览和点餐
  - 外卖订单跟踪
  - 校园配送点设置

- **校园配送服务**
  - 跑腿订单发布
  - 配送员管理
  - 实时位置跟踪
  - 配送费用计算

- **校园特色功能**
  - 校园地图导航
  - 校园活动信息
  - 校园公告浏览
  - 学业资源查询

- **社交互动**
  - 校园社区浏览
  - 发帖和评论
  - 失物招领
  - 校园问答

#### heikeji-miniprogram
微信小程序API模块，提供便捷的轻量化校园服务访问方式：

- **用户体验**
  - 微信一键登录和授权
  - 轻量化界面设计
  - 流畅的操作体验
  - 离线缓存策略

- **核心服务**
  - 商品快速浏览和购买
  - 订单查询和跟踪
  - 在线支付（微信支付）
  - 个人中心管理

- **校园特色**
  - 校园外卖便捷点餐
  - 跑腿服务快速下单
  - 校园活动浏览和报名
  - 校园地图服务

- **社交功能**
  - 校园社区浏览
  - 简易互动功能
  - 信息发布
  - 校园通讯录

#### heikeji-frontend
Web前端模块，为PC端用户提供完整的校园服务和购物体验：

- **用户体验**
  - 响应式设计，适配不同屏幕尺寸
  - 流畅的交互体验
  - 优雅的UI设计
  - 统一的设计语言

- **用户中心**
  - 用户注册和登录
  - 个人信息维护
  - 订单和账户管理
  - 安全设置

- **商品购物**
  - 商品分类浏览
  - 多维度搜索和筛选
  - 商品详情展示
  - 购物车和结算流程
  - 在线支付集成

- **校园服务**
  - 校园外卖服务
  - 校园配送服务
  - 校园信息查询
  - 校园活动展示

- **社交互动**
  - 校园社区功能
  - 评论和评价系统
  - 内容分享功能
  - 用户互动功能

- **性能优化**
  - 资源懒加载
  - 缓存策略
  - 首屏加载优化
  - 图片优化

## 4. 技术栈说明

### 4.1 后端技术栈

#### 核心框架
- **Java 17**: 主要开发语言
- **Spring Boot 3.2.x**: 应用开发框架，提供快速开发的基础架构支持
- **Spring Cloud 2023.x**: 微服务框架，提供服务注册发现、配置管理等核心能力
- **MyBatis Plus 3.5.5**: ORM框架，简化数据库操作，提供代码生成能力

#### 数据库与存储
- **MySQL 8.3.x**: 关系型数据库，用于存储核心业务数据
- **Redis 7.2.x**: 缓存服务，用于缓存热点数据和分布式锁
- **Elasticsearch 8.x**: 搜索引擎，提供全文检索和数据分析能力

#### 消息队列与异步
- **Kafka/RabbitMQ**: 消息队列，用于解耦服务、异步处理和流量削峰
- **Spring AMQP**: 消息队列的Spring集成框架

#### 安全认证
- **Spring Security**: 安全框架
- **JWT 0.12.x**: 无状态身份认证，支持分布式环境
- **OAuth2.0**: 授权框架，支持第三方授权

#### 微服务组件
- **Nacos 2.0+**: 服务注册与配置中心
- **Gateway**: API网关，提供路由转发、过滤等功能
- **Feign**: 声明式REST客户端
- **Sentinel**: 流量控制和熔断降级

#### 容器化与部署
- **Docker**: 容器化平台
- **Kubernetes**: 容器编排平台

### 4.2 前端技术栈

#### Web前端
- **Vue 3.5.x**: 渐进式JavaScript框架
- **Element Plus**: Vue 3的UI组件库
- **Vite**（构建工具）: 下一代前端构建工具
- **Pinia**（状态管理）: Vue 3的状态管理库
- **Vue Router 4.x**: Vue路由管理器
- **TypeScript**: JavaScript的超集

#### 移动端开发
- **Taro 3.6+**（小程序框架）: 跨平台应用开发框架
- **微信小程序原生开发**: 针对微信生态的深度优化

#### 前端工具与优化
- **ESLint**: 代码质量检查工具
- **Prettier**: 代码格式化工具
- **Vue DevTools**: Vue开发调试工具

### 4.3 开发工具与环境
- **Maven**: 项目构建和依赖管理
- **Git**: 版本控制系统
- **IntelliJ IDEA**: Java开发IDE
- **VS Code**: 前端开发IDE
- **Swagger**: API文档生成工具
- **Postman**: API测试工具
- **Docker Compose**: 本地开发环境管理

## 5. 模块间依赖关系

### 5.1 基础依赖关系

#### 核心依赖链
- **heikeji-common**: 作为整个系统的基础模块，被所有其他模块直接或间接依赖
  - 提供通用工具类、常量定义、异常处理等基础设施
  - 定义统一的响应格式和数据结构

- **heikeji-mall-api**: 定义所有API接口规范
  - 被所有前端模块直接依赖
  - 定义服务间的接口契约

- **heikeji-system**: 系统管理基础模块
  - 为其他所有服务提供基础数据支持
  - 提供权限、用户、角色等核心功能

- **heikeji-auth**: 认证授权模块
  - 为所有需要认证的模块提供身份验证服务
  - 管理用户会话和权限

### 5.2 服务调用与交互关系

#### 水平分层调用
- **heikeji-gateway** → **所有业务服务模块**
  - 作为系统统一入口，路由所有外部请求
  - 进行请求分发、负载均衡和统一认证

- **业务服务模块之间**
  - 通过Feign进行同步调用
  - 通过消息队列进行异步通信
  - 服务间保持松耦合，减少直接依赖

- **前端模块** → **API层** → **后端服务**
  - 严格遵循分层调用原则
  - 禁止前端直接访问数据库或绕过API层

#### 关键服务依赖关系

1. **用户服务(service-user)依赖**
   - 依赖：auth服务（认证）
   - 被依赖：几乎所有业务服务（获取用户信息）

2. **商品服务(service-product)依赖**
   - 被依赖：order服务、search服务

3. **订单服务(service-order)依赖**
   - 依赖：product服务（库存检查）、user服务（用户信息）、payment服务（支付处理）、notification服务（消息通知）
   - 被依赖：user服务（订单查询）、admin服务（订单管理）

4. **支付服务(service-payment)依赖**
   - 依赖：order服务（订单状态更新）、notification服务（支付结果通知）
   - 被依赖：order服务（发起支付）

5. **校园服务(service-campus)依赖**
   - 依赖：user服务（用户身份验证）
   - 被依赖：app、miniprogram等前端模块、takeout服务、delivery服务

6. **外卖服务(service-takeout)依赖**
   - 依赖：user服务、order服务、delivery服务、notification服务、campus服务
   - 被依赖：app、miniprogram等前端模块、search服务

### 5.3 数据流向与通信机制

#### 同步通信
- **REST API调用**：通过Feign客户端进行服务间同步调用
- **API网关转发**：前端请求通过Gateway转发到对应服务
- **数据库访问**：各服务通过MyBatis-Plus访问各自数据库

#### 异步通信
- **消息队列**：实现服务间异步通信
  - 订单创建 → 库存扣减 → 消息通知
  - 支付成功 → 订单状态更新 → 消息推送
  - 异步任务处理（统计、日志等）

#### 详细依赖关系列表
- **heikeji-gateway** → 所有业务服务模块（路由转发）
- **heikeji-auth** → service-user（用户信息）
- **heikeji-admin** → 所有业务服务模块（管理功能）
- **heikeji-app** → 所有业务服务模块（APP用户功能）
- **heikeji-miniprogram** → 所有业务服务模块（小程序用户功能）
- **业务服务模块** → heikeji-common（公共组件）
- **service-order** → service-product, service-user, service-payment, service-notification（创建订单和通知）
- **service-payment** → service-order, service-notification（支付结果回调和通知）
- **service-takeout** → service-user, service-delivery, service-notification, service-campus（外卖服务相关）
- **service-delivery** → service-user, service-notification, service-campus（配送服务相关）
- **service-campus** → service-user（校园服务相关）
- **service-community** → service-user, service-notification（社区服务相关）
- **service-search** → service-product, service-takeout, service-campus, service-community（搜索服务索引）
- **service-notification** → service-user（用户消息推送）

### 5.4 微服务治理

#### 服务注册与发现
- 所有微服务通过Nacos进行服务注册与发现
- 服务消费者通过服务名动态获取服务实例

#### 配置管理
- 集中式配置管理，通过Nacos管理所有服务的配置
- 支持配置热更新和环境隔离

#### 熔断与降级
- 使用Sentinel进行流量控制、熔断和降级
- 保护核心服务，提高系统稳定性

### 5.5 依赖管理原则

1. **最小依赖原则**
   - 服务间仅依赖必要的接口和功能
   - 避免循环依赖和过度耦合

2. **接口隔离原则**
   - 定义细粒度的接口，避免暴露不必要的功能
   - 使用DTO进行数据传输，隐藏内部实现

3. **版本控制**
   - API接口版本化管理
   - 服务升级时保证向后兼容

## 6. 开发说明

### 6.1 环境要求与配置

#### 必备开发环境
- **JDK 17**: 确保正确配置JAVA_HOME环境变量
- **Maven 3.8.6+**: 用于Java项目构建和依赖管理
- **MySQL 8.0.30+**: 关系型数据库，建议配置utf8mb4字符集
- **Redis 7.0.10+**: 缓存服务，默认端口6379
- **Node.js 16.18+**: JavaScript运行环境
- **npm 8.19+ 或 yarn 1.22+**: 前端包管理工具
- **Git 2.41+**: 版本控制系统
- **Docker 20.10+ 和 Docker Compose 2.18+**: 用于本地开发环境部署

#### 可选开发工具
- **IntelliJ IDEA Ultimate 2023.2+**: 推荐Java开发IDE
- **VS Code 1.81+**: 推荐前端开发IDE
- **Navicat/DBeaver**: 数据库管理工具
- **Postman 10.17+**: API测试工具
- **Redis Desktop Manager**: Redis可视化管理

### 6.2 开发环境搭建流程

#### 1. 代码准备
```bash
# 克隆代码仓库
git clone [repository-url]
cd heikeji-mall
```

#### 2. 环境配置
- **数据库配置**:
  - 创建MySQL数据库: `heikeji_mall_dev`
  - 导入初始化SQL脚本（位于 `docs/db/init.sql`）
  - 配置各服务模块的数据库连接参数

- **Nacos配置**:
  - 启动Nacos服务（使用Docker或直接运行）
  - 导入配置文件（位于 `docs/config/nacos`）

- **Redis配置**:
  - 启动Redis服务
  - 配置密码和持久化（可选）

- **本地开发配置**:
  - 配置hosts文件，添加本地域名映射
  - 配置各模块的application.yml文件

#### 3. 启动顺序
1. 启动基础设施服务：MySQL、Redis、Nacos
2. 启动核心服务：heikeji-system、heikeji-auth
3. 启动业务服务：各业务模块服务
4. 启动网关服务：heikeji-gateway
5. 启动前端项目：heikeji-admin、heikeji-app、heikeji-miniprogram

### 6.3 代码规范与最佳实践

#### Java代码规范
- **命名规范**:
  - 类名使用大驼峰命名法（PascalCase）
  - 方法名和变量名使用小驼峰命名法（camelCase）
  - 常量使用全大写加下划线（UPPER_SNAKE_CASE）
  - 包名使用小写字母

- **编码风格**:
  - 行宽不超过120个字符
  - 缩进使用4个空格
  - 使用Lombok简化代码（@Data, @Slf4j等）
  - 使用try-with-resources处理资源
  - 避免空指针，使用Optional处理可能为空的情况

- **注释规范**:
  - 类和方法必须添加Javadoc注释
  - 复杂逻辑必须添加行注释
  - 注释语言使用中文

#### 前端代码规范
- **Vue/TypeScript规范**:
  - 组件命名使用大驼峰命名法
  - 变量和方法使用小驼峰命名法
  - 使用TypeScript进行类型检查
  - 避免使用any类型

- **代码风格**:
  - 遵循Vue 3 Composition API最佳实践
  - 组件拆分合理，单一职责
  - 使用ESLint和Prettier保证代码质量
  - 优先使用组合式API而非选项式API

### 6.4 分支管理策略

#### 分支模型
- **main/master**: 主分支，用于生产环境部署
- **develop**: 开发分支，最新开发代码
- **feature/**: 功能分支，开发新功能
  - 命名格式: `feature/功能名称`
- **bugfix/**: Bug修复分支
  - 命名格式: `bugfix/问题描述`
- **release/**: 预发布分支
  - 命名格式: `release/v版本号`
- **hotfix/**: 紧急修复分支
  - 命名格式: `hotfix/问题描述`

#### 分支工作流程
1. 从develop分支创建feature分支
2. 开发完成后提交Pull Request到develop分支
3. 定期从develop分支合并到release分支进行测试
4. 测试通过后合并到master分支并打标签
5. 生产环境问题从master分支创建hotfix分支，修复后同时合并到master和develop分支

### 6.5 项目构建与部署

#### 后端构建
```bash
# 清理并构建所有模块
mvn clean package -DskipTests

# 构建特定模块
mvn clean package -pl heikeji-gateway -am -DskipTests
```

#### 前端构建
```bash
# 安装依赖
npm install
# 或
yarn install

# 开发模式运行
npm run dev
# 或
yarn dev

# 构建生产版本
npm run build
# 或
yarn build
```

#### Docker构建与运行
```bash
# 使用Docker Compose启动开发环境
docker-compose -f docker-compose-dev.yml up -d

# 构建单个服务的Docker镜像
docker build -t heikeji-gateway:latest -f heikeji-gateway/Dockerfile .
```

### 6.6 测试指南

#### 单元测试
- 后端使用JUnit 5编写单元测试
- 测试类命名格式: `被测类名Test`
- 测试方法命名格式: `test被测方法名_测试场景`
- 覆盖率目标: 核心业务代码>80%

#### 集成测试
- 使用TestContainers进行容器化集成测试
- 测试API接口和服务间调用
- 模拟真实业务场景

#### 前端测试
- 使用Jest进行单元测试
- 使用Cypress进行端到端测试
- 组件测试确保UI一致性

### 6.7 代码审查流程

#### 提交规范
- 提交信息必须清晰描述变更内容
- 提交信息格式: `类型: 简短描述\n\n详细说明`
- 类型包括: feat, fix, docs, style, refactor, test, chore

#### 代码审查要点
- 代码质量和风格一致性
- 业务逻辑正确性
- 安全性考虑（SQL注入、XSS等）
- 性能优化建议
- 代码注释完整性

### 6.8 常见问题与解决方案

1. **Nacos启动失败**
   - 检查端口是否被占用
   - 检查JVM内存配置

2. **数据库连接失败**
   - 验证数据库地址、用户名和密码
   - 检查数据库服务是否运行
   - 确认网络连接和防火墙设置

3. **前端编译错误**
   - 清理node_modules和缓存
   - 确保npm/yarn版本兼容性
   - 检查TypeScript类型错误

4. **服务间调用异常**
   - 验证服务注册状态
   - 检查Feign客户端配置
   - 查看熔断降级策略

### 6.9 开发环境管理工具

#### 本地开发环境一键启动
- 使用提供的脚本一键启动所有必要服务
- 脚本位置: `scripts/start-dev-env.sh`

#### 开发工具配置
- IDEA配置: `docs/ide/idea-settings.jar`
- VS Code配置: `docs/ide/vscode-settings.json`

#### 开发辅助脚本
- 数据库迁移脚本: `scripts/db-migrate.sh`
- 配置同步脚本: `scripts/sync-config.sh`
- 日志收集脚本: `scripts/collect-logs.sh`

## 7. 注意事项

- 新功能开发时，请先确认是否已有相关模块
- 修改公共模块时，需注意可能影响的其他模块
- API接口变更时，需同步更新前端调用代码
- 数据库表结构变更时，需更新SQL脚本和实体类
- 新增服务模块需在heikeji-mall-service/pom.xml中注册
- 校园特色服务开发需遵循数据隐私保护规范
- 微服务间通信优先使用Feign客户端
- 重要业务数据需实现数据备份和恢复机制
- 所有新增接口必须添加权限验证
- 性能敏感服务需进行压测和优化

## 8. 数据库设计

### 8.1 数据库架构
- **用户库(user_db)**：存储用户信息、权限、角色等数据，支持校园身份统一认证
- **商品库(product_db)**：存储商品、分类、库存、评价等数据
- **订单库(order_db)**：存储订单、订单明细、订单状态等数据
- **支付库(payment_db)**：存储支付记录、退款记录、交易流水等数据
- **校园服务库(campus_db)**：存储校园相关信息和特色服务数据
- **社区库(community_db)**：存储社区内容、活动、社团等数据
- **搜索索引库(search_db)**：基于Elasticsearch的数据索引，提供全文检索能力
- **日志库(log_db)**：存储系统操作日志、审计日志和业务日志

### 8.2 数据库设计原则
- **高内聚、低耦合**：按业务域划分数据库，减少跨库依赖
- **三范式为主**：核心业务表遵循第三范式设计，适当反范式优化查询性能
- **分布式设计**：支持水平扩展，适应高并发场景
- **安全性优先**：敏感数据加密存储，严格的权限控制
- **可维护性**：命名规范统一，字段设计合理，索引优化
- **数据一致性**：通过事务、分布式事务或最终一致性机制保证数据准确性

### 8.3 核心数据表结构

#### 8.3.1 用户相关表

**sys_user**（用户表）
- id: 主键，用户ID
- username: 用户名
- password: 密码（加密存储）
- real_name: 真实姓名
- student_id: 学号/工号
- email: 邮箱
- phone: 手机号
- avatar: 头像URL
- gender: 性别
- user_type: 用户类型（学生、教职工、商户等）
- status: 用户状态
- created_at: 创建时间
- updated_at: 更新时间

**sys_role**（角色表）
- id: 主键，角色ID
- role_name: 角色名称
- description: 角色描述
- created_at: 创建时间

**sys_permission**（权限表）
- id: 主键，权限ID
- permission_code: 权限代码
- permission_name: 权限名称
- resource_type: 资源类型
- resource_id: 资源ID

**sys_user_role**（用户-角色关联表）
- user_id: 用户ID
- role_id: 角色ID

#### 8.3.2 商品相关表

**product**（商品表）
- id: 主键，商品ID
- product_name: 商品名称
- category_id: 分类ID
- price: 价格
- stock: 库存
- sales: 销量
- main_image: 主图URL
- images: 轮播图URL列表
- description: 商品描述
- status: 商品状态
- created_at: 创建时间
- updated_at: 更新时间

**category**（商品分类表）
- id: 主键，分类ID
- category_name: 分类名称
- parent_id: 父分类ID
- level: 分类级别
- sort_order: 排序

**product_sku**（商品SKU表）
- id: 主键，SKUID
- product_id: 商品ID
- sku_name: SKU名称
- attributes: 规格属性(JSON格式)
- price: SKU价格
- stock: SKU库存
- status: 状态

#### 8.3.3 订单相关表

**order**（订单表）
- id: 主键，订单ID
- order_no: 订单编号
- user_id: 用户ID
- total_amount: 订单总金额
- actual_amount: 实际支付金额
- payment_status: 支付状态
- order_status: 订单状态
- delivery_type: 配送方式
- delivery_address: 配送地址
- contact_phone: 联系电话
- created_at: 创建时间
- updated_at: 更新时间

**order_item**（订单项表）
- id: 主键，订单项ID
- order_id: 订单ID
- product_id: 商品ID
- sku_id: SKU ID
- product_name: 商品名称
- sku_name: SKU名称
- price: 购买价格
- quantity: 购买数量
- subtotal: 小计金额

#### 8.3.4 支付相关表

**payment**（支付记录表）
- id: 主键，支付记录ID
- order_id: 订单ID
- payment_no: 支付流水号
- amount: 支付金额
- payment_method: 支付方式
- transaction_id: 第三方交易ID
- status: 支付状态
- created_at: 创建时间
- updated_at: 更新时间

**refund**（退款记录表）
- id: 主键，退款记录ID
- order_id: 订单ID
- payment_id: 支付记录ID
- refund_no: 退款流水号
- refund_amount: 退款金额
- reason: 退款原因
- status: 退款状态
- created_at: 创建时间
- updated_at: 更新时间

#### 8.3.5 校园特色服务相关表

**campus_building**（校园楼栋信息表）
- id: 主键
- building_name: 楼栋名称
- building_code: 楼栋编码
- building_type: 楼栋类型（教学楼、宿舍楼等）
- location: 地理位置坐标
- description: 楼栋描述
- created_at: 创建时间
- updated_at: 更新时间

**campus_site**（校园站点表）
- id: 主键
- site_name: 站点名称
- site_type: 站点类型（外卖柜、快递点等）
- location: 地理位置坐标
- address: 详细地址
- status: 启用状态
- created_at: 创建时间
- updated_at: 更新时间

**campus_map**（校园地图数据表）
- id: 主键
- map_name: 地图名称
- map_version: 地图版本
- map_data: 地图数据（GeoJSON格式）
- is_active: 是否启用
- created_at: 创建时间
- updated_at: 更新时间

**academic_resource**（学业资源表）
- id: 主键
- resource_name: 资源名称
- resource_type: 资源类型（课程、资料、习题等）
- category: 分类
- content_url: 资源链接
- description: 资源描述
- upload_user_id: 上传用户ID
- created_at: 创建时间
- updated_at: 更新时间

**campus_activity**（校园活动表）
- id: 主键
- activity_name: 活动名称
- activity_type: 活动类型
- start_time: 开始时间
- end_time: 结束时间
- location: 活动地点
- organizer: 组织者
- description: 活动描述
- status: 活动状态
- created_at: 创建时间
- updated_at: 更新时间

**student_club**（学生社团表）
- id: 主键
- club_name: 社团名称
- club_type: 社团类型
- president_id: 社长用户ID
- description: 社团描述
- logo_url: 社团Logo
- status: 社团状态
- created_at: 创建时间
- updated_at: 更新时间

**community_post**（社区帖子表）
- id: 主键
- title: 帖子标题
- content: 帖子内容
- author_id: 作者用户ID
- post_type: 帖子类型（问答、分享、求助等）
- view_count: 浏览次数
- comment_count: 评论数
- status: 帖子状态
- created_at: 创建时间
- updated_at: 更新时间

**lost_found**（失物招领表）
- id: 主键
- item_name: 物品名称
- item_type: 物品类型
- description: 物品描述
- location: 发现/丢失地点
- status: 状态（丢失、招领、已找回）
- contact_info: 联系方式
- created_by: 创建者ID
- created_at: 创建时间
- updated_at: 更新时间

### 8.4 索引策略
- **主键索引**：所有表必须有主键，推荐使用自增ID或UUID
- **唯一索引**：确保业务唯一性（如用户名、订单号等）
- **普通索引**：优化查询性能，针对常用查询条件
- **联合索引**：根据多字段查询场景设计
- **索引维护**：定期分析索引使用情况，优化冗余索引

### 8.5 性能优化考虑
- **读写分离**：主库写、从库读，提高并发性能
- **分库分表**：大数据量表考虑按业务或时间分库分表
- **缓存应用**：热点数据使用Redis缓存，减少数据库访问
- **SQL优化**：避免全表扫描，优化复杂查询
- **连接池优化**：合理配置数据库连接池参数
- **定期维护**：定期清理历史数据，优化表空间

## 9. 部署架构

### 9.1 开发环境
- **基础环境配置**：JDK 17 + Maven 3.9.x + MySQL 8.3.x + Redis 7.2.x
- **开发调试工具**：IntelliJ IDEA / Eclipse + Postman + Docker Desktop
- **环境变量配置**：
  - `DB_HOST`: localhost
  - `DB_PORT`: 3306
  - `REDIS_HOST`: localhost
  - `REDIS_PORT`: 6379
  - `NACOS_HOST`: localhost
  - `NACOS_PORT`: 8848
  - `LOG_LEVEL`: debug
- **本地开发最佳实践**：
  - 使用Docker Compose快速启动依赖服务
  - 配置热部署提升开发效率
  - 使用Lombok、MyBatis-Plus等工具简化开发
  - 遵循代码规范和提交规范

### 9.2 测试环境
- **服务器配置**：2核8G起步，根据服务数量扩展
- **数据库配置**：MySQL主从复制（1主2从），连接池配置优化
- **缓存配置**：Redis 3节点集群，配置持久化和密码认证
- **服务注册发现**：Nacos单机版，配置高可用
- **容器化部署**：Docker + Docker Compose，多环境隔离
- **测试环境特殊配置**：
  - 限流阈值降低，模拟高并发场景
  - 开启详细日志记录，便于问题排查
  - 配置测试账号和测试数据自动生成
  - 数据库定期清理和重置策略

### 9.3 生产环境
- **服务器集群**：多节点负载均衡，至少3台应用服务器
- **网络架构**：
  - 前端：Nginx + CDN加速
  - API网关：Spring Cloud Gateway，统一路由和过滤
  - 服务层：微服务集群部署，无状态设计
  - 数据层：数据库、缓存、消息队列高可用配置
- **数据库配置**：
  - MySQL主从复制 + 读写分离（1主3从）
  - 主库高可用配置，支持自动切换
  - 连接池优化：HikariCP，最大连接数100-200
  - 定期备份策略：全量备份（每日）+ 增量备份（每小时）
- **缓存配置**：
  - Redis 6节点集群（3主3从）
  - 哨兵模式确保高可用
  - 缓存过期策略和预热机制
  - 内存淘汰策略配置
- **服务注册发现**：Nacos 3节点集群，配置持久化
- **消息队列**：Kafka 3节点集群，副本数3
- **搜索服务**：Elasticsearch 3节点集群，冷热分离
- **容器编排**：Kubernetes 3节点集群，配置自动扩缩容
- **服务监控**：Prometheus + Grafana，监控面板定制
- **日志管理**：ELK Stack，日志采集、存储、分析一体化
- **生产环境关键配置**：
  - 安全加固：关闭debug模式，禁用不必要的接口
  - 性能优化：JVM参数调优，GC策略优化
  - 限流熔断：Sentinel配置，防止服务雪崩
  - 配置中心：统一配置管理，支持动态刷新

### 9.4 环境变量配置规范
- **分类管理**：按服务、环境、敏感级别分类管理环境变量
- **敏感信息处理**：
  - 数据库密码、密钥等敏感信息使用Kubernetes Secrets或云服务密钥管理
  - 禁止硬编码敏感信息到代码中
  - 定期轮换密钥和密码
- **配置统一管理**：
  - 使用Nacos配置中心统一管理配置
  - 支持多环境配置隔离
  - 配置变更审计和回滚机制

### 9.5 网络安全配置
- **防火墙设置**：仅开放必要端口，限制IP访问
- **SSL/TLS配置**：
  - 全站HTTPS，TLS 1.2+协议
  - 证书定期更新和监控
  - 禁用不安全的加密套件
- **网络隔离**：服务间通信使用内网，外部访问通过网关
- **DDoS防护**：配置流量监控和清洗

### 9.6 部署流程
1. **代码管理**：
   - 代码提交至Git仓库，遵循Git Flow工作流
   - 代码审核（Code Review）确保代码质量
   - 自动化单元测试和代码覆盖率检查
2. **CI/CD流水线**：
   - 代码提交自动触发CI流程
   - 自动化构建、测试（单元测试、集成测试、API测试）
   - 代码扫描（安全扫描、静态分析）
3. **镜像构建与管理**：
   - 构建Docker镜像，使用多阶段构建减小镜像体积
   - 版本化管理Docker镜像，标签规范：`<服务名>:<版本号>-<环境>-<构建号>`
   - 推送到私有镜像仓库（Harbor）
4. **部署执行**：
   - 测试环境：Docker Compose一键部署
   - 生产环境：Kubernetes滚动更新，确保零停机
   - 灰度发布支持，按比例逐步放量
5. **部署后验证**：
   - 服务健康检查和自动扩缩容
   - 关键业务流程自动化测试
   - 性能监控和告警阈值设置
   - 部署结果通知（邮件、即时通讯工具）

## 10. 安全设计

### 10.1 认证授权体系
- **多身份认证**：支持传统账号密码、微信登录、校园统一身份认证
- **JWT令牌机制**：无状态认证，支持令牌刷新、过期控制和紧急吊销
- **RBAC权限模型**：基于角色的访问控制，精细到API接口级别
- **权限动态管理**：支持运行时权限调整、临时授权和权限自动过期
- **身份验证增强**：关键操作二次验证，敏感功能短信/邮箱验证码

### 10.2 数据安全
- **数据加密**：敏感数据字段加密存储（用户密码、支付信息、身份证号等）
- **传输安全**：全链路HTTPS加密，防止数据窃听和中间人攻击
- **数据脱敏**：日志记录、API响应和管理界面中的敏感信息脱敏处理
- **数据隔离**：多租户数据隔离，确保不同角色和用户数据互不干扰
- **数据备份恢复**：自动化定时备份、异地备份和定期恢复演练
- **数据销毁机制**：用户注销后数据安全删除，过期数据合规销毁

### 10.3 接口安全
- **接口限流**：基于IP和用户的限流策略，防止恶意请求和DDoS攻击
- **参数校验**：严格的输入参数验证，防止SQL注入、XSS等攻击
- **CSRF防护**：跨站请求伪造防护，使用token验证机制
- **接口审计**：重要操作日志记录，包含操作者、时间、操作内容等，支持追溯
- **接口版本控制**：支持API版本管理，确保安全升级
- **接口防火墙**：WAF集成，拦截恶意请求模式

### 10.4 校园数据特别保护
- **学生信息保护**：严格遵循《网络安全法》《个人信息保护法》等法规，保护学生个人信息
- **敏感操作审批**：涉及学生信息的批量操作需多级审批，记录审批流程
- **访问控制增强**：校园特定服务仅对在校师生开放，基于身份和IP双重验证
- **校园敏感数据分级**：根据敏感度对校园数据进行分级保护
- **学生隐私设置**：学生可自主设置个人信息可见范围和权限
- **校园数据审计**：定期对学生数据访问进行安全审计和合规检查

### 10.5 数据合规与法规遵循
- **法规遵循**：符合《网络安全法》《数据安全法》《个人信息保护法》
- **GDPR合规**：关键设计考虑国际通用数据保护标准
- **隐私政策透明**：明确的用户隐私政策，告知数据收集和使用方式
- **合规性审计**：定期进行安全合规性审计和风险评估

### 10.6 安全应急响应
- **安全事件响应**：建立完整的安全事件响应流程和应急预案
- **安全监控预警**：实时监控异常访问和潜在安全威胁
- **安全演练**：定期进行安全攻防演练，提升应对能力
- **漏洞管理**：建立漏洞发现、评估、修复和验证的完整流程

### 10.7 第三方集成安全
- **第三方评估**：对集成的第三方服务进行安全评估
- **API密钥管理**：安全存储和管理第三方服务API密钥
- **数据传输限制**：严格控制向第三方传输的校园数据范围
- **第三方访问审计**：记录和审计第三方系统的数据访问行为

## 11. 系统监控与运维

### 11.1 监控体系
- **服务监控**：
  - **健康状态指标**：服务存活状态、启动时间、JVM堆内存使用情况
  - **性能指标**：GC频率与耗时、线程池状态、方法执行耗时
  - **业务指标**：核心业务流程成功率、服务调用量、队列积压情况
  - **监控工具**：Spring Boot Actuator、Micrometer + Prometheus

- **接口监控**：
  - **调用量指标**：QPS、TPS、分时段流量趋势
  - **响应时间指标**：平均响应时间、95%/99%响应时间、响应时间分布
  - **错误率指标**：5xx错误率、4xx错误率、错误类型分布
  - **接口依赖监控**：外部服务调用成功率、依赖服务健康状态
  - **建议告警阈值**：响应时间>500ms持续3分钟、错误率>0.5%持续5分钟

- **数据库监控**：
  - **性能指标**：QPS/TPS、慢查询数量、连接池使用率
  - **资源指标**：表空间使用率、索引使用情况、锁等待事件
  - **健康指标**：主从复制延迟、备份状态、binlog大小
  - **SQL监控**：TOP SQL分析、全表扫描SQL检测、索引失效监控
  - **建议告警阈值**：慢查询>10条/分钟、连接池使用率>80%、主从延迟>30秒

- **系统资源监控**：
  - **CPU监控**：使用率、负载、上下文切换频率
  - **内存监控**：使用率、交换分区使用情况、内存泄漏检测
  - **磁盘监控**：使用率、I/O吞吐量、I/O等待时间
  - **网络监控**：带宽使用率、连接数、网络延迟、丢包率
  - **建议告警阈值**：CPU使用率>70%持续10分钟、内存使用率>80%、磁盘使用率>85%

- **中间件监控**：
  - **Redis监控**：内存使用率、命令执行率、慢查询、连接数、命中率
  - **消息队列监控**：消息积压量、消费延迟、投递失败率、队列大小
  - **服务注册中心监控**：服务实例数量、健康检查状态、配置变更次数
  - **建议告警阈值**：Redis内存使用率>80%、消息积压>1000条、服务实例异常>30%

### 11.2 日志管理
- **统一日志格式**：
  - **标准字段**：时间戳、服务名称、实例ID、请求ID、日志级别、消息内容、异常信息
  - **结构化日志**：采用JSON格式，便于机器解析和查询
  - **Trace链路**：集成SkyWalking/Jaeger实现分布式链路追踪

- **分布式日志收集**：
  - **收集架构**：Filebeat/Logstash采集 → Kafka缓冲 → Elasticsearch存储
  - **日志采集策略**：按服务类型、环境分类采集，配置适当的采集频率
  - **日志传输安全**：加密传输，防止日志泄露

- **日志分级与管理**：
  - **级别定义**：DEBUG（调试信息）、INFO（正常信息）、WARN（警告信息）、ERROR（错误信息）、FATAL（致命错误）
  - **日志保留策略**：DEBUG日志保留7天，INFO日志保留15天，ERROR/FATAL日志保留90天
  - **日志归档**：定期归档历史日志，支持压缩存储和冷备份

- **关键操作日志**：
  - **审计日志**：记录用户登录、权限变更、数据修改等敏感操作
  - **业务日志**：订单创建、支付完成、重要业务状态变更
  - **安全日志**：异常登录尝试、敏感数据访问、接口异常调用
  - **日志内容要求**：包含操作者ID、操作时间、操作内容、IP地址、操作结果

- **日志查询与分析**：
  - **可视化工具**：Kibana构建日志查询面板和仪表盘
  - **异常检测**：基于机器学习的日志异常模式识别
  - **日志关联分析**：关联服务、接口、业务日志，便于问题定位

### 11.3 告警机制
- **多维度告警策略**：
  - **阈值告警**：基于设定阈值触发的告警（如CPU使用率>80%）
  - **趋势告警**：基于指标变化趋势触发的告警（如请求量突增50%）
  - **复合告警**：多个条件组合触发的告警（如CPU>70%且内存>80%）
  - **智能告警**：基于历史数据和机器学习的异常检测告警

- **告警分类管理**：
  - **紧急告警**：服务不可用、数据丢失、核心业务中断（P0级）
  - **重要告警**：性能严重下降、错误率异常增高（P1级）
  - **一般告警**：资源使用率过高、潜在问题（P2级）
  - **提示告警**：配置变更、非关键服务异常（P3级）

- **告警通知渠道**：
  - **即时通知**：企业微信/钉钉群机器人、短信、电话（紧急告警）
  - **工作通知**：邮件、工单系统、站内消息
  - **告警聚合**：相似告警智能合并，避免告警风暴
  - **告警降噪**：基于规则过滤重复告警，设置静默期

- **告警处理流程**：
  - **告警确认**：告警接收人确认收到告警
  - **告警升级**：未处理告警按时间自动升级（30分钟→2小时→4小时）
  - **告警闭环**：告警处理、解决、验证、归档的完整流程
  - **告警统计分析**：定期分析告警原因、处理时效，优化监控体系

- **校园特色监控告警**：
  - **高峰预警**：针对校园午餐时段、开学季等高流量场景的提前预警
  - **校园活动监控**：大型校园活动期间的专项监控和告警策略
  - **敏感业务监控**：涉及校园支付、学生信息等敏感业务的增强监控

### 11.4 运维自动化
- **基础设施即代码（IaC）**：
  - **环境配置**：使用Terraform/Ansible自动化基础设施配置
  - **一致性保证**：确保开发、测试、生产环境配置一致性
  - **版本控制**：基础设施配置文件纳入Git版本管理

- **容器化与编排自动化**：
  - **自动扩缩容**：基于CPU/内存使用率、请求量的HPA自动扩缩容
  - **滚动更新**：Kubernetes滚动更新策略，确保服务零停机
  - **健康检查**：就绪探针和存活探针配置，自动检测服务状态
  - **故障自愈**：Pod异常自动重启，节点故障自动迁移

- **持续集成/持续部署（CI/CD）**：
  - **流水线自动化**：代码提交→自动构建→自动测试→自动部署
  - **质量门禁**：测试覆盖率、代码质量、安全扫描等质量门禁
  - **灰度发布**：基于Istio的流量灰度，支持按比例、按用户群灰度
  - **蓝绿部署**：完整环境切换，支持快速回滚

- **配置管理自动化**：
  - **配置中心**：Nacos统一配置管理，支持多环境隔离
  - **动态刷新**：配置变更无需重启服务，实时生效
  - **配置校验**：配置变更前的语法和业务规则校验
  - **配置审计**：配置变更历史记录，支持回滚

- **数据库运维自动化**：
  - **自动备份**：定期全量备份和增量备份，自动验证备份可用性
  - **自动恢复**：基于备份的数据库自动恢复演练
  - **性能优化**：慢查询自动分析和索引优化建议
  - **数据归档**：历史数据自动归档和清理策略

- **安全运维自动化**：
  - **漏洞扫描**：定期自动扫描系统和依赖组件漏洞
  - **安全补丁**：关键安全补丁自动评估和应用
  - **合规检查**：定期自动进行安全合规性检查
  - **入侵检测**：异常访问模式自动检测和告警

### 11.5 灾备与恢复
- **灾难恢复策略**：
  - **RTO/RPO定义**：核心业务RTO<30分钟，RPO<5分钟
  - **多活架构**：关键服务多区域部署，支持跨区域容灾
  - **故障转移**：自动检测主节点故障，触发备用节点接管

- **数据备份与恢复**：
  - **备份策略**：数据库每日全量备份，每小时增量备份
  - **备份存储**：本地备份+异地备份，多重保障
  - **恢复演练**：每月进行一次恢复演练，验证备份有效性
  - **数据同步**：跨区域数据实时同步，确保数据一致性

- **应急响应流程**：
  - **预案制定**：针对不同故障类型的详细应急响应预案
  - **角色分工**：明确应急响应中的角色和职责
  - **演练机制**：定期进行应急响应演练，提升团队响应能力
  - **事后分析**：故障发生后的根因分析和改进措施

## 12. API文档结构

### 12.1 文档组织
- **按服务分类**：每个微服务模块独立的API文档，清晰展示服务职责
- **按终端分类**：管理后台、APP、小程序API分开维护，满足不同场景需求
- **按业务域分类**：校园服务、社区互动、生活便利等业务域API归类展示
- **版本管理**：明确的API版本标识和兼容性说明，支持多版本并存

### 12.2 文档标准
- **OpenAPI规范**：严格遵循OpenAPI 3.0规范，确保文档标准化
- **Swagger集成**：通过SpringDoc OpenAPI自动生成API接口文档
- **接口示例**：提供完整的请求/响应示例，包含典型场景和边界情况
- **错误码说明**：统一的错误码系统和详细错误信息说明
- **参数说明**：详细的参数类型、约束条件、默认值和描述
- **安全级别**：明确标识接口安全级别和认证要求

### 12.3 API设计原则
- **RESTful设计**：遵循REST架构风格，资源操作语义清晰
- **统一响应格式**：标准化的响应结构，包含状态码、数据体、消息等
- **幂等性保证**：关键操作接口设计保证幂等性，避免重复提交问题
- **可扩展性**：预留扩展字段和设计，支持业务快速迭代
- **性能优先**：避免过度嵌套，合理设计分页和查询参数

### 12.4 特色服务API
- **校园地图API**：地图数据查询、路径规划、地点搜索、导航指引
- **校园服务API**：学业资源、校园活动、社团管理、校园公告
- **社区互动API**：帖子发布、评论回复、点赞收藏、私信聊天
- **外卖配送API**：订单创建、状态查询、骑手管理、支付集成
- **快递服务API**：快递查询、代取下单、状态跟踪、配送管理

### 12.5 文档访问与测试
- **在线访问**：提供Web界面在线查看和交互测试
- **文档地址**：
  - 管理端API文档：`http://localhost:8001/doc.html`
  - 应用APP API文档：`http://localhost:8002/doc.html`
- **在线测试**：支持直接在文档界面进行API调用测试
- **导出功能**：支持导出为PDF、Markdown等格式

### 12.6 版本控制策略
- **URI版本**：在URL中包含版本号（如 `/api/v1/xxx`）
- **兼容性保证**：旧版本API在过渡期内保持兼容
- **废弃策略**：标记废弃API并提供迁移指南
- **版本公告**：API版本更新通过系统公告通知开发团队

## 13. 校园特色功能详解

黑科易购项目作为面向校园场景的综合服务平台，融合了多种校园特色功能，旨在为师生提供便捷、高效的校园生活服务体验。

### 13.1 校园地图与定位服务
- **智能导航系统**：基于校园地图的精确路径规划，支持教学楼、食堂、图书馆等校园场所的快速定位
- **外卖柜导航**：自动规划从外卖柜到用户位置的最佳路线
- **地图分区加载**：根据用户位置动态加载周边地图数据，优化性能
- **兴趣点标注**：校园内重要场所（如ATM机、充电桩等）的精准标注

### 13.2 学业辅助功能
- **课程表同步**：支持学校教务系统课程表导入和提醒
- **成绩查询接口**：对接学校教务系统，提供成绩查询服务
- **图书馆资源整合**：图书馆馆藏查询和预约功能
- **学习资料共享**：师生间学习资料的安全共享平台

### 13.3 校园社交与社区
- **社团管理系统**：社团注册、活动发布、成员管理一站式服务
- **校园论坛**：支持分类讨论、话题关注、内容推荐
- **校园问答**：专业课程、校园生活相关问题的互助解答平台
- **兴趣圈子**：基于共同兴趣爱好的小组交流社区

### 13.4 校园安全与服务
- **校园公告发布**：官方通知的及时推送和管理
- **校园安全服务**：紧急求助、安全提醒功能
- **失物招领**：物品丢失与拾获的信息发布和匹配平台
- **校园活动报名**：讲座、比赛等校园活动的在线报名和管理

### 13.5 校园生活便利服务
- **智能外卖配送**：校园内的精准定位和智能配送调度
- **快递代收服务**：与校园快递点合作的包裹管理和通知
- **校园兼职信息**：发布和浏览校内兼职岗位信息
- **校园资源共享**：教材、运动器材等资源的共享平台

## 14. 系统性能优化

### 14.1 前端性能优化
- **懒加载**：组件和资源的按需加载
- **资源压缩**：代码、图片、静态资源压缩
- **缓存策略**：合理的浏览器缓存设置
- **CDN加速**：静态资源CDN分发
- **首屏优化**：关键渲染路径优化

### 14.2 后端性能优化
- **代码优化**：算法优化、N+1问题解决
- **缓存设计**：多级缓存策略，热点数据缓存
- **数据库优化**：索引优化、查询优化、分库分表
- **连接池优化**：数据库连接池、线程池调优
- **异步处理**：非核心流程异步化处理

### 14.3 架构优化
- **服务拆分**：合理的微服务边界划分
- **负载均衡**：多实例部署和负载均衡策略
- **熔断降级**：服务熔断、限流、降级机制
- **消息队列**：削峰填谷，异步解耦
- **读写分离**：数据库读写分离，提升并发能力

### 14.4 校园特色服务性能考虑
- **地图服务优化**：地图数据分区加载，降低内存占用
- **搜索服务优化**：基于Elasticsearch的高效索引和查询
- **实时性保证**：外卖、配送状态的实时更新和推送
- **高并发支持**：应对校园高峰期（如午餐时段）的流量冲击


## 15. 项目迭代与规划

### 15.1 近期迭代计划
- 完成校园地图服务的精确导航功能
- 优化外卖配送效率和用户体验
- 加强校园社区互动功能
- 完善学业辅助模块，增加课程表、成绩查询等功能
- 提升系统安全性和稳定性

### 15.2 长期发展方向
- 构建校园生活服务生态闭环
- 引入AI智能推荐，提升个性化服务
- 拓展更多校园特色服务场景
- 支持跨校区服务扩展
- 探索与校外服务的深度集成


## 16. 结语

黑龙江科技大学特色校园服务平台（黑科易购）致力于为全校师生提供便捷、高效、安全的校园生活服务。平台以微服务架构为基础，集成了丰富的校园特色功能，包括商品商城、校园外卖、快递配送、校园地图、学业辅助、校园社区等。通过持续的技术创新和功能优化，平台将不断提升用户体验，成为连接校园内外资源的重要纽带，助力智慧校园建设。