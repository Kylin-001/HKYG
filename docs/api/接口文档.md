# 黑科易购项目接口文档

## 1. 接口规范

### 1.1 接口命名规范

- 接口路径使用小写字母、数字和连字符（-）
- 资源使用复数形式（如 `/api/users`）
- 动词使用HTTP方法表示（GET/POST/PUT/DELETE）
- 查询参数使用驼峰命名

### 1.2 接口版本控制

```
/api/v1/users  # v1版本接口
/api/v2/users  # v2版本接口
```

### 1.3 响应格式规范

#### 1.3.1 成功响应

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 具体响应数据
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

#### 1.3.2 错误响应

```json
{
  "code": 400,
  "message": "参数错误",
  "data": null,
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef",
  "error": {
    "field": "username",
    "message": "用户名不能为空"
  }
}
```

### 1.4 状态码规范

| 状态码 | 含义 | 描述 |
|--------|------|------|
| 200 | 成功 | 接口调用成功 |
| 201 | 创建成功 | 资源创建成功 |
| 204 | 无内容 | 请求成功但无返回内容 |
| 400 | 参数错误 | 请求参数格式错误或缺失 |
| 401 | 未授权 | 需要用户认证 |
| 403 | 禁止访问 | 用户无权限访问该资源 |
| 404 | 未找到 | 请求的资源不存在 |
| 405 | 方法不允许 | 不支持的HTTP方法 |
| 429 | 请求过多 | 请求过于频繁，超出限流 |
| 500 | 服务器错误 | 服务器内部错误 |
| 503 | 服务不可用 | 服务暂时不可用 |

### 1.5 认证授权

#### 1.5.1 JWT Token

```
Authorization: Bearer {token}
```

#### 1.5.2 请求头参数

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| Authorization | String | 是 | JWT认证令牌 |
| Content-Type | String | 是 | 内容类型，通常为application/json |
| X-Trace-Id | String | 否 | 跟踪ID，用于链路追踪 |

## 2. 用户模块接口

### 2.1 用户注册

#### 2.1.1 接口描述

用户注册接口，用于创建新用户账号。

#### 2.1.2 请求信息

- **URL**: `/api/v1/users/register`
- **Method**: `POST`
- **请求体**:

```json
{
  "username": "test_user",
  "password": "123456",
  "phone": "13800138000",
  "email": "test@example.com",
  "smsCode": "123456"
}
```

#### 2.1.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "userId": 1,
    "username": "test_user",
    "phone": "138****8000",
    "email": "te****@example.com",
    "nickname": "用户123456"
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 2.2 用户登录

#### 2.2.1 接口描述

用户登录接口，用于用户身份认证。

#### 2.2.2 请求信息

- **URL**: `/api/v1/users/login`
- **Method**: `POST`
- **请求体**:

```json
{
  "username": "test_user",
  "password": "123456"
}
```

#### 2.2.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expireTime": 1624654290123,
    "userInfo": {
      "userId": 1,
      "username": "test_user",
      "nickname": "用户123456",
      "avatar": "http://example.com/avatar.jpg"
    }
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 2.3 获取用户信息

#### 2.3.1 接口描述

获取当前登录用户的详细信息。

#### 2.3.2 请求信息

- **URL**: `/api/v1/users/info`
- **Method**: `GET`
- **请求头**:
  - `Authorization: Bearer {token}`

#### 2.3.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "userId": 1,
    "username": "test_user",
    "nickname": "用户123456",
    "phone": "138****8000",
    "email": "te****@example.com",
    "avatar": "http://example.com/avatar.jpg",
    "gender": 1,
    "birthday": "1990-01-01",
    "registerTime": "2023-01-01 10:00:00",
    "lastLoginTime": "2023-06-15 14:30:00"
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

## 3. 商品模块接口

### 3.1 获取商品分类

#### 3.1.1 接口描述

获取商品分类列表，支持多级分类查询。

#### 3.1.2 请求信息

- **URL**: `/api/v1/products/categories`
- **Method**: `GET`
- **查询参数**:
  - `parentId`: 父分类ID，不传则获取一级分类
  - `level`: 分类级别
  - `showAll`: 是否显示所有分类（包含子分类）

#### 3.1.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": [
    {
      "categoryId": 1,
      "categoryName": "电子数码",
      "parentId": 0,
      "level": 1,
      "sort": 1,
      "icon": "http://example.com/icon1.png",
      "children": [
        {
          "categoryId": 11,
          "categoryName": "手机",
          "parentId": 1,
          "level": 2,
          "sort": 1,
          "icon": "http://example.com/icon11.png"
        }
      ]
    }
  ],
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 3.2 商品列表

#### 3.2.1 接口描述

获取商品列表，支持分页、排序、筛选等功能。

#### 3.2.2 请求信息

- **URL**: `/api/v1/products`
- **Method**: `GET`
- **查询参数**:
  - `categoryId`: 分类ID
  - `keyword`: 搜索关键词
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `sortBy`: 排序字段，如 price, sales, createTime
  - `sortOrder`: 排序方向，asc或desc
  - `minPrice`: 最低价格
  - `maxPrice`: 最高价格
  - `brandId`: 品牌ID

#### 3.2.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [
      {
        "productId": 1,
        "productName": "iPhone 13",
        "categoryId": 11,
        "brandId": 1,
        "brandName": "Apple",
        "price": 5999,
        "originalPrice": 6999,
        "sales": 10000,
        "stock": 500,
        "mainImage": "http://example.com/iphone13.jpg",
        "description": "iPhone 13系列",
        "isHot": true,
        "isNew": true
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "pages": 5
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 3.3 商品详情

#### 3.3.1 接口描述

获取商品详细信息，包括商品基本信息、SKU、图片等。

#### 3.3.2 请求信息

- **URL**: `/api/v1/products/{productId}`
- **Method**: `GET`
- **路径参数**:
  - `productId`: 商品ID

#### 3.3.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "productId": 1,
    "productName": "iPhone 13",
    "categoryId": 11,
    "categoryName": "手机",
    "brandId": 1,
    "brandName": "Apple",
    "price": 5999,
    "originalPrice": 6999,
    "sales": 10000,
    "stock": 500,
    "mainImage": "http://example.com/iphone13.jpg",
    "images": [
      "http://example.com/iphone13-1.jpg",
      "http://example.com/iphone13-2.jpg"
    ],
    "description": "iPhone 13系列",
    "specs": [
      {
        "specId": 1,
        "specName": "颜色",
        "options": ["红色", "蓝色", "黑色"]
      }
    ],
    "skus": [
      {
        "skuId": 1,
        "price": 5999,
        "stock": 200,
        "specs": {
          "颜色": "红色"
        }
      }
    ],
    "isHot": true,
    "isNew": true,
    "createTime": "2023-01-01 10:00:00"
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

## 4. 订单模块接口

### 4.1 创建订单

#### 4.1.1 接口描述

创建新订单，包括选择商品、地址、支付方式等。

#### 4.1.2 请求信息

- **URL**: `/api/v1/orders`
- **Method**: `POST`
- **请求头**:
  - `Authorization: Bearer {token}`
- **请求体**:

```json
{
  "addressId": 1,
  "items": [
    {
      "skuId": 1,
      "quantity": 1
    }
  ],
  "couponId": 1,
  "paymentType": 1,
  "remark": "请尽快发货"
}
```

#### 4.1.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "orderId": "2023061514300001",
    "totalAmount": 5999,
    "payAmount": 5799,
    "addressInfo": {
      "consigneeName": "张三",
      "phone": "138****8000",
      "province": "北京市",
      "city": "北京市",
      "district": "朝阳区",
      "detailAddress": "望京SOHO"
    },
    "items": [
      {
        "skuId": 1,
        "productName": "iPhone 13",
        "price": 5999,
        "quantity": 1,
        "image": "http://example.com/iphone13.jpg"
      }
    ],
    "status": 1,
    "createTime": "2023-06-15 14:30:00",
    "payTime": null
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 4.2 获取订单列表

#### 4.2.1 接口描述

获取当前用户的订单列表，支持分页和状态筛选。

#### 4.2.2 请求信息

- **URL**: `/api/v1/orders`
- **Method**: `GET`
- **请求头**:
  - `Authorization: Bearer {token}`
- **查询参数**:
  - `status`: 订单状态，不传则查询所有状态
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20
  - `startTime`: 开始时间
  - `endTime`: 结束时间

#### 4.2.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [
      {
        "orderId": "2023061514300001",
        "totalAmount": 5999,
        "payAmount": 5799,
        "status": 1,
        "statusText": "待支付",
        "paymentType": 1,
        "paymentTypeText": "支付宝",
        "createTime": "2023-06-15 14:30:00",
        "items": [
          {
            "productName": "iPhone 13",
            "quantity": 1,
            "price": 5999,
            "image": "http://example.com/iphone13.jpg"
          }
        ]
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 20,
    "pages": 3
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 4.3 订单详情

#### 4.3.1 接口描述

获取订单详细信息，包括订单状态、商品明细、收货信息等。

#### 4.3.2 请求信息

- **URL**: `/api/v1/orders/{orderId}`
- **Method**: `GET`
- **请求头**:
  - `Authorization: Bearer {token}`
- **路径参数**:
  - `orderId`: 订单ID

#### 4.3.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "orderId": "2023061514300001",
    "totalAmount": 5999,
    "payAmount": 5799,
    "actualAmount": 5799,
    "shippingFee": 0,
    "discountAmount": 200,
    "status": 1,
    "statusText": "待支付",
    "paymentType": 1,
    "paymentTypeText": "支付宝",
    "createTime": "2023-06-15 14:30:00",
    "payTime": null,
    "shippingTime": null,
    "completeTime": null,
    "cancelTime": null,
    "addressInfo": {
      "consigneeName": "张三",
      "phone": "138****8000",
      "province": "北京市",
      "city": "北京市",
      "district": "朝阳区",
      "detailAddress": "望京SOHO"
    },
    "items": [
      {
        "orderItemId": 1,
        "skuId": 1,
        "productId": 1,
        "productName": "iPhone 13",
        "skuSpecs": "颜色：红色",
        "price": 5999,
        "quantity": 1,
        "image": "http://example.com/iphone13.jpg"
      }
    ],
    "remark": "请尽快发货",
    "logisticsInfo": null
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

## 5. 支付模块接口

### 5.1 创建支付

#### 5.1.1 接口描述

为订单创建支付，生成支付链接或二维码。

#### 5.1.2 请求信息

- **URL**: `/api/v1/payments`
- **Method**: `POST`
- **请求头**:
  - `Authorization: Bearer {token}`
- **请求体**:

```json
{
  "orderId": "2023061514300001",
  "paymentType": 1,
  "clientType": 1
}
```

#### 5.1.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "支付创建成功",
  "data": {
    "paymentId": "P2023061514350001",
    "orderId": "2023061514300001",
    "amount": 5799,
    "paymentType": 1,
    "paymentTypeText": "支付宝",
    "payUrl": "alipays://platformapi/startapp?appId=20000067&actionType=toAccount&goBack=YES&amount=5799&userId=123456",
    "qrcode": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
    "expireTime": 1624568700000
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 5.2 查询支付状态

#### 5.2.1 接口描述

查询订单的支付状态。

#### 5.2.2 请求信息

- **URL**: `/api/v1/payments/status/{orderId}`
- **Method**: `GET`
- **请求头**:
  - `Authorization: Bearer {token}`
- **路径参数**:
  - `orderId`: 订单ID

#### 5.2.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "orderId": "2023061514300001",
    "paymentId": "P2023061514350001",
    "status": 1,
    "statusText": "支付成功",
    "payTime": "2023-06-15 14:36:00",
    "amount": 5799,
    "paymentType": 1,
    "paymentTypeText": "支付宝",
    "transactionId": "2021061522001104101429214762"
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

## 6. 营销模块接口

### 6.1 获取优惠券列表

#### 6.1.1 接口描述

获取用户可领取或已拥有的优惠券列表。

#### 6.1.2 请求信息

- **URL**: `/api/v1/marketing/coupons`
- **Method**: `GET`
- **请求头**:
  - `Authorization: Bearer {token}`
- **查询参数**:
  - `type`: 类型，1-可领取，2-已拥有
  - `status`: 状态（针对已拥有的优惠券）
  - `page`: 页码，默认1
  - `pageSize`: 每页数量，默认20

#### 6.1.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [
      {
        "couponId": 1,
        "couponName": "新人专享券",
        "type": 1,
        "value": 50,
        "minAmount": 299,
        "startTime": "2023-01-01 00:00:00",
        "endTime": "2023-12-31 23:59:59",
        "scope": 1,
        "scopeDesc": "全场通用",
        "status": 1,
        "statusText": "可领取"
      }
    ],
    "total": 10,
    "page": 1,
    "pageSize": 20,
    "pages": 1
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 6.2 领取优惠券

#### 6.2.1 接口描述

用户领取优惠券。

#### 6.2.2 请求信息

- **URL**: `/api/v1/marketing/coupons/receive`
- **Method**: `POST`
- **请求头**:
  - `Authorization: Bearer {token}`
- **请求体**:

```json
{
  "couponId": 1
}
```

#### 6.2.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "领取成功",
  "data": {
    "userCouponId": 101,
    "couponId": 1,
    "couponName": "新人专享券",
    "value": 50,
    "minAmount": 299,
    "receiveTime": "2023-06-15 14:40:00",
    "expireTime": "2023-12-31 23:59:59",
    "status": 1,
    "statusText": "未使用"
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

## 7. 其他接口

### 7.1 上传文件

#### 7.1.1 接口描述

上传图片、视频等文件。

#### 7.1.2 请求信息

- **URL**: `/api/v1/upload`
- **Method**: `POST`
- **请求头**:
  - `Authorization: Bearer {token}`
  - `Content-Type: multipart/form-data`
- **表单参数**:
  - `file`: 文件对象
  - `type`: 文件类型，image/video/file

#### 7.1.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "fileId": "f1234567890abcdef",
    "fileName": "test.jpg",
    "fileSize": 1024000,
    "fileType": "image/jpeg",
    "url": "http://example.com/uploads/test.jpg",
    "thumbnail": "http://example.com/uploads/thumb_test.jpg",
    "uploadTime": "2023-06-15 14:45:00"
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

### 7.2 获取验证码

#### 7.2.1 接口描述

获取短信验证码。

#### 7.2.2 请求信息

- **URL**: `/api/v1/sms/captcha`
- **Method**: `POST`
- **请求体**:

```json
{
  "phone": "13800138000",
  "type": 1
}
```

#### 7.2.3 响应信息

- **成功响应**:

```json
{
  "code": 200,
  "message": "验证码已发送",
  "data": {
    "phone": "138****8000",
    "expireTime": 1624568400000,
    "countdown": 60
  },
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef"
}
```

## 8. 接口限流说明

### 8.1 限流策略

- **IP限流**：单个IP在单位时间内的请求次数限制
- **用户限流**：单个用户在单位时间内的请求次数限制
- **接口限流**：单个接口在单位时间内的请求次数限制
- **全局限流**：系统整体在单位时间内的请求次数限制

### 8.2 限流提示

当请求超出限流阈值时，系统将返回429状态码：

```json
{
  "code": 429,
  "message": "请求过于频繁，请稍后再试",
  "data": null,
  "timestamp": 1624567890123,
  "traceId": "1234567890abcdef",
  "error": {
    "retryAfter": 60
  }
}
```

## 9. 测试环境

### 9.1 测试环境地址

```
API网关：http://test-api.heikeji.com
管理后台：http://test-admin.heikeji.com
用户门户：http://test-heikeji.com
```

### 9.2 测试账号

- **管理员账号**：admin / 123456
- **测试用户**：test_user / 123456

## 10. 开发环境

### 10.1 本地开发环境

```
API网关：http://localhost:8888
Swagger文档：http://localhost:8888/swagger-ui.html
```

### 10.2 调试工具

推荐使用Postman或Insomnia进行API测试，项目提供了API测试集合文件，位于`docs/api-collection/`目录下。