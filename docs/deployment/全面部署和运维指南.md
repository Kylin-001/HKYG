# 黑科易购项目 - 全面部署和运维指南

## 📋 文档概述

本文档提供黑科易购项目的完整部署流程、环境配置、运维指南、监控告警、故障排查和日常维护的详细说明，帮助运维人员快速掌握项目的部署和维护技能。

## 🚀 1. 部署环境准备

### 1.1 硬件要求

| 环境类型 | CPU | 内存 | 磁盘 | 网络 |
|---------|-----|------|------|------|
| **开发环境** | 4核+ | 8GB+ | 100GB+ SSD | 千兆网络 |
| **测试环境** | 8核+ | 16GB+ | 200GB+ SSD | 千兆网络 |
| **生产环境** | 16核+ | 32GB+ | 500GB+ SSD (推荐RAID 10) | 万兆网络，冗余线路 |

### 1.2 软件要求

| 软件 | 版本要求 | 推荐版本 | 用途 |
|------|---------|---------|------|
| JDK | JDK 17 | OpenJDK 17.0.8+ | Java运行环境 |
| Maven | 3.8.6+ | 3.9.6 | 项目构建 |
| MySQL | 8.0+ | 8.0.36+ | 主数据库 |
| Redis | 6.2+ | 7.0.x | 缓存数据库 |
| ElasticSearch | 8.x | 8.14.x | 搜索引擎 |
| RabbitMQ | 3.8+ | 3.12.x | 消息队列 |
| Nacos | 2.0+ | 2.3.x | 服务注册与配置中心 |
| Docker | 20.10.x+ | 25.0.0+ | 容器化部署 |
| Docker Compose | 2.0.x+ | 2.25.0+ | 多容器管理 |
| Kubernetes | 1.24+ | 1.28.x | 容器编排（可选） |
| Nginx | 1.20+ | 1.25.x | Web服务器/反向代理 |
| Prometheus | 2.40+ | 2.45.x | 指标监控 |
| Grafana | 9.x | 9.5.x | 可视化展示 |
| ELK Stack | 8.x | 8.14.x | 日志收集和分析 |
| Zipkin | 2.x | 2.24.x | 分布式链路追踪 |

## 🔧 2. 环境配置

### 2.1 环境变量配置

#### 2.1.1 环境变量文件结构

项目支持多环境配置，通过以下环境变量文件管理配置：

- `.env`：通用环境变量，适用于所有环境
- `.env.development`：开发环境特定配置
- `.env.test`：测试环境特定配置
- `.env.prod`：生产环境特定配置

#### 2.1.2 环境变量加载优先级

环境变量加载优先级（从高到低）：
1. 命令行传入的环境变量
2. 系统环境变量
3. `.env.{环境}`文件
4. `.env`文件

#### 2.1.3 生产环境配置注意事项

**⚠️ 重要提示**：生产环境配置文件(`.env.prod`)中的敏感信息（如数据库密码、JWT密钥等）必须在部署时设置强密码，禁止使用默认值。

### 2.2 配置文件模板

```properties
# ========== 数据库配置 ==========
DB_HOST=db.heikeji.com
DB_PORT=3306
DB_NAME=heikeji_mall
DB_USERNAME=prod_user
DB_PASSWORD=请设置强密码（至少12位，包含大小写字母、数字和特殊字符）

# ========== Redis配置 ==========
REDIS_HOST=redis.heikeji.com
REDIS_PORT=6379
REDIS_PASSWORD=请设置强密码
REDIS_DATABASE=0

# ========== 服务配置 ==========
SERVER_PORT=8080
SERVER_HOST=0.0.0.0

# ========== 安全配置 ==========
JWT_SECRET=请生成强密钥（推荐使用UUID生成）
JWT_EXPIRATION=3600000
SECURITY_SALT=请生成强盐值

# ========== 第三方服务配置 ==========
# 短信服务配置
SMS_ACCESS_KEY=请设置
SMS_SECRET_KEY=请设置
SMS_SIGN=黑科易购

# 文件存储配置
OSS_ACCESS_KEY=请设置
OSS_SECRET_KEY=请设置
OSS_ENDPOINT=http://oss.heikeji.com
OSS_BUCKET_NAME=heikeji-mall-prod

# ========== 日志配置 ==========
LOG_LEVEL=WARN
LOG_PATH=/var/log/heikeji-mall/prod

# ========== 缓存配置 ==========
CACHE_TTL=3600

# ========== 限流配置 ==========
RATE_LIMIT_PER_SECOND=100

# ========== 消息队列配置 ==========
RABBITMQ_HOST=rabbitmq.heikeji.com
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=prod_user
RABBITMQ_PASSWORD=请设置强密码

# ========== 分布式配置 ==========
NACOS_SERVER_ADDR=nacos.heikeji.com:8848
NACOS_NAMESPACE=prod
NACOS_GROUP=PROD_GROUP

# ========== 监控配置 ==========
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# ========== 链路追踪配置 ==========
ZIPKIN_ENABLED=true
ZIPKIN_SERVER_ADDR=http://zipkin.heikeji.com:9411
```

## 📦 3. 部署流程

### 3.1 手动部署（Windows环境）

#### 3.1.1 编译打包

使用项目提供的构建脚本进行编译打包：

```powershell
# 在项目根目录执行
.\simple_build.ps1
```

或手动执行Maven命令：

```powershell
# 克隆代码库（如有需要）
git clone https://your-git-repo/heikeji-mall.git
cd heikeji-mall

# 编译打包
mvn clean package -DskipTests
```

#### 3.1.2 配置环境

1. 复制环境配置文件：
   ```powershell
   Copy-Item .env.example .env.prod
   ```

2. 编辑`.env.prod`文件，设置所有必要的配置项

#### 3.1.3 启动服务

使用项目提供的启动脚本：

```powershell
# 在项目根目录执行
.\start-app.ps1
```

或手动启动：

```powershell
# 启动应用
java -jar .\target\heikeji-mall-app.jar --spring.profiles.active=prod
```

### 3.2 Docker部署

#### 3.2.1 构建Docker镜像

```bash
# 构建基础镜像
docker build -t heikeji-mall/base:latest .

# 构建应用镜像
docker build -t heikeji-mall/app:latest -f Dockerfile.app .
```

#### 3.2.2 运行Docker容器

```bash
# 运行应用容器
docker run -d \
  --name heikeji-app \
  -p 8080:8080 \
  -v $(pwd)/.env.prod:/app/.env \
  -v $(pwd)/logs:/app/logs \
  heikeji-mall/app:latest
```

### 3.3 Docker Compose部署

#### 3.3.1 Docker Compose配置文件

创建`docker-compose.yml`文件：

```yaml
version: '3.8'

networks:
  heikeji-network:
    driver: bridge

volumes:
  mysql-data:
  redis-data:
  elasticsearch-data:
  rabbitmq-data:
  nacos-data:
  logs-data:

services:
  # MySQL数据库
  mysql:
    image: mysql:8.0.36
    container_name: heikeji-mysql
    networks: [heikeji-network]
    volumes:
      - mysql-data:/var/lib/mysql
      - ./sql/migrations/V001__Create_Initial_Schema.sql:/docker-entrypoint-initdb.d/01-init.sql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: heikeji_mall
      MYSQL_USER: heikeji_app
      MYSQL_PASSWORD: ${MYSQL_APP_PASSWORD}
    ports:
      - "3306:3306"
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 3

  # Redis缓存
  redis:
    image: redis:7.0
    container_name: heikeji-redis
    networks: [heikeji-network]
    volumes:
      - redis-data:/data
    environment:
      REDIS_PASSWORD: ${REDIS_PASSWORD}
    ports:
      - "6379:6379"
    command: ["redis-server", "--requirepass", "${REDIS_PASSWORD}"]

  # Nacos服务注册与配置中心
  nacos:
    image: nacos/nacos-server:v2.3.0
    container_name: heikeji-nacos
    networks: [heikeji-network]
    volumes:
      - nacos-data:/home/nacos/data
    environment:
      - MODE=standalone
      - SPRING_DATASOURCE_PLATFORM=mysql
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_PORT=3306
      - MYSQL_SERVICE_DB_NAME=nacos_config
      - MYSQL_SERVICE_USER=root
      - MYSQL_SERVICE_PASSWORD=${MYSQL_ROOT_PASSWORD}
    ports:
      - "8848:8848"
    depends_on:
      mysql:
        condition: service_healthy

  # 应用服务
  app:
    image: heikeji-mall/app:latest
    container_name: heikeji-app
    networks: [heikeji-network]
    volumes:
      - ./logs:/app/logs
      - ./.env.prod:/app/.env
    environment:
      - SPRING_PROFILES_ACTIVE=prod
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
      - nacos
    restart: on-failure

  # Nginx反向代理
  nginx:
    image: nginx:1.25
    container_name: heikeji-nginx
    networks: [heikeji-network]
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d
      - ./nginx/logs:/var/log/nginx
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - app
```

#### 3.3.2 启动所有服务

```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps
```

### 3.4 Kubernetes部署

#### 3.4.1 创建Kubernetes资源文件

1. 创建命名空间：
```bash
kubectl create namespace heikeji-mall
```

2. 创建Secret配置敏感信息：
```bash
kubectl create secret generic heikeji-secrets \
  --namespace=heikeji-mall \
  --from-literal=db-password=your-strong-db-password \
  --from-literal=redis-password=your-strong-redis-password \
  --from-literal=jwt-secret=your-strong-jwt-secret
```

3. 应用部署配置：
```bash
kubectl apply -f k8s/deployment.yaml -n heikeji-mall
kubectl apply -f k8s/service.yaml -n heikeji-mall
kubectl apply -f k8s/ingress.yaml -n heikeji-mall
kubectl apply -f k8s/configmap.yaml -n heikeji-mall
```

## 🔍 4. 监控与告警

### 4.1 监控体系架构

黑科易购项目采用多层次的监控体系：

- **应用层监控**：JVM状态、接口性能、业务指标
- **系统层监控**：服务器CPU、内存、磁盘、网络
- **数据库监控**：MySQL性能、连接数、慢查询
- **中间件监控**：Redis、ElasticSearch、RabbitMQ状态
- **链路监控**：分布式调用链路追踪
- **业务监控**：核心业务指标、流量监控

### 4.2 监控工具访问

| 监控工具 | 用途 | 访问地址 |
|----------|------|----------|
| Prometheus | 指标采集和存储 | http://prometheus.heikeji.com |
| Grafana | 可视化展示 | http://grafana.heikeji.com |
| Zipkin | 分布式链路追踪 | http://zipkin.heikeji.com |
| Kibana | 日志收集和分析 | http://kibana.heikeji.com |
| Spring Boot Admin | 应用状态监控 | http://admin.heikeji.com |

### 4.3 告警策略

| 告警级别 | 描述 | 处理时间 | 通知方式 |
|----------|------|----------|----------|
| P0 | 系统完全不可用 | 立即处理（24/7） | 电话+短信+邮件+企业微信 |
| P1 | 核心功能不可用 | 1小时内 | 电话+短信+邮件+企业微信 |
| P2 | 重要功能受影响 | 4小时内 | 短信+邮件+企业微信 |
| P3 | 非核心功能异常 | 24小时内 | 邮件+企业微信 |
| P4 | 性能下降 | 下一工作日 | 邮件 |

### 4.4 关键监控指标

#### 4.4.1 应用监控指标

| 指标名称 | 告警阈值 | 监控频率 |
|---------|---------|--------|
| 应用在线状态 | 服务无心跳 | 30秒 |
| 接口错误率 | >5% | 1分钟 |
| 平均响应时间 | >500ms | 1分钟 |
| JVM堆内存使用率 | >90% | 1分钟 |
| GC暂停时间 | >1秒 | 1分钟 |
| 线程池活跃线程数 | >80%容量 | 1分钟 |

#### 4.4.2 系统监控指标

| 指标名称 | 告警阈值 | 监控频率 |
|---------|---------|--------|
| CPU使用率 | >80%（持续5分钟） | 1分钟 |
| 内存使用率 | >90% | 1分钟 |
| 磁盘使用率 | >85% | 5分钟 |
| 网络IO | 带宽饱和 >90% | 5分钟 |
| TCP连接数 | >最大连接数80% | 1分钟 |

#### 4.4.3 数据库监控指标

| 指标名称 | 告警阈值 | 监控频率 |
|---------|---------|--------|
| 数据库连接数 | >最大连接数80% | 1分钟 |
| 慢查询数量 | >10个/分钟 | 1分钟 |
| 缓冲池命中率 | <95% | 5分钟 |
| 主从复制延迟 | >30秒 | 1分钟 |
| 事务回滚率 | >5% | 1分钟 |

## 📊 5. 日志管理

### 5.1 日志分类

- **应用日志**：记录应用运行状态和错误信息
- **业务日志**：记录重要的业务流程和操作
- **访问日志**：记录所有API请求和响应
- **错误日志**：汇总错误信息，便于问题排查
- **安全日志**：记录认证、授权等安全相关操作

### 5.2 日志存储

- **本地存储**：应用服务器本地临时存储
- **集中存储**：使用ELK Stack进行集中式日志收集和存储
- **日志轮转**：
  - 大小轮转：单个日志文件达到100MB时轮转
  - 时间轮转：每日0点自动轮转
  - 保留策略：
    - 生产环境：至少保留30天
    - 重要日志：保留90天或更长
    - 归档日志：定期归档到低成本存储

### 5.3 日志查询和分析

**常用Kibana查询示例**：

1. 查询特定服务的错误日志：
   ```
   service_name:"heikeji-app" AND level:"ERROR"
   ```

2. 查询特定时间段的日志：
   ```
   @timestamp:[2024-11-18T00:00:00Z TO 2024-11-19T00:00:00Z]
   ```

3. 根据用户ID查询操作日志：
   ```
   user_id:"123456" AND log_type:"operation"
   ```

4. 查询慢接口（响应时间>1秒）：
   ```
   response_time:{1000 TO *}
   ```

## 💾 6. 备份与恢复

### 6.1 数据备份策略

| 数据类型 | 备份频率 | 备份方式 | 保留周期 | 备份工具 |
|----------|----------|----------|----------|----------|
| 数据库全量 | 每日1次（凌晨2点） | mysqldump | 7天 | 自动脚本 |
| 数据库增量 | 每小时1次 | binlog | 30天 | MySQL binlog |
| 配置文件 | 每次变更 | 文件备份 | 90天 | Git/rsync |
| 日志文件 | 每日1次 | 归档备份 | 30天 | logrotate |
| 用户上传文件 | 每日1次 | 增量备份 | 90天 | rsync |
| 系统镜像 | 每周1次 | 磁盘镜像 | 4周 | 镜像工具 |

### 6.2 备份脚本示例

**数据库全量备份脚本**：

```bash
#!/bin/bash

# 数据库备份脚本
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/mysql"
DB_NAME="heikeji_mall"
DB_USER="backup_user"
DB_PASSWORD="your_backup_password"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 执行备份
mysqldump -u$DB_USER -p$DB_PASSWORD --single-transaction --routines --triggers $DB_NAME > $BACKUP_DIR/${DB_NAME}_full_${DATE}.sql

# 压缩备份文件
gzip $BACKUP_DIR/${DB_NAME}_full_${DATE}.sql

# 清理7天前的备份文件
find $BACKUP_DIR -name "${DB_NAME}_full_*.sql.gz" -mtime +7 -delete

# 记录备份日志
echo "[$(date)] 数据库备份完成: ${DB_NAME}_full_${DATE}.sql.gz" >> $BACKUP_DIR/backup.log
```

### 6.3 数据恢复流程

#### 6.3.1 数据库恢复

1. **准备工作**：
   - 确认恢复时间点和范围
   - 停止相关服务，避免数据写入
   - 备份当前数据库（如需要）

2. **恢复全量备份**：
   ```bash
   # 解压备份文件
   gzip -d heikeji_mall_full_20241118_020000.sql.gz
   
   # 恢复数据库
   mysql -u root -p heikeji_mall < heikeji_mall_full_20241118_020000.sql
   ```

3. **恢复增量备份**（使用binlog）：
   ```bash
   # 查看binlog文件列表
   mysqlbinlog --list
   
   # 恢复指定时间段的binlog
   mysqlbinlog --start-datetime="2024-11-18 02:00:00" --stop-datetime="2024-11-18 12:00:00" /var/lib/mysql/binlog.000001 | mysql -u root -p
   ```

4. **验证数据**：
   - 检查数据完整性和一致性
   - 验证关键业务功能

5. **启动服务**：
   - 恢复服务并监控运行状态

#### 6.3.2 配置文件恢复

```bash
# 备份当前配置
cp -r /path/to/config /path/to/config.bak

# 恢复备份文件
cp -r /path/to/backup/config /path/to/config

# 验证配置权限
chmod 644 /path/to/config/*.conf

# 重启服务使配置生效
systemctl restart heikeji-app
```

## ⚡ 7. 性能优化

### 7.1 应用性能优化

#### 7.1.1 JVM调优

**推荐JVM参数**：

```bash
-Xms2g -Xmx2g -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:InitiatingHeapOccupancyPercent=70 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/logs/heapdump.hprof
```

**参数说明**：
- `-Xms2g -Xmx2g`：初始和最大堆内存设为2GB
- `-XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m`：元空间大小设置
- `-XX:+UseG1GC`：使用G1垃圾收集器
- `-XX:MaxGCPauseMillis=200`：最大GC暂停时间目标设为200ms
- `-XX:InitiatingHeapOccupancyPercent=70`：当堆使用率达到70%时触发并发标记周期
- `-XX:+HeapDumpOnOutOfMemoryError`：OOM时自动生成堆转储文件

#### 7.1.2 连接池优化

**数据库连接池配置**：

```properties
# HikariCP连接池配置
spring.datasource.hikari.maximum-pool-size=100
spring.datasource.hikari.minimum-idle=20
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
```

**Redis连接池配置**：

```properties
# Redis连接池配置
spring.redis.lettuce.pool.max-active=200
spring.redis.lettuce.pool.max-idle=50
spring.redis.lettuce.pool.min-idle=20
spring.redis.lettuce.pool.max-wait=30000ms
```

### 7.2 数据库性能优化

#### 7.2.1 MySQL优化配置

```ini
# InnoDB缓冲池大小（推荐设置为服务器内存的50%）
innodb_buffer_pool_size = 16G

# InnoDB缓冲池实例数（推荐设置为CPU核心数）
innodb_buffer_pool_instances = 16

# 事务隔离级别
transaction-isolation = READ-COMMITTED

# 慢查询日志
slow_query_log = 1
long_query_time = 1
slow_query_log_file = /var/log/mysql/slow-query.log

# 最大连接数
max_connections = 1000

# 表打开缓存
table_open_cache = 4000

# 排序缓冲区大小
sort_buffer_size = 4M

# 连接缓冲区大小
join_buffer_size = 4M

# 临时表大小
tmp_table_size = 64M
max_heap_table_size = 64M
```

#### 7.2.2 索引优化

- **定期分析索引使用情况**：
  ```sql
  -- 查看未使用的索引
  SELECT * FROM performance_schema.table_io_waits_summary_by_index_usage 
  WHERE count_star = 0 AND index_name IS NOT NULL;
  ```

- **优化慢查询**：
  ```sql
  -- 开启慢查询日志
  SET GLOBAL slow_query_log = 'ON';
  SET GLOBAL long_query_time = 1;
  
  -- 分析慢查询日志
  mysqldumpslow -s t /var/log/mysql/slow-query.log
  ```

### 7.3 缓存优化

- **合理设置缓存过期时间**：
  - 频繁变化数据：短缓存（1-5分钟）
  - 中等频率变化数据：中等缓存（15-30分钟）
  - 静态数据：长缓存（1小时-1天）

- **Redis内存优化**：
  ```
  # 设置最大内存
  maxmemory 4gb
  
  # 设置内存淘汰策略
  maxmemory-policy allkeys-lru
  ```

## 🛠️ 8. 故障排查

### 8.1 常见故障及解决方案

#### 8.1.1 应用启动失败

**可能原因**：
- 端口被占用
- 配置文件错误
- 数据库连接失败
- 依赖服务不可用

**排查步骤**：
1. 检查应用日志：`tail -n 200 /logs/heikeji-app.log`
2. 检查端口占用：`netstat -tulpn | grep 8080`
3. 验证数据库连接：`mysql -u username -p -h host database`
4. 检查依赖服务状态：Redis、Nacos等

#### 8.1.2 数据库连接异常

**可能原因**：
- 数据库服务宕机
- 连接池配置不合理
- 数据库连接数超限
- 网络连接问题

**排查步骤**：
1. 检查数据库服务状态：`systemctl status mysql`
2. 查看数据库连接数：`SHOW STATUS LIKE 'Threads_connected'`
3. 检查连接池配置是否合理
4. 验证网络连通性：`ping db-host`

#### 8.1.3 接口响应缓慢

**可能原因**：
- 数据库查询效率低
- 缓存未命中或配置不当
- 接口逻辑复杂
- 系统资源不足

**排查步骤**：
1. 查看慢查询日志，定位慢SQL
2. 检查缓存命中率
3. 使用链路追踪工具分析接口耗时
4. 检查系统资源使用情况

### 8.2 应急响应流程

1. **问题发现**：通过监控告警或用户反馈发现问题
2. **问题评估**：确定影响范围和严重程度
3. **初步定位**：查看日志、监控数据，初步定位问题
4. **紧急处理**：
   - 对于P0/P1级别问题，立即采取应急措施
   - 必要时启动回滚流程
5. **深入分析**：在确保系统稳定后，深入分析问题根源
6. **解决方案**：制定并实施修复方案
7. **验证效果**：确认问题已解决，系统恢复正常
8. **事后复盘**：记录事件原因、处理过程和经验教训

## 📝 9. 日常维护

### 9.1 定期维护任务

| 维护项目 | 频率 | 负责人 | 维护内容 |
|---------|------|--------|--------|
| 数据库备份验证 | 每周 | DBA | 测试备份文件的可恢复性 |
| 日志清理 | 每日 | 运维工程师 | 清理过期日志文件 |
| 系统补丁更新 | 每月 | 运维工程师 | 应用安全补丁和系统更新 |
| 性能评估 | 每月 | 性能工程师 | 分析系统性能指标，识别优化空间 |
| 安全审计 | 每月 | 安全工程师 | 进行安全漏洞扫描和权限审查 |
| 配置检查 | 每周 | 运维工程师 | 验证配置文件的完整性和正确性 |

### 9.2 系统健康检查

**每日健康检查清单**：

- [ ] 检查所有服务的运行状态
- [ ] 监控系统资源使用率（CPU、内存、磁盘、网络）
- [ ] 检查数据库连接数和性能指标
- [ ] 验证缓存服务运行正常
- [ ] 检查日志中是否有异常错误
- [ ] 确认备份任务执行成功
- [ ] 验证监控和告警系统正常工作

### 9.3 扩容策略

**水平扩容**：
1. 增加应用服务器实例数量
2. 配置负载均衡器分发请求
3. 确保应用无状态设计，支持水平扩展

**垂直扩容**：
1. 升级服务器硬件配置（CPU、内存）
2. 调整JVM和连接池参数
3. 优化数据库配置

**数据库扩容**：
1. 实施读写分离
2. 考虑分库分表策略
3. 配置数据库集群

## 🚨 10. 安全管理

### 10.1 服务器安全加固

- **防火墙配置**：仅开放必要端口
- **SSH安全**：禁用root直接登录，使用密钥认证，修改默认端口
- **账户管理**：定期审计用户账户，删除不必要的账户
- **文件权限**：严格控制关键文件和目录的访问权限
- **定期更新**：及时应用安全补丁和系统更新

### 10.2 应用安全管理

- **敏感信息保护**：
  - 不在代码中硬编码敏感信息
  - 使用环境变量或配置中心管理敏感配置
  - 加密存储敏感数据

- **访问控制**：
  - 实施细粒度的权限控制
  - 定期审计权限设置
  - 遵循最小权限原则

- **API安全**：
  - 实施接口限流
  - 验证所有输入参数
  - 防范SQL注入、XSS等常见攻击

### 10.3 应急响应计划

**安全事件响应流程**：

1. **检测与报告**：发现安全事件并报告
2. **遏制**：采取措施限制事件影响范围
3. **根除**：移除安全威胁
4. **恢复**：恢复系统正常运行
5. **总结**：分析事件原因，制定防范措施

## 📚 11. 文档与知识库

### 11.1 文档管理

- **架构文档**：系统架构、组件关系、技术选型
- **API文档**：接口定义、参数说明、返回值格式
- **数据库文档**：数据库结构、表关系、索引设计
- **运维文档**：部署流程、环境配置、监控告警
- **故障处理文档**：常见问题及解决方案

### 11.2 知识库建设

- 记录所有重大问题的处理过程和解决方案
- 定期更新运维手册和最佳实践
- 建立团队共享的经验知识库
- 组织技术分享和培训，提升团队能力

## 👥 12. 团队协作

### 12.1 责任分工

| 角色 | 主要职责 |
|------|--------|
| 开发团队 | 代码开发、单元测试、功能实现 |
| 测试团队 | 功能测试、性能测试、安全测试 |
| 运维团队 | 环境部署、系统监控、日常维护 |
| DBA | 数据库管理、性能优化、数据备份 |
| 安全工程师 | 安全审计、漏洞扫描、安全加固 |
| 项目经理 | 进度协调、资源管理、风险控制 |

### 12.2 沟通机制

- **日常例会**：每日15分钟站会，同步进度和问题
- **周报制度**：每周提交工作总结和计划
- **问题跟踪**：使用项目管理工具跟踪问题和任务
- **紧急联系**：建立24/7紧急联系人清单和联系方式
- **知识库共享**：使用Wiki或文档系统共享信息

---

## 📅 13. 附录

### 13.1 常用命令

**服务管理**：
```bash
# 启动应用
systemctl start heikeji-app

# 停止应用
systemctl stop heikeji-app

# 重启应用
systemctl restart heikeji-app

# 查看应用状态
systemctl status heikeji-app

# 查看应用日志
journalctl -u heikeji-app -n 100 --no-pager
```

**数据库管理**：
```bash
# 连接MySQL
mysql -u root -p

# 备份数据库
mysqldump -u root -p heikeji_mall > backup_$(date +%Y%m%d).sql

# 恢复数据库
mysql -u root -p heikeji_mall < backup_file.sql

# 查看数据库连接数
mysql -e "SHOW STATUS LIKE 'Threads_connected'"
```

**Docker管理**：
```bash
# 查看运行的容器
docker ps

# 查看所有容器（包括停止的）
docker ps -a

# 启动容器
docker start container_name

# 停止容器
docker stop container_name

# 查看容器日志
docker logs container_name
```

### 13.2 联系信息

- **技术支持**：
  - 电话：400-123-4567
  - 邮箱：support@heikeji.com
  - 企业微信群：黑科易购技术支持

- **紧急联系人**：
  - 运维主管：张工（138-XXXX-XXXX）
  - 开发负责人：李工（139-XXXX-XXXX）
  - DBA：王工（137-XXXX-XXXX）

---

**文档版本**：V1.0  
**创建日期**：2024年11月18日  
**更新日期**：2024年11月18日  
**文档所有者**：黑科易购技术团队