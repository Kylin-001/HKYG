<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.heikeji.mall.takeout.mapper.DeliveryLockerMapper">

    <!-- 查询可用的外卖柜 -->
    <select id="selectAvailableLockers" resultType="com.heikeji.mall.takeout.entity.DeliveryLocker">
        SELECT * FROM delivery_locker
        WHERE status = 0 AND available_cells > 0
        ORDER BY location asc
    </select>

    <!-- 根据编码查询外卖柜 -->
    <select id="selectByCode" resultType="com.heikeji.mall.takeout.entity.DeliveryLocker">
        SELECT * FROM delivery_locker
        WHERE locker_code = #{lockerCode}
    </select>

    <!-- 占用外卖柜格口 -->
    <update id="occupyCell">
        UPDATE delivery_locker
        SET available_cells = available_cells - 1
        WHERE locker_code = #{lockerCode} AND available_cells > 0
    </update>

    <!-- 释放外卖柜格口 -->
    <update id="releaseCell">
        UPDATE delivery_locker
        SET available_cells = available_cells + 1
        WHERE locker_code = #{lockerCode} AND available_cells < total_cells
    </update>

    <!-- 获取所有外卖柜 -->
    <select id="selectAll" resultType="com.heikeji.mall.takeout.entity.DeliveryLocker">
        SELECT * FROM delivery_locker
        ORDER BY location asc
    </select>

</mapper>